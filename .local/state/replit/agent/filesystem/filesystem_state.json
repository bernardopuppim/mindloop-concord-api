{"file_contents":{"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\nimport { useDevRole, mapDevRoleToUserRole } from \"@/contexts/DevRoleContext\";\n\nexport type UserRole = \"admin\" | \"admin_dica\" | \"operator_dica\" | \"fiscal_petrobras\" | \"viewer\";\n\n/**\n * Authentication hook with development role override support.\n * \n * DEVELOPMENT MODE OVERRIDE:\n * When a dev role is set via the DevRoleSwitcher component, this hook will\n * use the dev role instead of the user's actual role for permission calculations.\n * This allows testing different role behaviors without changing the authenticated user.\n * \n * The override only affects frontend permission checks. For backend enforcement,\n * API requests include an X-Dev-Role header (see queryClient.ts).\n */\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  // Get dev role from context (only active in development mode)\n  const { devRole, isDevMode } = useDevRole();\n  \n  // Map dev role to actual DB role value, or use real user role\n  const mappedDevRole = mapDevRoleToUserRole(devRole) as UserRole | null;\n  \n  // Use dev role override if set (dev mode only), otherwise use real role\n  const effectiveRole: UserRole | undefined = \n    (isDevMode && mappedDevRole) ? mappedDevRole : (user?.role as UserRole | undefined);\n  \n  // Calculate permissions based on effective role (dev override or real)\n  const isAdmin = effectiveRole === \"admin\" || effectiveRole === \"admin_dica\";\n  const canEdit = isAdmin || effectiveRole === \"operator_dica\";\n  const isViewOnly = effectiveRole === \"viewer\" || effectiveRole === \"fiscal_petrobras\";\n  const canExport = isAdmin || effectiveRole === \"fiscal_petrobras\";\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    isAdmin,\n    isViewer: effectiveRole === \"viewer\",\n    userRole: effectiveRole,\n    realUserRole: user?.role as UserRole | undefined, // Expose real role for reference\n    canEdit,\n    isViewOnly,\n    canExport,\n    error,\n    isDevRoleActive: isDevMode && !!devRole, // Flag to indicate dev role is in use\n  };\n}\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/pages/employees/employee-view.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Pencil, FileText, Calendar, Palmtree } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { formatDate } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport type { Employee, Document, Allocation } from \"@shared/schema\";\n\ninterface EmployeeViewProps {\n  employeeId: number;\n}\n\nexport default function EmployeeView({ employeeId }: EmployeeViewProps) {\n  const { isAdmin } = useAuth();\n\n  const { data: employee, isLoading } = useQuery<Employee>({\n    queryKey: [\"/api/employees\", employeeId],\n  });\n\n  const { data: documents } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const { data: allocations } = useQuery<Allocation[]>({\n    queryKey: [\"/api/allocations\"],\n  });\n\n  const employeeDocuments = documents?.filter(d => d.employeeId === employeeId) || [];\n  const employeeAllocations = allocations?.filter(a => a.employeeId === employeeId).slice(0, 10) || [];\n  const employeeLeaves = allocations?.filter(a => \n    a.employeeId === employeeId && (a.status === \"vacation\" || a.status === \"medical_leave\")\n  ).slice(0, 10) || [];\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title={translations.common.loading} />\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              <Skeleton className=\"h-8 w-48\" />\n              <Skeleton className=\"h-4 w-32\" />\n              <Skeleton className=\"h-4 w-40\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!employee) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title={translations.errors.notFound} />\n        <Card>\n          <CardContent className=\"p-6\">\n            <p className=\"text-muted-foreground\">{translations.errors.notFound}</p>\n            <Button asChild className=\"mt-4\">\n              <Link href=\"/employees\">{translations.common.back}</Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={employee.name}\n        description={translations.employees.viewEmployee}\n      >\n        <Button variant=\"outline\" asChild data-testid=\"button-back\">\n          <Link href=\"/employees\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            {translations.common.back}\n          </Link>\n        </Button>\n        {isAdmin && (\n          <Button asChild data-testid=\"button-edit\">\n            <Link href={`/employees/${employeeId}/edit`}>\n              <Pencil className=\"h-4 w-4 mr-2\" />\n              {translations.common.edit}\n            </Link>\n          </Button>\n        )}\n      </PageHeader>\n\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>{translations.employees.title}</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-4 sm:grid-cols-2\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.employees.name}</p>\n                <p className=\"text-base\" data-testid=\"text-employee-name\">{employee.name}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.employees.cpf}</p>\n                <p className=\"text-base font-mono\" data-testid=\"text-employee-cpf\">{employee.cpf}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.employees.functionPost}</p>\n                <p className=\"text-base\" data-testid=\"text-employee-function\">{employee.functionPost}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.employees.unit}</p>\n                <p className=\"text-base\" data-testid=\"text-employee-unit\">{employee.unit}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.employees.status}</p>\n                <div className=\"mt-1\">\n                  <StatusBadge status={employee.status} />\n                </div>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.employees.createdAt}</p>\n                <p className=\"text-base\">{employee.createdAt ? formatDate(employee.createdAt) : \"N/A\"}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              {translations.documents.title}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {employeeDocuments.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">{translations.documents.noDocuments}</p>\n            ) : (\n              <div className=\"space-y-2\">\n                {employeeDocuments.map((doc) => (\n                  <div key={doc.id} className=\"flex items-center gap-2 text-sm\">\n                    <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"truncate\">{doc.originalName}</span>\n                  </div>\n                ))}\n              </div>\n            )}\n            <Button variant=\"outline\" size=\"sm\" className=\"mt-4 w-full\" asChild>\n              <Link href={`/documents?employeeId=${employeeId}`}>{translations.common.view} {translations.documents.title}</Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Calendar className=\"h-5 w-5\" />\n            {translations.allocation.title}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {employeeAllocations.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">{translations.allocation.noAllocations}</p>\n          ) : (\n            <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\n              {employeeAllocations.map((allocation) => (\n                <div key={allocation.id} className=\"flex items-center justify-between rounded-md border p-3\">\n                  <div>\n                    <p className=\"text-sm font-medium\">{formatDate(allocation.date)}</p>\n                    <p className=\"text-xs text-muted-foreground\">{translations.servicePosts.title}: {allocation.postId}</p>\n                  </div>\n                  <StatusBadge status={allocation.status} />\n                </div>\n              ))}\n            </div>\n          )}\n          <Button variant=\"outline\" size=\"sm\" className=\"mt-4\" asChild>\n            <Link href=\"/allocation\">{translations.common.view} {translations.allocation.title}</Link>\n          </Button>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Palmtree className=\"h-5 w-5\" />\n            Férias e Licenças\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {employeeLeaves.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">Nenhum registro de férias ou licença encontrado.</p>\n          ) : (\n            <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\n              {employeeLeaves.map((leave) => (\n                <div key={leave.id} className=\"flex items-center justify-between rounded-md border p-3\" data-testid={`leave-card-${leave.id}`}>\n                  <div>\n                    <p className=\"text-sm font-medium\">{formatDate(leave.date)}</p>\n                    <p className=\"text-xs text-muted-foreground\">{translations.servicePosts.title}: {leave.postId}</p>\n                  </div>\n                  <StatusBadge status={leave.status} />\n                </div>\n              ))}\n            </div>\n          )}\n          <Button variant=\"outline\" size=\"sm\" className=\"mt-4\" asChild>\n            <Link href=\"/allocation\">{translations.common.view} {translations.allocation.title}</Link>\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":8693,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2560,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000;\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(claims: any) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  const registeredStrategies = new Set<string>();\n\n  const ensureStrategy = (domain: string) => {\n    const strategyName = `replitauth:${domain}`;\n    if (!registeredStrategies.has(strategyName)) {\n      const strategy = new Strategy(\n        {\n          name: strategyName,\n          config,\n          scope: \"openid email profile offline_access\",\n          callbackURL: `https://${domain}/api/callback`,\n        },\n        verify\n      );\n      passport.use(strategy);\n      registeredStrategies.add(strategyName);\n    }\n  };\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    ensureStrategy(req.hostname);\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n\n/**\n * Maps development role names from the X-Dev-Role header to actual database roles.\n * Only used in development mode for testing different role behaviors.\n */\nexport function mapDevRoleToDbRole(devRole: string): string | null {\n  const roleMap: Record<string, string> = {\n    \"admin\": \"admin\",\n    \"fiscal\": \"fiscal_petrobras\",\n    \"operador\": \"operator_dica\",\n    \"visualizador\": \"viewer\",\n  };\n  return roleMap[devRole] || null;\n}\n\n/**\n * Gets the effective user role, considering dev role override in development mode.\n * \n * DEVELOPMENT OVERRIDE MECHANISM:\n * When NODE_ENV !== \"production\" and an X-Dev-Role header is present,\n * the dev role overrides the user's actual database role for permission checks.\n * This allows testing different role behaviors without changing user data.\n * \n * SECURITY: This override is disabled in production builds.\n * \n * USAGE: Call this function in any route handler that needs to check user roles.\n * Example:\n *   const user = await storage.getUser(userId);\n *   const effectiveRole = getEffectiveRole(req, user?.role);\n *   if (effectiveRole === \"admin\") { ... }\n */\nexport function getEffectiveRole(req: any, actualRole: string | undefined): string | undefined {\n  // Only allow dev role override outside production\n  if (process.env.NODE_ENV === \"production\") {\n    return actualRole;\n  }\n  \n  const devRoleHeader = req.get(\"X-Dev-Role\");\n  if (devRoleHeader) {\n    const mappedRole = mapDevRoleToDbRole(devRoleHeader);\n    if (mappedRole) {\n      console.log(`[DEV MODE] Role override active: ${actualRole} -> ${mappedRole}`);\n      return mappedRole;\n    }\n  }\n  \n  return actualRole;\n}\n\nexport const isAdmin: RequestHandler = async (req, res, next) => {\n  const userSession = req.user as any;\n  if (!userSession?.claims?.sub) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const user = await storage.getUser(userSession.claims.sub);\n  \n  // Use effective role (may be overridden by dev role header in development)\n  const effectiveRole = getEffectiveRole(req, user?.role);\n  \n  if (effectiveRole !== \"admin\" && effectiveRole !== \"admin_dica\") {\n    return res.status(403).json({ message: \"Forbidden: Admin access required\" });\n  }\n\n  return next();\n};\n","path":null,"size_bytes":6585,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Users, Briefcase, CalendarDays, AlertCircle, FileText, TrendingUp, Clock, CheckCircle, BarChart3, PieChart } from \"lucide-react\";\nimport type { Employee, ServicePost, Allocation, Occurrence, Document } from \"@shared/schema\";\nimport { translations } from \"@/lib/translations\";\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  PieChart as RechartsPieChart,\n  Pie,\n  Cell,\n  Legend,\n} from \"recharts\";\n\ninterface AllocationTrend {\n  date: string;\n  present: number;\n  absent: number;\n  justified: number;\n  vacation: number;\n  medical_leave: number;\n}\n\ninterface OccurrenceByCategory {\n  category: string;\n  count: number;\n}\n\ninterface ComplianceMetrics {\n  attendanceRate: number;\n  documentationRate: number;\n  activeEmployeeRate: number;\n  occurrenceRate: number;\n}\n\nconst CHART_COLORS = {\n  present: \"hsl(var(--chart-1))\",\n  absent: \"hsl(var(--chart-2))\",\n  justified: \"hsl(var(--chart-3))\",\n  vacation: \"hsl(var(--chart-4))\",\n  medical_leave: \"hsl(var(--chart-5))\",\n};\n\nconst CATEGORY_COLORS = [\n  \"hsl(var(--chart-1))\",\n  \"hsl(var(--chart-2))\",\n  \"hsl(var(--chart-3))\",\n  \"hsl(var(--chart-4))\",\n];\n\nfunction StatCard({ \n  title, \n  value, \n  subtitle, \n  icon: Icon, \n  isLoading \n}: { \n  title: string; \n  value: string | number; \n  subtitle?: string; \n  icon: React.ElementType; \n  isLoading?: boolean;\n}) {\n  if (isLoading) {\n    return (\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n          <Skeleton className=\"h-4 w-24\" />\n          <Skeleton className=\"h-5 w-5\" />\n        </CardHeader>\n        <CardContent>\n          <Skeleton className=\"h-8 w-16\" />\n          <Skeleton className=\"h-3 w-20 mt-2\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n        <CardTitle className=\"text-sm font-medium text-muted-foreground\">{title}</CardTitle>\n        <Icon className=\"h-5 w-5 text-muted-foreground\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-3xl font-semibold\" data-testid={`stat-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n          {value}\n        </div>\n        {subtitle && (\n          <p className=\"text-xs text-muted-foreground mt-1\">{subtitle}</p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ComplianceMetricBar({ label, value, color }: { label: string; value: number; color: string }) {\n  return (\n    <div className=\"space-y-2\">\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-sm font-medium\">{label}</span>\n        <span className=\"text-sm text-muted-foreground\">{value}%</span>\n      </div>\n      <div className=\"h-2 rounded-full bg-muted overflow-hidden\">\n        <div\n          className=\"h-full rounded-full transition-all duration-500\"\n          style={{ width: `${Math.min(value, 100)}%`, backgroundColor: color }}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction ChartSkeleton() {\n  return (\n    <div className=\"flex flex-col gap-4\">\n      <Skeleton className=\"h-[200px] w-full\" />\n    </div>\n  );\n}\n\nexport default function Dashboard() {\n  const { data: employees, isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: servicePosts, isLoading: postsLoading } = useQuery<ServicePost[]>({\n    queryKey: [\"/api/service-posts\"],\n  });\n\n  const { data: allocations, isLoading: allocationsLoading } = useQuery<Allocation[]>({\n    queryKey: [\"/api/allocations\"],\n  });\n\n  const { data: occurrences, isLoading: occurrencesLoading } = useQuery<Occurrence[]>({\n    queryKey: [\"/api/occurrences\"],\n  });\n\n  const { data: documents, isLoading: documentsLoading } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const { data: allocationTrends, isLoading: trendsLoading } = useQuery<AllocationTrend[]>({\n    queryKey: [\"/api/analytics/allocation-trends\"],\n  });\n\n  const { data: occurrencesByCategory, isLoading: categoriesLoading } = useQuery<OccurrenceByCategory[]>({\n    queryKey: [\"/api/analytics/occurrences-by-category\"],\n  });\n\n  const { data: complianceMetrics, isLoading: metricsLoading } = useQuery<ComplianceMetrics>({\n    queryKey: [\"/api/analytics/compliance-metrics\"],\n  });\n\n  const isLoading = employeesLoading || postsLoading || allocationsLoading || occurrencesLoading || documentsLoading;\n\n  const stats = {\n    totalEmployees: employees?.length || 0,\n    activeEmployees: employees?.filter(e => e.status === \"active\").length || 0,\n    totalPosts: servicePosts?.length || 0,\n    todayAllocations: allocations?.filter(a => {\n      const today = new Date().toISOString().split('T')[0];\n      return a.date === today;\n    }).length || 0,\n    presentToday: allocations?.filter(a => {\n      const today = new Date().toISOString().split('T')[0];\n      return a.date === today && a.status === \"present\";\n    }).length || 0,\n    monthOccurrences: occurrences?.filter(o => {\n      const now = new Date();\n      const occDate = new Date(o.date);\n      return occDate.getMonth() === now.getMonth() && occDate.getFullYear() === now.getFullYear();\n    }).length || 0,\n    totalDocuments: documents?.length || 0,\n  };\n\n  const recentOccurrences = occurrences?.slice(0, 5) || [];\n\n  const formattedTrends = allocationTrends?.map(trend => ({\n    ...trend,\n    date: new Date(trend.date).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }),\n  })) || [];\n\n  const categoryLabels: Record<string, string> = {\n    absence: translations.occurrences.absence,\n    substitution: translations.occurrences.substitution,\n    issue: translations.occurrences.issue,\n    note: translations.occurrences.note,\n  };\n\n  const formattedCategories = occurrencesByCategory?.map(cat => ({\n    name: categoryLabels[cat.category] || cat.category,\n    value: cat.count,\n  })) || [];\n\n  return (\n    <div className=\"space-y-8\">\n      <PageHeader\n        title={translations.dashboard.title}\n        description={translations.dashboard.description}\n      />\n\n      <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        <StatCard\n          title={translations.dashboard.totalEmployees}\n          value={stats.totalEmployees}\n          subtitle={`${stats.activeEmployees} ${translations.employees.active.toLowerCase()}s`}\n          icon={Users}\n          isLoading={isLoading}\n        />\n        <StatCard\n          title={translations.dashboard.servicePosts}\n          value={stats.totalPosts}\n          subtitle={translations.dashboard.registeredPosts}\n          icon={Briefcase}\n          isLoading={isLoading}\n        />\n        <StatCard\n          title={translations.dashboard.todayAllocations}\n          value={stats.todayAllocations}\n          subtitle={`${stats.presentToday} ${translations.dashboard.presentToday}`}\n          icon={CalendarDays}\n          isLoading={isLoading}\n        />\n        <StatCard\n          title={translations.dashboard.monthlyOccurrences}\n          value={stats.monthOccurrences}\n          subtitle={translations.dashboard.thisMonth}\n          icon={AlertCircle}\n          isLoading={isLoading}\n        />\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5\" />\n              {translations.dashboard.allocationTrends} ({translations.dashboard.last30Days})\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {trendsLoading ? (\n              <ChartSkeleton />\n            ) : formattedTrends.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n                <BarChart3 className=\"h-8 w-8 text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">{translations.dashboard.noAllocationData}</p>\n              </div>\n            ) : (\n              <div className=\"h-[250px]\" data-testid=\"chart-allocation-trends\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <AreaChart data={formattedTrends} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis \n                      dataKey=\"date\" \n                      tick={{ fontSize: 11 }}\n                      tickLine={false}\n                      axisLine={false}\n                      className=\"text-muted-foreground\"\n                    />\n                    <YAxis \n                      tick={{ fontSize: 11 }}\n                      tickLine={false}\n                      axisLine={false}\n                      className=\"text-muted-foreground\"\n                    />\n                    <Tooltip \n                      contentStyle={{ \n                        backgroundColor: 'hsl(var(--card))',\n                        border: '1px solid hsl(var(--border))',\n                        borderRadius: '6px',\n                      }}\n                      labelStyle={{ color: 'hsl(var(--foreground))' }}\n                    />\n                    <Area \n                      type=\"monotone\" \n                      dataKey=\"present\" \n                      stackId=\"1\" \n                      stroke={CHART_COLORS.present} \n                      fill={CHART_COLORS.present} \n                      fillOpacity={0.6}\n                      name={translations.allocation.present}\n                    />\n                    <Area \n                      type=\"monotone\" \n                      dataKey=\"absent\" \n                      stackId=\"1\" \n                      stroke={CHART_COLORS.absent} \n                      fill={CHART_COLORS.absent} \n                      fillOpacity={0.6}\n                      name={translations.allocation.absent}\n                    />\n                    <Area \n                      type=\"monotone\" \n                      dataKey=\"vacation\" \n                      stackId=\"1\" \n                      stroke={CHART_COLORS.vacation} \n                      fill={CHART_COLORS.vacation} \n                      fillOpacity={0.6}\n                      name={translations.allocation.vacation}\n                    />\n                    <Area \n                      type=\"monotone\" \n                      dataKey=\"medical_leave\" \n                      stackId=\"1\" \n                      stroke={CHART_COLORS.medical_leave} \n                      fill={CHART_COLORS.medical_leave} \n                      fillOpacity={0.6}\n                      name={translations.allocation.medicalLeave}\n                    />\n                  </AreaChart>\n                </ResponsiveContainer>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <PieChart className=\"h-5 w-5\" />\n              {translations.dashboard.occurrencesByCategory} ({translations.dashboard.last30Days})\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {categoriesLoading ? (\n              <ChartSkeleton />\n            ) : formattedCategories.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n                <PieChart className=\"h-8 w-8 text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">{translations.dashboard.noOccurrenceData}</p>\n              </div>\n            ) : (\n              <div className=\"h-[250px]\" data-testid=\"chart-occurrences-category\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <RechartsPieChart>\n                    <Pie\n                      data={formattedCategories}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      innerRadius={50}\n                      outerRadius={80}\n                      paddingAngle={5}\n                      dataKey=\"value\"\n                      label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\n                      labelLine={false}\n                    >\n                      {formattedCategories.map((_, index) => (\n                        <Cell key={`cell-${index}`} fill={CATEGORY_COLORS[index % CATEGORY_COLORS.length]} />\n                      ))}\n                    </Pie>\n                    <Tooltip\n                      contentStyle={{ \n                        backgroundColor: 'hsl(var(--card))',\n                        border: '1px solid hsl(var(--border))',\n                        borderRadius: '6px',\n                      }}\n                    />\n                    <Legend />\n                  </RechartsPieChart>\n                </ResponsiveContainer>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              {translations.dashboard.complianceMetrics}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {metricsLoading ? (\n              <div className=\"space-y-4\">\n                <Skeleton className=\"h-8 w-full\" />\n                <Skeleton className=\"h-8 w-full\" />\n                <Skeleton className=\"h-8 w-full\" />\n                <Skeleton className=\"h-8 w-full\" />\n              </div>\n            ) : (\n              <div className=\"space-y-4\" data-testid=\"compliance-metrics\">\n                <ComplianceMetricBar \n                  label={translations.dashboard.attendanceRate}\n                  value={complianceMetrics?.attendanceRate || 0} \n                  color=\"hsl(var(--chart-1))\"\n                />\n                <ComplianceMetricBar \n                  label={translations.dashboard.documentationRate}\n                  value={complianceMetrics?.documentationRate || 0} \n                  color=\"hsl(var(--chart-2))\"\n                />\n                <ComplianceMetricBar \n                  label={translations.dashboard.activeEmployeeRate}\n                  value={complianceMetrics?.activeEmployeeRate || 0} \n                  color=\"hsl(var(--chart-3))\"\n                />\n                <div className=\"pt-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm font-medium\">{translations.dashboard.occurrencesPerEmployee}</span>\n                    <span className=\"text-sm text-muted-foreground\">{complianceMetrics?.occurrenceRate || 0}</span>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground mt-1\">{translations.dashboard.average30Days}</p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              {translations.dashboard.quickStats}\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex h-9 w-9 items-center justify-center rounded-md bg-primary/10\">\n                  <FileText className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium\">{translations.dashboard.documents}</p>\n                  <p className=\"text-xs text-muted-foreground\">{translations.dashboard.totalUploaded}</p>\n                </div>\n              </div>\n              <span className=\"text-2xl font-semibold\">{stats.totalDocuments}</span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex h-9 w-9 items-center justify-center rounded-md bg-primary/10\">\n                  <CheckCircle className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium\">{translations.dashboard.activeRate}</p>\n                  <p className=\"text-xs text-muted-foreground\">{translations.dashboard.employeeStatus}</p>\n                </div>\n              </div>\n              <span className=\"text-2xl font-semibold\">\n                {stats.totalEmployees > 0 \n                  ? Math.round((stats.activeEmployees / stats.totalEmployees) * 100) \n                  : 0}%\n              </span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex h-9 w-9 items-center justify-center rounded-md bg-primary/10\">\n                  <Clock className=\"h-4 w-4 text-primary\" />\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium\">{translations.dashboard.attendance}</p>\n                  <p className=\"text-xs text-muted-foreground\">{translations.dashboard.todayRate}</p>\n                </div>\n              </div>\n              <span className=\"text-2xl font-semibold\">\n                {stats.todayAllocations > 0 \n                  ? Math.round((stats.presentToday / stats.todayAllocations) * 100) \n                  : 0}%\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <AlertCircle className=\"h-5 w-5\" />\n              {translations.dashboard.recentOccurrences}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {recentOccurrences.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n                <AlertCircle className=\"h-8 w-8 text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">{translations.dashboard.noRecentOccurrences}</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {recentOccurrences.map((occurrence) => (\n                  <div\n                    key={occurrence.id}\n                    className=\"flex items-start gap-3 rounded-md border p-3\"\n                    data-testid={`occurrence-item-${occurrence.id}`}\n                  >\n                    <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-muted\">\n                      <AlertCircle className=\"h-4 w-4 text-muted-foreground\" />\n                    </div>\n                    <div className=\"flex-1 overflow-hidden\">\n                      <p className=\"text-sm font-medium truncate\">\n                        {categoryLabels[occurrence.category] || occurrence.category}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground truncate\">{occurrence.description}</p>\n                      <p className=\"text-xs text-muted-foreground mt-1\">\n                        {new Date(occurrence.date).toLocaleDateString('pt-BR')}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19710,"size_tokens":null},"client/src/pages/service-posts/service-post-view.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { ArrowLeft, Pencil, Users, FileText, UserPlus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { formatDate } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport type { ServicePost, Allocation, Document, Employee } from \"@shared/schema\";\n\ninterface ServicePostViewProps {\n  postId: number;\n}\n\nexport default function ServicePostView({ postId }: ServicePostViewProps) {\n  const { isAdmin } = useAuth();\n\n  const { data: servicePost, isLoading } = useQuery<ServicePost>({\n    queryKey: [\"/api/service-posts\", postId],\n  });\n\n  const { data: documents } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const { data: allocations } = useQuery<Allocation[]>({\n    queryKey: [\"/api/allocations\"],\n  });\n\n  const { data: employees } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const postDocuments = documents?.filter(d => d.postId === postId) || [];\n  const postAllocations = allocations?.filter(a => a.postId === postId).slice(0, 10) || [];\n  const linkedEmployees = employees?.filter(e => e.linkedPostId === postId) || [];\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title={translations.common.loading} />\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"space-y-4\">\n              <Skeleton className=\"h-8 w-48\" />\n              <Skeleton className=\"h-4 w-32\" />\n              <Skeleton className=\"h-4 w-64\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!servicePost) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title=\"Posto de Serviço Não Encontrado\" />\n        <Card>\n          <CardContent className=\"p-6\">\n            <p className=\"text-muted-foreground\">O posto de serviço solicitado não foi encontrado.</p>\n            <Button asChild className=\"mt-4\">\n              <Link href=\"/service-posts\">{translations.common.back} {translations.servicePosts.title}</Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={servicePost.postName}\n        description=\"Detalhes e alocações do posto de serviço\"\n      >\n        <Button variant=\"outline\" asChild data-testid=\"button-back\">\n          <Link href=\"/service-posts\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            {translations.common.back}\n          </Link>\n        </Button>\n        {isAdmin && (\n          <Button asChild data-testid=\"button-edit\">\n            <Link href={`/service-posts/${postId}/edit`}>\n              <Pencil className=\"h-4 w-4 mr-2\" />\n              {translations.common.edit}\n            </Link>\n          </Button>\n        )}\n      </PageHeader>\n\n      <div className=\"grid gap-6 lg:grid-cols-3\">\n        <Card className=\"lg:col-span-2\">\n          <CardHeader>\n            <CardTitle>Informações do Posto de Serviço</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid gap-4 sm:grid-cols-2\">\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.postCode}</p>\n                <p className=\"text-base font-mono\" data-testid=\"text-post-code\">{servicePost.postCode}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.modality}</p>\n                <div className=\"mt-1\">\n                  <StatusBadge status={servicePost.modality} />\n                </div>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.postName}</p>\n                <p className=\"text-base\" data-testid=\"text-post-name\">{servicePost.postName}</p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.common.unit}</p>\n                <p className=\"text-base\" data-testid=\"text-post-unit\">{servicePost.unit}</p>\n              </div>\n              <div className=\"sm:col-span-2\">\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.common.description}</p>\n                <p className=\"text-base\" data-testid=\"text-post-description\">\n                  {servicePost.description || \"Nenhuma descrição fornecida\"}\n                </p>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.createdAt}</p>\n                <p className=\"text-base\">{servicePost.createdAt ? formatDate(servicePost.createdAt) : \"N/A\"}</p>\n              </div>\n            </div>\n\n            <div className=\"border-t pt-4 mt-4\">\n              <h4 className=\"text-sm font-semibold mb-4\">Anexo 1A - Dados Contratuais</h4>\n              <div className=\"grid gap-4 sm:grid-cols-2\">\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.tipoPosto}</p>\n                  <p className=\"text-base\" data-testid=\"text-tipo-posto\">{servicePost.tipoPosto || \"Não informado\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.horarioTrabalho}</p>\n                  <p className=\"text-base\" data-testid=\"text-horario-trabalho\">{servicePost.horarioTrabalho || \"Não informado\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.escalaRegime}</p>\n                  <p className=\"text-base\" data-testid=\"text-escala-regime\">{servicePost.escalaRegime || \"Não informado\"}</p>\n                </div>\n                <div>\n                  <p className=\"text-sm font-medium text-muted-foreground\">{translations.servicePosts.quantidadePrevista}</p>\n                  <p className=\"text-base\" data-testid=\"text-quantidade-prevista\">{servicePost.quantidadePrevista ?? \"Não informado\"}</p>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"h-5 w-5\" />\n              {translations.documents.title}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {postDocuments.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground\">Nenhum documento anexado</p>\n            ) : (\n              <div className=\"space-y-2\">\n                {postDocuments.map((doc) => (\n                  <div key={doc.id} className=\"flex items-center gap-2 text-sm\">\n                    <FileText className=\"h-4 w-4 text-muted-foreground\" />\n                    <span className=\"truncate\">{doc.originalName}</span>\n                  </div>\n                ))}\n              </div>\n            )}\n            <Button variant=\"outline\" size=\"sm\" className=\"mt-4 w-full\" asChild>\n              <Link href={`/documents?postId=${postId}`}>Ver Todos os Documentos</Link>\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Funcionários Vinculados\n            <Badge variant=\"secondary\" className=\"ml-2\">{linkedEmployees.length}</Badge>\n          </CardTitle>\n          {isAdmin && (\n            <Button size=\"sm\" asChild data-testid=\"button-add-employee\">\n              <Link href={`/employees/new?linkedPostId=${postId}`}>\n                <UserPlus className=\"h-4 w-4 mr-2\" />\n                Adicionar Funcionário\n              </Link>\n            </Button>\n          )}\n        </CardHeader>\n        <CardContent>\n          {linkedEmployees.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">Nenhum funcionário vinculado a este posto</p>\n          ) : (\n            <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\n              {linkedEmployees.map((employee) => (\n                <Link key={employee.id} href={`/employees/${employee.id}`}>\n                  <div \n                    className=\"flex items-center justify-between rounded-md border p-3 hover-elevate cursor-pointer\"\n                    data-testid={`card-employee-${employee.id}`}\n                  >\n                    <div>\n                      <p className=\"text-sm font-medium\">{employee.name}</p>\n                      <p className=\"text-xs text-muted-foreground\">{employee.functionPost}</p>\n                    </div>\n                    <StatusBadge status={employee.status} />\n                  </div>\n                </Link>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Users className=\"h-5 w-5\" />\n            Alocações Recentes\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {postAllocations.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">Nenhuma alocação encontrada para este posto</p>\n          ) : (\n            <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\n              {postAllocations.map((allocation) => (\n                <div key={allocation.id} className=\"flex items-center justify-between rounded-md border p-3\">\n                  <div>\n                    <p className=\"text-sm font-medium\">{formatDate(allocation.date)}</p>\n                    <p className=\"text-xs text-muted-foreground\">ID Funcionário: {allocation.employeeId}</p>\n                  </div>\n                  <StatusBadge status={allocation.status} />\n                </div>\n              ))}\n            </div>\n          )}\n          <Button variant=\"outline\" size=\"sm\" className=\"mt-4\" asChild>\n            <Link href=\"/allocation\">Ver Todas as Alocações</Link>\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10694,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { DevRoleProvider } from \"@/contexts/DevRoleContext\";\nimport { DevRoleSwitcher } from \"@/components/dev-role-switcher\";\n\nimport Landing from \"@/pages/landing\";\nimport Dashboard from \"@/pages/dashboard\";\nimport NotFound from \"@/pages/not-found\";\nimport EmployeesIndex from \"@/pages/employees/index\";\nimport EmployeeForm from \"@/pages/employees/employee-form\";\nimport EmployeeView from \"@/pages/employees/employee-view\";\nimport ServicePostsIndex from \"@/pages/service-posts/index\";\nimport ServicePostForm from \"@/pages/service-posts/service-post-form\";\nimport ServicePostView from \"@/pages/service-posts/service-post-view\";\nimport Allocation from \"@/pages/allocation\";\nimport OccurrencesIndex from \"@/pages/occurrences/index\";\nimport DocumentsIndex from \"@/pages/documents/index\";\nimport Reports from \"@/pages/reports\";\nimport Notifications from \"@/pages/notifications/index\";\nimport Admin from \"@/pages/admin\";\nimport Auditoria from \"@/pages/auditoria\";\nimport LgpdLogs from \"@/pages/lgpd-logs\";\nimport FeriasLicencasIndex from \"@/pages/ferias-licencas/index\";\nimport AlertsIndex from \"@/pages/alerts/index\";\n\nfunction AuthenticatedRouter() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/employees\" component={EmployeesIndex} />\n      <Route path=\"/employees/new\" component={EmployeeForm} />\n      <Route path=\"/employees/:id\" component={EmployeeView} />\n      <Route path=\"/employees/:id/edit\" component={EmployeeForm} />\n      <Route path=\"/service-posts\" component={ServicePostsIndex} />\n      <Route path=\"/service-posts/new\" component={ServicePostForm} />\n      <Route path=\"/service-posts/:id\" component={ServicePostView} />\n      <Route path=\"/service-posts/:id/edit\" component={ServicePostForm} />\n      <Route path=\"/allocation\" component={Allocation} />\n      <Route path=\"/occurrences\" component={OccurrencesIndex} />\n      <Route path=\"/documents\" component={DocumentsIndex} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/notifications\" component={Notifications} />\n      <Route path=\"/admin\" component={Admin} />\n      <Route path=\"/auditoria\" component={Auditoria} />\n      <Route path=\"/lgpd-logs\" component={LgpdLogs} />\n      <Route path=\"/ferias-licencas\" component={FeriasLicencasIndex} />\n      <Route path=\"/alerts\" component={AlertsIndex} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AuthenticatedLayout() {\n  const sidebarStyle = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={sidebarStyle as React.CSSProperties}>\n      <div className=\"flex h-screen w-full\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1 overflow-hidden\">\n          <header className=\"flex items-center justify-between gap-4 p-3 border-b bg-background sticky top-0 z-40\">\n            <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n            <ThemeToggle />\n          </header>\n          <main className=\"flex-1 overflow-auto\">\n            <AuthenticatedRouter />\n          </main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction LoadingScreen() {\n  return (\n    <div className=\"flex h-screen w-full items-center justify-center bg-background\">\n      <div className=\"flex flex-col items-center gap-4\">\n        <Skeleton className=\"h-12 w-12 rounded-md\" />\n        <Skeleton className=\"h-4 w-32\" />\n      </div>\n    </div>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated, isLoading } = useAuth();\n\n  if (isLoading) {\n    return <LoadingScreen />;\n  }\n\n  if (!isAuthenticated) {\n    return <Landing />;\n  }\n\n  return <AuthenticatedLayout />;\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"system\" storageKey=\"gestao-contratual-theme\">\n        <TooltipProvider>\n          {/* DevRoleProvider wraps the app to enable role switching in development */}\n          <DevRoleProvider>\n            <AppContent />\n            {/* DevRoleSwitcher only renders in development mode */}\n            <DevRoleSwitcher />\n          </DevRoleProvider>\n          <Toaster />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":4854,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});","path":null,"size_bytes":1416,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/data-table.tsx":{"content":"import {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { FileQuestion } from \"lucide-react\";\n\ninterface Column<T> {\n  key: string;\n  header: string;\n  cell: (item: T) => React.ReactNode;\n  className?: string;\n}\n\ninterface DataTableProps<T> {\n  columns: Column<T>[];\n  data: T[];\n  isLoading?: boolean;\n  emptyMessage?: string;\n  emptyDescription?: string;\n  testIdPrefix?: string;\n}\n\nexport function DataTable<T extends { id: number | string }>({\n  columns,\n  data,\n  isLoading,\n  emptyMessage = \"No data found\",\n  emptyDescription = \"There are no records to display.\",\n  testIdPrefix = \"table\",\n}: DataTableProps<T>) {\n  if (isLoading) {\n    return (\n      <div className=\"rounded-md border\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              {columns.map((column) => (\n                <TableHead key={column.key} className={column.className}>\n                  {column.header}\n                </TableHead>\n              ))}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {Array.from({ length: 5 }).map((_, i) => (\n              <TableRow key={i}>\n                {columns.map((column) => (\n                  <TableCell key={column.key} className={column.className}>\n                    <Skeleton className=\"h-5 w-full\" />\n                  </TableCell>\n                ))}\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    );\n  }\n\n  if (data.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center rounded-md border border-dashed py-16 px-4\">\n        <div className=\"flex h-16 w-16 items-center justify-center rounded-full bg-muted\">\n          <FileQuestion className=\"h-8 w-8 text-muted-foreground\" />\n        </div>\n        <h3 className=\"mt-4 text-lg font-medium\" data-testid={`${testIdPrefix}-empty-title`}>\n          {emptyMessage}\n        </h3>\n        <p className=\"mt-1 text-sm text-muted-foreground text-center max-w-sm\" data-testid={`${testIdPrefix}-empty-description`}>\n          {emptyDescription}\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"rounded-md border overflow-hidden\">\n      <div className=\"overflow-x-auto\">\n        <Table>\n          <TableHeader>\n            <TableRow className=\"bg-muted/50\">\n              {columns.map((column) => (\n                <TableHead key={column.key} className={column.className}>\n                  {column.header}\n                </TableHead>\n              ))}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {data.map((item) => (\n              <TableRow\n                key={item.id}\n                className=\"hover-elevate\"\n                data-testid={`${testIdPrefix}-row-${item.id}`}\n              >\n                {columns.map((column) => (\n                  <TableCell key={column.key} className={column.className}>\n                    {column.cell(item)}\n                  </TableCell>\n                ))}\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3213,"size_tokens":null},"client/src/pages/employees/employee-form.tsx":{"content":"import { useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { z } from \"zod\";\nimport { CalendarIcon } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatCPF } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport { cn } from \"@/lib/utils\";\nimport type { Employee, ServicePost } from \"@shared/schema\";\n\nconst formSchema = z.object({\n  name: z.string().min(2, translations.validation.minLength.replace(\"{min}\", \"2\")),\n  cpf: z.string().regex(/^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$/, translations.validation.invalidCpf),\n  functionPost: z.string().min(2, translations.validation.required),\n  unit: z.string().min(2, translations.validation.required),\n  status: z.enum([\"active\", \"inactive\"]),\n  admissionDate: z.string().optional().nullable(),\n  linkedPostId: z.number().optional().nullable(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface EmployeeFormProps {\n  employeeId?: number;\n}\n\nexport default function EmployeeForm({ employeeId }: EmployeeFormProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const isEditing = !!employeeId;\n\n  const { data: employee, isLoading } = useQuery<Employee>({\n    queryKey: [\"/api/employees\", employeeId],\n    enabled: isEditing,\n  });\n\n  const { data: servicePosts } = useQuery<ServicePost[]>({\n    queryKey: [\"/api/service-posts\"],\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      name: \"\",\n      cpf: \"\",\n      functionPost: \"\",\n      unit: \"\",\n      status: \"active\",\n      admissionDate: null,\n      linkedPostId: null,\n    },\n  });\n\n  useEffect(() => {\n    if (employee) {\n      form.reset({\n        name: employee.name,\n        cpf: employee.cpf,\n        functionPost: employee.functionPost,\n        unit: employee.unit,\n        status: employee.status,\n        admissionDate: employee.admissionDate || null,\n        linkedPostId: employee.linkedPostId || null,\n      });\n    }\n  }, [employee, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      if (isEditing) {\n        await apiRequest(\"PATCH\", `/api/employees/${employeeId}`, data);\n      } else {\n        await apiRequest(\"POST\", \"/api/employees\", data);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      toast({\n        title: translations.common.success,\n        description: isEditing ? translations.employees.employeeUpdated : translations.employees.employeeCreated,\n      });\n      setLocation(\"/employees\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: translations.common.error,\n        description: error.message || translations.errors.saveError,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCPFChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const formatted = formatCPF(e.target.value);\n    form.setValue(\"cpf\", formatted);\n  };\n\n  if (isEditing && isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title={translations.common.loading} />\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"animate-pulse space-y-4\">\n              <div className=\"h-10 bg-muted rounded\" />\n              <div className=\"h-10 bg-muted rounded\" />\n              <div className=\"h-10 bg-muted rounded\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={isEditing ? translations.employees.editEmployee : translations.employees.addEmployee}\n        description={isEditing ? translations.employees.editEmployee : translations.employees.addEmployee}\n      />\n\n      <Card className=\"max-w-3xl\">\n        <CardHeader>\n          <CardTitle>{translations.employees.title}</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-6\">\n              <div className=\"grid gap-6 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  render={({ field }) => (\n                    <FormItem className=\"sm:col-span-2\">\n                      <FormLabel>{translations.employees.name} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder={translations.employees.name} {...field} data-testid=\"input-employee-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"cpf\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.employees.cpf} *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"000.000.000-00\"\n                          {...field}\n                          onChange={handleCPFChange}\n                          maxLength={14}\n                          className=\"font-mono\"\n                          data-testid=\"input-employee-cpf\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"status\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.employees.status} *</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-employee-status\">\n                            <SelectValue placeholder={translations.common.selectOption} />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"active\">{translations.employees.active}</SelectItem>\n                          <SelectItem value=\"inactive\">{translations.employees.inactive}</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"functionPost\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.employees.functionPost} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder={translations.employees.functionPost} {...field} data-testid=\"input-employee-function\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"unit\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.employees.unit} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder={translations.employees.unit} {...field} data-testid=\"input-employee-unit\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"admissionDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Data de Admissão</FormLabel>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              className={cn(\n                                \"w-full pl-3 text-left font-normal\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              data-testid=\"button-admission-date\"\n                            >\n                              {field.value ? (\n                                format(new Date(field.value), \"dd/MM/yyyy\", { locale: ptBR })\n                              ) : (\n                                <span>Selecione uma data</span>\n                              )}\n                              <CalendarIcon className=\"ml-auto h-4 w-4 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                          <Calendar\n                            mode=\"single\"\n                            selected={field.value ? new Date(field.value) : undefined}\n                            onSelect={(date) => field.onChange(date ? format(date, \"yyyy-MM-dd\") : null)}\n                            disabled={(date) => date > new Date()}\n                            initialFocus\n                          />\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"linkedPostId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Posto Vinculado</FormLabel>\n                      <Select \n                        onValueChange={(value) => field.onChange(value === \"none\" ? null : parseInt(value, 10))} \n                        value={field.value ? field.value.toString() : \"none\"}\n                      >\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-linked-post\">\n                            <SelectValue placeholder=\"Selecione um posto\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"none\">Nenhum posto vinculado</SelectItem>\n                          {servicePosts?.map((post) => (\n                            <SelectItem key={post.id} value={post.id.toString()}>\n                              {post.postCode} - {post.postName}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation(\"/employees\")}\n                  data-testid=\"button-cancel\"\n                >\n                  {translations.common.cancel}\n                </Button>\n                <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                  {mutation.isPending ? translations.common.loading : isEditing ? translations.common.update : translations.common.save}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":12525,"size_tokens":null},"client/src/pages/documents/document-upload-dialog.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Upload, X, FileText, Calendar } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { getMonthYearOptions } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport type { Employee, ServicePost } from \"@shared/schema\";\n\ninterface DocumentUploadDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  employees: Employee[];\n  servicePosts: ServicePost[];\n}\n\nexport function DocumentUploadDialog({ open, onOpenChange, employees, servicePosts }: DocumentUploadDialogProps) {\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [documentType, setDocumentType] = useState<string>(\"other\");\n  const [linkType, setLinkType] = useState<string>(\"none\");\n  const [linkedId, setLinkedId] = useState<string>(\"\");\n  const [monthYear, setMonthYear] = useState<string>(\"\");\n  const [expirationDate, setExpirationDate] = useState<string>(\"\");\n\n  const monthYearOptions = getMonthYearOptions();\n\n  const uploadMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedFile) throw new Error(translations.validation.fileRequired);\n\n      const formData = new FormData();\n      formData.append(\"file\", selectedFile);\n      formData.append(\"documentType\", documentType);\n\n      if (linkType === \"employee\" && linkedId) {\n        formData.append(\"employeeId\", linkedId);\n      } else if (linkType === \"post\" && linkedId) {\n        formData.append(\"postId\", linkedId);\n      } else if (linkType === \"month\" && monthYear) {\n        formData.append(\"monthYear\", monthYear);\n      }\n\n      if (expirationDate) {\n        formData.append(\"expirationDate\", expirationDate);\n      }\n\n      const response = await fetch(\"/api/documents/upload\", {\n        method: \"POST\",\n        body: formData,\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({}));\n        throw new Error(error.message || translations.documents.uploadFailed);\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents/expiring\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents/expired\"] });\n      toast({ title: translations.common.success, description: translations.documents.documentUploaded });\n      handleClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: translations.common.error,\n        description: error.message || translations.errors.saveError,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      if (file.size > 10 * 1024 * 1024) {\n        toast({ title: translations.common.error, description: translations.validation.fileTooLarge.replace(\"{max}\", \"10\"), variant: \"destructive\" });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  const handleClose = () => {\n    setSelectedFile(null);\n    setDocumentType(\"other\");\n    setLinkType(\"none\");\n    setLinkedId(\"\");\n    setMonthYear(\"\");\n    setExpirationDate(\"\");\n    onOpenChange(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    const file = e.dataTransfer.files?.[0];\n    if (file) {\n      if (file.size > 10 * 1024 * 1024) {\n        toast({ title: translations.common.error, description: translations.validation.fileTooLarge.replace(\"{max}\", \"10\"), variant: \"destructive\" });\n        return;\n      }\n      setSelectedFile(file);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>{translations.documents.uploadDocument}</DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div\n            className=\"flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 cursor-pointer transition-colors hover:border-primary/50\"\n            onDragOver={(e) => e.preventDefault()}\n            onDrop={handleDrop}\n            onClick={() => fileInputRef.current?.click()}\n            data-testid=\"drop-zone\"\n          >\n            {selectedFile ? (\n              <div className=\"flex items-center gap-2\">\n                <FileText className=\"h-8 w-8 text-primary\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium truncate max-w-[200px]\">{selectedFile.name}</p>\n                  <p className=\"text-xs text-muted-foreground\">{(selectedFile.size / 1024).toFixed(1)} KB</p>\n                </div>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    setSelectedFile(null);\n                  }}\n                  data-testid=\"button-remove-file\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ) : (\n              <>\n                <Upload className=\"h-8 w-8 text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">{translations.common.dragDrop}</p>\n                <p className=\"text-xs text-muted-foreground mt-1\">{translations.documents.acceptedFormats}</p>\n              </>\n            )}\n          </div>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept=\".pdf,.png,.jpg,.jpeg,.gif,.webp\"\n            className=\"hidden\"\n            onChange={handleFileChange}\n            data-testid=\"input-file\"\n          />\n\n          <div className=\"space-y-2\">\n            <Label>{translations.documents.type}</Label>\n            <Select value={documentType} onValueChange={setDocumentType}>\n              <SelectTrigger data-testid=\"select-doc-type\">\n                <SelectValue placeholder={translations.common.selectOption} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"aso\">{translations.documents.aso}</SelectItem>\n                <SelectItem value=\"certification\">{translations.documents.certification}</SelectItem>\n                <SelectItem value=\"evidence\">{translations.documents.evidence}</SelectItem>\n                <SelectItem value=\"contract\">{translations.documents.contract}</SelectItem>\n                <SelectItem value=\"other\">{translations.documents.other}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label>{translations.documents.linkTo}</Label>\n            <Select value={linkType} onValueChange={(v) => { setLinkType(v); setLinkedId(\"\"); setMonthYear(\"\"); }}>\n              <SelectTrigger data-testid=\"select-link-type\">\n                <SelectValue placeholder={translations.common.selectOption} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"none\">{translations.documents.none}</SelectItem>\n                <SelectItem value=\"employee\">{translations.documents.employee}</SelectItem>\n                <SelectItem value=\"post\">{translations.documents.post}</SelectItem>\n                <SelectItem value=\"month\">{translations.documents.monthlyEvidence}</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {linkType === \"employee\" && (\n            <div className=\"space-y-2\">\n              <Label>{translations.documents.selectEmployee}</Label>\n              <Select value={linkedId} onValueChange={setLinkedId}>\n                <SelectTrigger data-testid=\"select-link-employee\">\n                  <SelectValue placeholder={translations.common.selectOption} />\n                </SelectTrigger>\n                <SelectContent>\n                  {employees.map((emp) => (\n                    <SelectItem key={emp.id} value={emp.id.toString()}>\n                      {emp.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n\n          {linkType === \"post\" && (\n            <div className=\"space-y-2\">\n              <Label>{translations.documents.selectServicePost}</Label>\n              <Select value={linkedId} onValueChange={setLinkedId}>\n                <SelectTrigger data-testid=\"select-link-post\">\n                  <SelectValue placeholder={translations.common.selectOption} />\n                </SelectTrigger>\n                <SelectContent>\n                  {servicePosts.map((post) => (\n                    <SelectItem key={post.id} value={post.id.toString()}>\n                      {post.postCode} - {post.postName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n\n          {linkType === \"month\" && (\n            <div className=\"space-y-2\">\n              <Label>{translations.documents.selectMonthYear}</Label>\n              <Select value={monthYear} onValueChange={setMonthYear}>\n                <SelectTrigger data-testid=\"select-link-month\">\n                  <SelectValue placeholder={translations.common.selectOption} />\n                </SelectTrigger>\n                <SelectContent>\n                  {monthYearOptions.map((opt) => (\n                    <SelectItem key={opt.value} value={opt.value}>\n                      {opt.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label>{translations.documents.expirationDate} ({translations.common.optional})</Label>\n            <div className=\"relative\">\n              <Calendar className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                type=\"date\"\n                value={expirationDate}\n                onChange={(e) => setExpirationDate(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-expiration-date\"\n              />\n            </div>\n            <p className=\"text-xs text-muted-foreground\">\n              {translations.documents.setExpirationHint}\n            </p>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleClose} data-testid=\"button-cancel\">\n            {translations.common.cancel}\n          </Button>\n          <Button\n            onClick={() => uploadMutation.mutate()}\n            disabled={!selectedFile || uploadMutation.isPending}\n            data-testid=\"button-upload\"\n          >\n            {uploadMutation.isPending ? translations.common.sending : translations.common.uploadFile}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":11480,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/pages/allocation.tsx":{"content":"import { useState, useMemo, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { format, startOfMonth, endOfMonth, eachDayOfInterval, subMonths } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { ChevronLeft, ChevronRight, Save, Upload, Copy, Download, Wand2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport type { Employee, ServicePost, Allocation } from \"@shared/schema\";\n\nconst allocationStatuses = [\"present\", \"absent\", \"justified\", \"vacation\", \"medical_leave\"] as const;\n\nconst statusLabels: Record<string, string> = {\n  present: translations.allocation.present,\n  absent: translations.allocation.absent,\n  justified: translations.allocation.justified,\n  vacation: translations.allocation.vacation,\n  medical_leave: translations.allocation.medicalLeave,\n};\n\nexport default function AllocationPage() {\n  const { isAdmin } = useAuth();\n  const { toast } = useToast();\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [selectedPost, setSelectedPost] = useState<string>(\"\");\n  const [editedAllocations, setEditedAllocations] = useState<Map<string, string>>(new Map());\n  const [csvDialogOpen, setCsvDialogOpen] = useState(false);\n  const [copyDialogOpen, setCopyDialogOpen] = useState(false);\n  const [bulkFillDialogOpen, setBulkFillDialogOpen] = useState(false);\n  const [bulkFillDay, setBulkFillDay] = useState<string>(\"\");\n  const [bulkFillStatus, setBulkFillStatus] = useState<string>(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const { data: employees, isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: servicePosts, isLoading: postsLoading } = useQuery<ServicePost[]>({\n    queryKey: [\"/api/service-posts\"],\n  });\n\n  const monthStart = startOfMonth(currentDate);\n  const monthEnd = endOfMonth(currentDate);\n  const daysInMonth = eachDayOfInterval({ start: monthStart, end: monthEnd });\n\n  const startDateStr = format(monthStart, \"yyyy-MM-dd\");\n  const endDateStr = format(monthEnd, \"yyyy-MM-dd\");\n  const currentMonthStr = format(currentDate, \"yyyy-MM\");\n  const previousMonthDate = subMonths(currentDate, 1);\n  const previousMonthStr = format(previousMonthDate, \"yyyy-MM\");\n\n  const { data: allocations, isLoading: allocationsLoading } = useQuery<Allocation[]>({\n    queryKey: [\"/api/allocations\", { startDate: startDateStr, endDate: endDateStr }],\n    queryFn: async () => {\n      const res = await fetch(`/api/allocations?startDate=${startDateStr}&endDate=${endDateStr}`, {\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        throw new Error(translations.allocation.loadError);\n      }\n      return res.json();\n    },\n  });\n\n  const activeEmployees = useMemo(() => \n    employees?.filter(e => e.status === \"active\") || [],\n    [employees]\n  );\n\n  const saveMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedPost) {\n        throw new Error(translations.allocation.selectPostFirst);\n      }\n      const updates = Array.from(editedAllocations.entries()).map(([key, status]) => {\n        const [employeeId, date] = key.split(\"_\");\n        return {\n          employeeId: parseInt(employeeId),\n          postId: parseInt(selectedPost),\n          date,\n          status,\n        };\n      });\n\n      for (const update of updates) {\n        await apiRequest(\"POST\", \"/api/allocations\", update);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/allocations\"] });\n      toast({ title: translations.common.success, description: translations.allocation.allocationUpdated });\n      setEditedAllocations(new Map());\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.saveError, variant: \"destructive\" });\n    },\n  });\n\n  const copyMonthMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedPost) {\n        throw new Error(translations.allocation.selectPostFirst);\n      }\n      const response = await apiRequest(\"POST\", \"/api/allocations/copy-month\", {\n        sourceMonth: previousMonthStr,\n        targetMonth: currentMonthStr,\n        postId: selectedPost,\n      });\n      return response.json();\n    },\n    onSuccess: (data: { count: number }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/allocations\"] });\n      toast({ \n        title: translations.common.success, \n        description: translations.allocation.allocationsCopied.replace(\"{count}\", String(data.count))\n      });\n      setCopyDialogOpen(false);\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: translations.common.error, \n        description: error.message || translations.errors.generic, \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const csvImportMutation = useMutation({\n    mutationFn: async (file: File) => {\n      if (!selectedPost) {\n        throw new Error(translations.allocation.selectPostFirst);\n      }\n      const formData = new FormData();\n      formData.append(\"file\", file);\n      formData.append(\"postId\", selectedPost);\n      formData.append(\"month\", currentMonthStr);\n\n      const response = await fetch(\"/api/allocations/import-csv\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || translations.allocation.importCsvFailed);\n      }\n\n      return response.json();\n    },\n    onSuccess: (data: { imported: number; errors?: string[] }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/allocations\"] });\n      let description = translations.allocation.allocationsImported.replace(\"{count}\", String(data.imported));\n      if (data.errors && data.errors.length > 0) {\n        description += `. ${translations.allocation.linesWithErrors.replace(\"{count}\", String(data.errors.length))}`;\n      }\n      toast({ title: translations.common.success, description });\n      setCsvDialogOpen(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: translations.common.error, \n        description: error.message || translations.allocation.importCsvFailed, \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const handleFileUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      csvImportMutation.mutate(file);\n    }\n  };\n\n  const downloadTemplate = () => {\n    const csvContent = \"employee_id,date,status\\n1,2024-01-01,present\\n2,2024-01-01,absent\";\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"modelo_alocacao.csv\";\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  };\n\n  const getAllocationStatus = (employeeId: number, date: Date): string | null => {\n    const dateStr = format(date, \"yyyy-MM-dd\");\n    const editKey = `${employeeId}_${dateStr}`;\n    \n    if (editedAllocations.has(editKey)) {\n      return editedAllocations.get(editKey) || null;\n    }\n    \n    const allocation = allocations?.find(\n      a => a.employeeId === employeeId && a.date === dateStr\n    );\n    return allocation?.status || null;\n  };\n\n  const handleStatusChange = (employeeId: number, date: Date, status: string) => {\n    const dateStr = format(date, \"yyyy-MM-dd\");\n    const key = `${employeeId}_${dateStr}`;\n    setEditedAllocations(prev => new Map(prev).set(key, status));\n  };\n\n  const handleBulkFill = () => {\n    if (!bulkFillDay || !bulkFillStatus) {\n      toast({ \n        title: translations.common.error, \n        description: \"Selecione o dia e o status para preencher\", \n        variant: \"destructive\" \n      });\n      return;\n    }\n    const newAllocations = new Map(editedAllocations);\n    activeEmployees.forEach((employee) => {\n      const key = `${employee.id}_${bulkFillDay}`;\n      newAllocations.set(key, bulkFillStatus);\n    });\n    setEditedAllocations(newAllocations);\n    toast({ \n      title: \"Alterações pendentes\", \n      description: `Status \"${statusLabels[bulkFillStatus]}\" aplicado para ${activeEmployees.length} funcionários. Clique em \"Salvar Alterações\" para confirmar.` \n    });\n    setBulkFillDialogOpen(false);\n    setBulkFillDay(\"\");\n    setBulkFillStatus(\"\");\n  };\n\n  const previousMonth = () => {\n    setCurrentDate(prev => new Date(prev.getFullYear(), prev.getMonth() - 1, 1));\n  };\n\n  const nextMonth = () => {\n    setCurrentDate(prev => new Date(prev.getFullYear(), prev.getMonth() + 1, 1));\n  };\n\n  const isLoading = employeesLoading || postsLoading || allocationsLoading;\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.allocation.title}\n        description={translations.allocation.description}\n      >\n        <div className=\"flex flex-wrap items-center gap-2\">\n          {isAdmin && selectedPost && (\n            <>\n              <Dialog open={csvDialogOpen} onOpenChange={setCsvDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button variant=\"outline\" data-testid=\"button-import-csv\">\n                    <Upload className=\"h-4 w-4 mr-2\" />\n                    {translations.allocation.importCsv}\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Importar Alocações via CSV</DialogTitle>\n                    <DialogDescription>\n                      Envie um arquivo CSV com as colunas: employee_id, date, status.\n                      Status válidos: present, absent, justified, vacation, medical_leave.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"csv-file\">Arquivo CSV</Label>\n                      <Input\n                        id=\"csv-file\"\n                        type=\"file\"\n                        accept=\".csv\"\n                        ref={fileInputRef}\n                        onChange={handleFileUpload}\n                        disabled={csvImportMutation.isPending}\n                        data-testid=\"input-csv-file\"\n                      />\n                    </div>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={downloadTemplate}\n                      data-testid=\"button-download-template\"\n                    >\n                      <Download className=\"h-4 w-4 mr-2\" />\n                      Baixar Modelo\n                    </Button>\n                  </div>\n                  <DialogFooter>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setCsvDialogOpen(false)}\n                      data-testid=\"button-cancel-csv\"\n                    >\n                      {translations.common.cancel}\n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n\n              <Dialog open={copyDialogOpen} onOpenChange={setCopyDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button variant=\"outline\" data-testid=\"button-copy-month\">\n                    <Copy className=\"h-4 w-4 mr-2\" />\n                    {translations.allocation.copyFromMonth}\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Copiar Alocações do Mês Anterior</DialogTitle>\n                    <DialogDescription>\n                      Isso irá copiar todas as alocações de {format(previousMonthDate, \"MMMM yyyy\", { locale: ptBR })} para {format(currentDate, \"MMMM yyyy\", { locale: ptBR })} para o posto selecionado.\n                      As alocações existentes no mês atual serão substituídas.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"py-4\">\n                    <div className=\"flex items-center gap-4 text-sm\">\n                      <div className=\"flex-1 p-3 rounded-md bg-muted\">\n                        <div className=\"text-muted-foreground\">{translations.allocation.sourceMonth}</div>\n                        <div className=\"font-medium\">{format(previousMonthDate, \"MMMM yyyy\", { locale: ptBR })}</div>\n                      </div>\n                      <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n                      <div className=\"flex-1 p-3 rounded-md bg-muted\">\n                        <div className=\"text-muted-foreground\">{translations.allocation.targetMonth}</div>\n                        <div className=\"font-medium\">{format(currentDate, \"MMMM yyyy\", { locale: ptBR })}</div>\n                      </div>\n                    </div>\n                  </div>\n                  <DialogFooter>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setCopyDialogOpen(false)}\n                      data-testid=\"button-cancel-copy\"\n                    >\n                      {translations.common.cancel}\n                    </Button>\n                    <Button\n                      onClick={() => copyMonthMutation.mutate()}\n                      disabled={copyMonthMutation.isPending}\n                      data-testid=\"button-confirm-copy\"\n                    >\n                      {copyMonthMutation.isPending ? \"Copiando...\" : \"Copiar Alocações\"}\n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n\n              <Dialog open={bulkFillDialogOpen} onOpenChange={setBulkFillDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button variant=\"outline\" data-testid=\"button-bulk-fill\">\n                    <Wand2 className=\"h-4 w-4 mr-2\" />\n                    Preencher Dia\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Preencher Status do Dia</DialogTitle>\n                    <DialogDescription>\n                      Selecione um dia e um status para aplicar a todos os funcionários ativos de uma só vez.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"bulk-day\">Dia</Label>\n                      <Select value={bulkFillDay} onValueChange={setBulkFillDay}>\n                        <SelectTrigger data-testid=\"select-bulk-day\">\n                          <SelectValue placeholder=\"Selecione o dia\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {daysInMonth.map((day) => (\n                            <SelectItem key={day.toISOString()} value={format(day, \"yyyy-MM-dd\")}>\n                              {format(day, \"dd/MM/yyyy (EEEE)\", { locale: ptBR })}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"bulk-status\">Status</Label>\n                      <Select value={bulkFillStatus} onValueChange={setBulkFillStatus}>\n                        <SelectTrigger data-testid=\"select-bulk-status\">\n                          <SelectValue placeholder=\"Selecione o status\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {allocationStatuses.map((s) => (\n                            <SelectItem key={s} value={s}>\n                              {statusLabels[s] || s}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </div>\n                  <DialogFooter>\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setBulkFillDialogOpen(false)}\n                      data-testid=\"button-cancel-bulk\"\n                    >\n                      {translations.common.cancel}\n                    </Button>\n                    <Button\n                      onClick={handleBulkFill}\n                      disabled={!bulkFillDay || !bulkFillStatus}\n                      data-testid=\"button-confirm-bulk\"\n                    >\n                      Aplicar para Todos\n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n            </>\n          )}\n          {isAdmin && editedAllocations.size > 0 && (\n            <Button onClick={() => saveMutation.mutate()} disabled={saveMutation.isPending} data-testid=\"button-save-allocations\">\n              <Save className=\"h-4 w-4 mr-2\" />\n              {saveMutation.isPending ? \"Salvando...\" : `Salvar Alterações (${editedAllocations.size})`}\n            </Button>\n          )}\n        </div>\n      </PageHeader>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <Button variant=\"outline\" size=\"icon\" onClick={previousMonth} data-testid=\"button-prev-month\">\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <CardTitle className=\"min-w-[180px] text-center capitalize\">\n                {format(currentDate, \"MMMM yyyy\", { locale: ptBR })}\n              </CardTitle>\n              <Button variant=\"outline\" size=\"icon\" onClick={nextMonth} data-testid=\"button-next-month\">\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-sm text-muted-foreground\">Posto de Serviço:</span>\n              <Select value={selectedPost} onValueChange={setSelectedPost}>\n                <SelectTrigger className=\"w-[200px]\" data-testid=\"select-service-post\">\n                  <SelectValue placeholder={translations.allocation.selectPost} />\n                </SelectTrigger>\n                <SelectContent>\n                  {servicePosts?.map((post) => (\n                    <SelectItem key={post.id} value={post.id.toString()}>\n                      {post.postCode} - {post.postName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {!selectedPost ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <p className=\"text-muted-foreground\">{translations.allocation.selectPostFirst}</p>\n            </div>\n          ) : isLoading ? (\n            <div className=\"space-y-4\">\n              {Array.from({ length: 5 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : activeEmployees.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <p className=\"text-muted-foreground\">Nenhum funcionário ativo encontrado</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full border-collapse\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th className=\"sticky left-0 bg-background p-2 text-left text-sm font-medium min-w-[150px] z-10\">\n                      {translations.employees.name}\n                    </th>\n                    {daysInMonth.map((day) => (\n                      <th\n                        key={day.toISOString()}\n                        className={`p-2 text-center text-xs font-medium min-w-[80px] ${\n                          day.getDay() === 0 || day.getDay() === 6 ? \"bg-muted/50\" : \"\"\n                        }`}\n                      >\n                        <div>{format(day, \"EEE\", { locale: ptBR })}</div>\n                        <div className=\"text-muted-foreground\">{format(day, \"d\")}</div>\n                      </th>\n                    ))}\n                  </tr>\n                </thead>\n                <tbody>\n                  {activeEmployees.map((employee) => (\n                    <tr key={employee.id} className=\"border-b\" data-testid={`allocation-row-${employee.id}`}>\n                      <td className=\"sticky left-0 bg-background p-2 z-10\">\n                        <div className=\"font-medium text-sm\">{employee.name}</div>\n                        <div className=\"text-xs text-muted-foreground\">{employee.functionPost}</div>\n                      </td>\n                      {daysInMonth.map((day) => {\n                        const status = getAllocationStatus(employee.id, day);\n                        const isWeekend = day.getDay() === 0 || day.getDay() === 6;\n                        return (\n                          <td\n                            key={day.toISOString()}\n                            className={`p-1 text-center ${isWeekend ? \"bg-muted/50\" : \"\"}`}\n                          >\n                            {isAdmin ? (\n                              <Select\n                                value={status || \"\"}\n                                onValueChange={(value) => handleStatusChange(employee.id, day, value)}\n                              >\n                                <SelectTrigger className=\"h-8 text-xs\" data-testid={`select-allocation-${employee.id}-${format(day, \"yyyy-MM-dd\")}`}>\n                                  <SelectValue placeholder=\"-\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {allocationStatuses.map((s) => (\n                                    <SelectItem key={s} value={s} className=\"text-xs\">\n                                      {statusLabels[s] || s}\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            ) : status ? (\n                              <StatusBadge status={status as any} />\n                            ) : (\n                              <span className=\"text-xs text-muted-foreground\">-</span>\n                            )}\n                          </td>\n                        );\n                      })}\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Legenda de Status</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-4\">\n            {allocationStatuses.map((status) => (\n              <div key={status} className=\"flex items-center gap-2\">\n                <StatusBadge status={status} />\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":24321,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  employees,\n  servicePosts,\n  allocations,\n  occurrences,\n  documents,\n  auditLogs,\n  notificationSettings,\n  lgpdLogs,\n  documentChecklists,\n  feriasLicencas,\n  type User,\n  type UpsertUser,\n  type Employee,\n  type InsertEmployee,\n  type ServicePost,\n  type InsertServicePost,\n  type Allocation,\n  type InsertAllocation,\n  type AllocationWithRelations,\n  type Occurrence,\n  type InsertOccurrence,\n  type OccurrenceWithRelations,\n  type Document,\n  type InsertDocument,\n  type DocumentWithRelations,\n  type AuditLog,\n  type InsertAuditLog,\n  type AuditLogWithRelations,\n  type NotificationSettings,\n  type InsertNotificationSettings,\n  type NotificationSettingsWithRelations,\n  type LgpdLog,\n  type InsertLgpdLog,\n  type LgpdLogWithRelations,\n  type DocumentChecklist,\n  type InsertDocumentChecklist,\n  type DocumentChecklistWithRelations,\n  type FeriasLicencas,\n  type InsertFeriasLicencas,\n  type FeriasLicencasWithRelations,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, like, gte, lte, or, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  getAllUsers(): Promise<User[]>;\n  updateUserRole(id: string, role: \"admin\" | \"viewer\"): Promise<User | undefined>;\n\n  getEmployees(): Promise<Employee[]>;\n  getEmployee(id: number): Promise<Employee | undefined>;\n  createEmployee(employee: InsertEmployee): Promise<Employee>;\n  updateEmployee(id: number, employee: Partial<InsertEmployee>): Promise<Employee | undefined>;\n  deleteEmployee(id: number): Promise<boolean>;\n  searchEmployees(query: string): Promise<Employee[]>;\n\n  getServicePosts(): Promise<ServicePost[]>;\n  getServicePost(id: number): Promise<ServicePost | undefined>;\n  createServicePost(post: InsertServicePost): Promise<ServicePost>;\n  updateServicePost(id: number, post: Partial<InsertServicePost>): Promise<ServicePost | undefined>;\n  deleteServicePost(id: number): Promise<boolean>;\n  searchServicePosts(query: string): Promise<ServicePost[]>;\n\n  getAllocations(filters?: { date?: string; employeeId?: number; postId?: number }): Promise<AllocationWithRelations[]>;\n  getAllocation(id: number): Promise<AllocationWithRelations | undefined>;\n  createAllocation(allocation: InsertAllocation): Promise<Allocation>;\n  updateAllocation(id: number, allocation: Partial<InsertAllocation>): Promise<Allocation | undefined>;\n  deleteAllocation(id: number): Promise<boolean>;\n  getAllocationsByDateRange(startDate: string, endDate: string): Promise<AllocationWithRelations[]>;\n  getAllocationsByDateRangeAndPost(startDate: string, endDate: string, postId: number): Promise<AllocationWithRelations[]>;\n  bulkCreateAllocations(allocations: InsertAllocation[]): Promise<Allocation[]>;\n  deleteAllocationsByDateRangeAndPost(startDate: string, endDate: string, postId: number): Promise<number>;\n\n  getOccurrences(filters?: { startDate?: string; endDate?: string; category?: string; employeeId?: number }): Promise<OccurrenceWithRelations[]>;\n  getOccurrence(id: number): Promise<OccurrenceWithRelations | undefined>;\n  createOccurrence(occurrence: InsertOccurrence): Promise<Occurrence>;\n  updateOccurrence(id: number, occurrence: Partial<InsertOccurrence>): Promise<Occurrence | undefined>;\n  deleteOccurrence(id: number): Promise<boolean>;\n\n  getDocuments(filters?: { documentType?: string; employeeId?: number; postId?: number; monthYear?: string }): Promise<DocumentWithRelations[]>;\n  getDocument(id: number): Promise<DocumentWithRelations | undefined>;\n  createDocument(document: InsertDocument): Promise<Document>;\n  updateDocument(id: number, document: Partial<InsertDocument>): Promise<Document | undefined>;\n  deleteDocument(id: number): Promise<boolean>;\n  getExpiringDocuments(daysAhead?: number): Promise<DocumentWithRelations[]>;\n  getExpiredDocuments(): Promise<DocumentWithRelations[]>;\n\n  getAuditLogs(limit?: number): Promise<AuditLogWithRelations[]>;\n  getAuditLogsFiltered(filters?: { userId?: string; entityType?: string; action?: string; startDate?: string; endDate?: string; limit?: number }): Promise<AuditLogWithRelations[]>;\n  createAuditLog(log: InsertAuditLog): Promise<AuditLog>;\n  createAuditLogWithDiff(log: InsertAuditLog & { diffBefore?: any; diffAfter?: any }): Promise<AuditLog>;\n\n  getDashboardStats(): Promise<{\n    totalEmployees: number;\n    activeEmployees: number;\n    totalServicePosts: number;\n    totalDocuments: number;\n    recentOccurrences: number;\n  }>;\n\n  getAllocationTrends(days?: number): Promise<Array<{\n    date: string;\n    present: number;\n    absent: number;\n    justified: number;\n    vacation: number;\n    medical_leave: number;\n  }>>;\n\n  getOccurrencesByCategory(): Promise<Array<{\n    category: string;\n    count: number;\n  }>>;\n\n  getComplianceMetrics(): Promise<{\n    attendanceRate: number;\n    documentationRate: number;\n    activeEmployeeRate: number;\n    occurrenceRate: number;\n  }>;\n\n  getNotificationSettings(): Promise<NotificationSettingsWithRelations[]>;\n  getNotificationSettingsByUser(userId: string): Promise<NotificationSettings | undefined>;\n  createNotificationSettings(settings: InsertNotificationSettings): Promise<NotificationSettings>;\n  updateNotificationSettings(id: number, settings: Partial<InsertNotificationSettings>): Promise<NotificationSettings | undefined>;\n  deleteNotificationSettings(id: number): Promise<boolean>;\n  getActiveNotificationRecipients(notificationType: 'occurrences' | 'allocations' | 'documents' | 'daily'): Promise<string[]>;\n\n  createLgpdLog(log: InsertLgpdLog): Promise<LgpdLog>;\n  getLgpdLogsFiltered(filters?: { userId?: string; accessType?: string; dataCategory?: string; entityType?: string; startDate?: string; endDate?: string; limit?: number }): Promise<LgpdLogWithRelations[]>;\n\n  getPrevistoRealizadoReport(filters: { startDate: string; endDate: string; postId?: number }): Promise<{\n    summary: { totalPrevisto: number; totalRealizado: number; compliancePercentage: number };\n    byPost: Array<{\n      postId: number;\n      postCode: string;\n      postName: string;\n      previsto: number;\n      realizado: number;\n      compliance: number;\n    }>;\n    byDate: Array<{\n      date: string;\n      previsto: number;\n      realizado: number;\n    }>;\n  }>;\n\n  // Document Checklists\n  getDocumentChecklists(postId?: number): Promise<DocumentChecklistWithRelations[]>;\n  getDocumentChecklist(id: number): Promise<DocumentChecklistWithRelations | undefined>;\n  createDocumentChecklist(checklist: InsertDocumentChecklist): Promise<DocumentChecklist>;\n  updateDocumentChecklist(id: number, checklist: Partial<InsertDocumentChecklist>): Promise<DocumentChecklist | undefined>;\n  deleteDocumentChecklist(id: number): Promise<boolean>;\n  getChecklistComplianceByPost(postId: number): Promise<{\n    checklist: DocumentChecklist;\n    fulfilled: boolean;\n    latestDocument: Document | null;\n  }[]>;\n\n  // Document Version Tracking\n  getDocumentVersions(documentId: number): Promise<DocumentWithRelations[]>;\n  createDocumentVersion(originalDocId: number, newDocument: InsertDocument): Promise<Document>;\n\n  // Férias & Licenças\n  getFeriasLicencas(filters?: { employeeId?: number; type?: string; status?: string }): Promise<FeriasLicencasWithRelations[]>;\n  getFeriasLicenca(id: number): Promise<FeriasLicencasWithRelations | undefined>;\n  createFeriasLicenca(data: InsertFeriasLicencas): Promise<FeriasLicencas>;\n  updateFeriasLicenca(id: number, data: Partial<InsertFeriasLicencas>): Promise<FeriasLicencas | undefined>;\n  deleteFeriasLicenca(id: number): Promise<boolean>;\n  getActiveFeriasLicencas(): Promise<FeriasLicencasWithRelations[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return db.select().from(users).orderBy(desc(users.createdAt));\n  }\n\n  async updateUserRole(id: string, role: \"admin\" | \"viewer\"): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ role, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user;\n  }\n\n  async getEmployees(): Promise<Employee[]> {\n    return db.select().from(employees).orderBy(employees.name);\n  }\n\n  async getEmployee(id: number): Promise<Employee | undefined> {\n    const [employee] = await db.select().from(employees).where(eq(employees.id, id));\n    return employee;\n  }\n\n  async createEmployee(employee: InsertEmployee): Promise<Employee> {\n    const [created] = await db.insert(employees).values(employee).returning();\n    return created;\n  }\n\n  async updateEmployee(id: number, employee: Partial<InsertEmployee>): Promise<Employee | undefined> {\n    const [updated] = await db\n      .update(employees)\n      .set({ ...employee, updatedAt: new Date() })\n      .where(eq(employees.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteEmployee(id: number): Promise<boolean> {\n    const result = await db.delete(employees).where(eq(employees.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async searchEmployees(query: string): Promise<Employee[]> {\n    const searchTerm = `%${query}%`;\n    return db\n      .select()\n      .from(employees)\n      .where(\n        or(\n          like(employees.name, searchTerm),\n          like(employees.cpf, searchTerm),\n          like(employees.functionPost, searchTerm),\n          like(employees.unit, searchTerm)\n        )\n      )\n      .orderBy(employees.name);\n  }\n\n  async getServicePosts(): Promise<ServicePost[]> {\n    return db.select().from(servicePosts).orderBy(servicePosts.postCode);\n  }\n\n  async getServicePost(id: number): Promise<ServicePost | undefined> {\n    const [post] = await db.select().from(servicePosts).where(eq(servicePosts.id, id));\n    return post;\n  }\n\n  async createServicePost(post: InsertServicePost): Promise<ServicePost> {\n    const [created] = await db.insert(servicePosts).values(post).returning();\n    return created;\n  }\n\n  async updateServicePost(id: number, post: Partial<InsertServicePost>): Promise<ServicePost | undefined> {\n    const [updated] = await db\n      .update(servicePosts)\n      .set({ ...post, updatedAt: new Date() })\n      .where(eq(servicePosts.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteServicePost(id: number): Promise<boolean> {\n    const result = await db.delete(servicePosts).where(eq(servicePosts.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async searchServicePosts(query: string): Promise<ServicePost[]> {\n    const searchTerm = `%${query}%`;\n    return db\n      .select()\n      .from(servicePosts)\n      .where(\n        or(\n          like(servicePosts.postCode, searchTerm),\n          like(servicePosts.postName, searchTerm),\n          like(servicePosts.unit, searchTerm)\n        )\n      )\n      .orderBy(servicePosts.postCode);\n  }\n\n  async getAllocations(filters?: { date?: string; employeeId?: number; postId?: number }): Promise<AllocationWithRelations[]> {\n    const conditions = [];\n    if (filters?.date) conditions.push(eq(allocations.date, filters.date));\n    if (filters?.employeeId) conditions.push(eq(allocations.employeeId, filters.employeeId));\n    if (filters?.postId) conditions.push(eq(allocations.postId, filters.postId));\n\n    const result = await db.query.allocations.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        employee: true,\n        post: true,\n      },\n      orderBy: [desc(allocations.date)],\n    });\n    return result;\n  }\n\n  async getAllocation(id: number): Promise<AllocationWithRelations | undefined> {\n    const result = await db.query.allocations.findFirst({\n      where: eq(allocations.id, id),\n      with: {\n        employee: true,\n        post: true,\n      },\n    });\n    return result;\n  }\n\n  async createAllocation(allocation: InsertAllocation): Promise<Allocation> {\n    const [created] = await db.insert(allocations).values(allocation).returning();\n    return created;\n  }\n\n  async updateAllocation(id: number, allocation: Partial<InsertAllocation>): Promise<Allocation | undefined> {\n    const [updated] = await db\n      .update(allocations)\n      .set({ ...allocation, updatedAt: new Date() })\n      .where(eq(allocations.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteAllocation(id: number): Promise<boolean> {\n    const result = await db.delete(allocations).where(eq(allocations.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getAllocationsByDateRange(startDate: string, endDate: string): Promise<AllocationWithRelations[]> {\n    const result = await db.query.allocations.findMany({\n      where: and(\n        gte(allocations.date, startDate),\n        lte(allocations.date, endDate)\n      ),\n      with: {\n        employee: true,\n        post: true,\n      },\n      orderBy: [allocations.date, allocations.employeeId],\n    });\n    return result;\n  }\n\n  async getAllocationsByDateRangeAndPost(startDate: string, endDate: string, postId: number): Promise<AllocationWithRelations[]> {\n    const result = await db.query.allocations.findMany({\n      where: and(\n        gte(allocations.date, startDate),\n        lte(allocations.date, endDate),\n        eq(allocations.postId, postId)\n      ),\n      with: {\n        employee: true,\n        post: true,\n      },\n      orderBy: [allocations.date, allocations.employeeId],\n    });\n    return result;\n  }\n\n  async bulkCreateAllocations(allocationData: InsertAllocation[]): Promise<Allocation[]> {\n    if (allocationData.length === 0) return [];\n    const created = await db.insert(allocations).values(allocationData).returning();\n    return created;\n  }\n\n  async deleteAllocationsByDateRangeAndPost(startDate: string, endDate: string, postId: number): Promise<number> {\n    const result = await db.delete(allocations).where(\n      and(\n        gte(allocations.date, startDate),\n        lte(allocations.date, endDate),\n        eq(allocations.postId, postId)\n      )\n    );\n    return result.rowCount ?? 0;\n  }\n\n  async getOccurrences(filters?: { startDate?: string; endDate?: string; category?: string; employeeId?: number }): Promise<OccurrenceWithRelations[]> {\n    const conditions = [];\n    if (filters?.startDate) conditions.push(gte(occurrences.date, filters.startDate));\n    if (filters?.endDate) conditions.push(lte(occurrences.date, filters.endDate));\n    if (filters?.category) conditions.push(eq(occurrences.category, filters.category as any));\n    if (filters?.employeeId) conditions.push(eq(occurrences.employeeId, filters.employeeId));\n\n    const result = await db.query.occurrences.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        employee: true,\n      },\n      orderBy: [desc(occurrences.date)],\n    });\n    return result;\n  }\n\n  async getOccurrence(id: number): Promise<OccurrenceWithRelations | undefined> {\n    const result = await db.query.occurrences.findFirst({\n      where: eq(occurrences.id, id),\n      with: {\n        employee: true,\n      },\n    });\n    return result;\n  }\n\n  async createOccurrence(occurrence: InsertOccurrence): Promise<Occurrence> {\n    const [created] = await db.insert(occurrences).values(occurrence).returning();\n    return created;\n  }\n\n  async updateOccurrence(id: number, occurrence: Partial<InsertOccurrence>): Promise<Occurrence | undefined> {\n    const [updated] = await db\n      .update(occurrences)\n      .set({ ...occurrence, updatedAt: new Date() })\n      .where(eq(occurrences.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteOccurrence(id: number): Promise<boolean> {\n    const result = await db.delete(occurrences).where(eq(occurrences.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getDocuments(filters?: { documentType?: string; employeeId?: number; postId?: number; monthYear?: string }): Promise<DocumentWithRelations[]> {\n    const conditions = [];\n    if (filters?.documentType) conditions.push(eq(documents.documentType, filters.documentType as any));\n    if (filters?.employeeId) conditions.push(eq(documents.employeeId, filters.employeeId));\n    if (filters?.postId) conditions.push(eq(documents.postId, filters.postId));\n    if (filters?.monthYear) conditions.push(eq(documents.monthYear, filters.monthYear));\n\n    const result = await db.query.documents.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        employee: true,\n        post: true,\n        uploader: true,\n      },\n      orderBy: [desc(documents.createdAt)],\n    });\n    return result;\n  }\n\n  async getDocument(id: number): Promise<DocumentWithRelations | undefined> {\n    const result = await db.query.documents.findFirst({\n      where: eq(documents.id, id),\n      with: {\n        employee: true,\n        post: true,\n        uploader: true,\n      },\n    });\n    return result;\n  }\n\n  async createDocument(document: InsertDocument): Promise<Document> {\n    const [created] = await db.insert(documents).values(document).returning();\n    return created;\n  }\n\n  async deleteDocument(id: number): Promise<boolean> {\n    const result = await db.delete(documents).where(eq(documents.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async updateDocument(id: number, document: Partial<InsertDocument>): Promise<Document | undefined> {\n    const [updated] = await db\n      .update(documents)\n      .set(document)\n      .where(eq(documents.id, id))\n      .returning();\n    return updated;\n  }\n\n  async getExpiringDocuments(daysAhead: number = 30): Promise<DocumentWithRelations[]> {\n    const today = new Date().toISOString().split('T')[0];\n    const futureDate = new Date();\n    futureDate.setDate(futureDate.getDate() + daysAhead);\n    const futureDateStr = futureDate.toISOString().split('T')[0];\n\n    const result = await db.query.documents.findMany({\n      where: and(\n        sql`${documents.expirationDate} IS NOT NULL`,\n        gte(documents.expirationDate, today),\n        lte(documents.expirationDate, futureDateStr)\n      ),\n      with: {\n        employee: true,\n        post: true,\n        uploader: true,\n      },\n      orderBy: [documents.expirationDate],\n    });\n    return result;\n  }\n\n  async getExpiredDocuments(): Promise<DocumentWithRelations[]> {\n    const today = new Date().toISOString().split('T')[0];\n\n    const result = await db.query.documents.findMany({\n      where: and(\n        sql`${documents.expirationDate} IS NOT NULL`,\n        lte(documents.expirationDate, today)\n      ),\n      with: {\n        employee: true,\n        post: true,\n        uploader: true,\n      },\n      orderBy: [desc(documents.expirationDate)],\n    });\n    return result;\n  }\n\n  async getAuditLogs(limit: number = 100): Promise<AuditLogWithRelations[]> {\n    const result = await db.query.auditLogs.findMany({\n      with: {\n        user: true,\n      },\n      orderBy: [desc(auditLogs.timestamp)],\n      limit,\n    });\n    return result;\n  }\n\n  async getAuditLogsFiltered(filters?: { userId?: string; entityType?: string; action?: string; startDate?: string; endDate?: string; limit?: number }): Promise<AuditLogWithRelations[]> {\n    const conditions = [];\n    if (filters?.userId) conditions.push(eq(auditLogs.userId, filters.userId));\n    if (filters?.entityType) conditions.push(eq(auditLogs.entityType, filters.entityType));\n    if (filters?.action) conditions.push(eq(auditLogs.action, filters.action));\n    if (filters?.startDate) conditions.push(gte(auditLogs.timestamp, new Date(filters.startDate)));\n    if (filters?.endDate) {\n      const endDate = new Date(filters.endDate);\n      endDate.setHours(23, 59, 59, 999);\n      conditions.push(lte(auditLogs.timestamp, endDate));\n    }\n\n    const result = await db.query.auditLogs.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        user: true,\n      },\n      orderBy: [desc(auditLogs.timestamp)],\n      limit: filters?.limit || 500,\n    });\n    return result;\n  }\n\n  async createAuditLog(log: InsertAuditLog): Promise<AuditLog> {\n    const [created] = await db.insert(auditLogs).values(log).returning();\n    return created;\n  }\n\n  async createAuditLogWithDiff(log: InsertAuditLog & { diffBefore?: any; diffAfter?: any }): Promise<AuditLog> {\n    const [created] = await db.insert(auditLogs).values({\n      ...log,\n      diffBefore: log.diffBefore || null,\n      diffAfter: log.diffAfter || null,\n    } as any).returning();\n    return created;\n  }\n\n  async getDashboardStats(): Promise<{\n    totalEmployees: number;\n    activeEmployees: number;\n    totalServicePosts: number;\n    totalDocuments: number;\n    recentOccurrences: number;\n  }> {\n    const [employeeStats] = await db\n      .select({\n        total: sql<number>`count(*)`,\n        active: sql<number>`count(*) filter (where ${employees.status} = 'active')`,\n      })\n      .from(employees);\n\n    const [postStats] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(servicePosts);\n\n    const [docStats] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(documents);\n\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    const [occurrenceStats] = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(occurrences)\n      .where(gte(occurrences.date, thirtyDaysAgo.toISOString().split('T')[0]));\n\n    return {\n      totalEmployees: Number(employeeStats?.total) || 0,\n      activeEmployees: Number(employeeStats?.active) || 0,\n      totalServicePosts: Number(postStats?.count) || 0,\n      totalDocuments: Number(docStats?.count) || 0,\n      recentOccurrences: Number(occurrenceStats?.count) || 0,\n    };\n  }\n\n  async getAllocationTrends(days: number = 30): Promise<Array<{\n    date: string;\n    present: number;\n    absent: number;\n    justified: number;\n    vacation: number;\n    medical_leave: number;\n  }>> {\n    const startDate = new Date();\n    startDate.setDate(startDate.getDate() - days);\n    const startDateStr = startDate.toISOString().split('T')[0];\n\n    const result = await db\n      .select({\n        date: allocations.date,\n        present: sql<number>`count(*) filter (where ${allocations.status} = 'present')`,\n        absent: sql<number>`count(*) filter (where ${allocations.status} = 'absent')`,\n        justified: sql<number>`count(*) filter (where ${allocations.status} = 'justified')`,\n        vacation: sql<number>`count(*) filter (where ${allocations.status} = 'vacation')`,\n        medical_leave: sql<number>`count(*) filter (where ${allocations.status} = 'medical_leave')`,\n      })\n      .from(allocations)\n      .where(gte(allocations.date, startDateStr))\n      .groupBy(allocations.date)\n      .orderBy(allocations.date);\n\n    return result.map(row => ({\n      date: row.date,\n      present: Number(row.present) || 0,\n      absent: Number(row.absent) || 0,\n      justified: Number(row.justified) || 0,\n      vacation: Number(row.vacation) || 0,\n      medical_leave: Number(row.medical_leave) || 0,\n    }));\n  }\n\n  async getOccurrencesByCategory(): Promise<Array<{\n    category: string;\n    count: number;\n  }>> {\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    const startDateStr = thirtyDaysAgo.toISOString().split('T')[0];\n\n    const result = await db\n      .select({\n        category: occurrences.category,\n        count: sql<number>`count(*)`,\n      })\n      .from(occurrences)\n      .where(gte(occurrences.date, startDateStr))\n      .groupBy(occurrences.category);\n\n    return result.map(row => ({\n      category: row.category,\n      count: Number(row.count) || 0,\n    }));\n  }\n\n  async getComplianceMetrics(): Promise<{\n    attendanceRate: number;\n    documentationRate: number;\n    activeEmployeeRate: number;\n    occurrenceRate: number;\n  }> {\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    const startDateStr = thirtyDaysAgo.toISOString().split('T')[0];\n\n    const [allocationStats] = await db\n      .select({\n        total: sql<number>`count(*)`,\n        present: sql<number>`count(*) filter (where ${allocations.status} = 'present')`,\n      })\n      .from(allocations)\n      .where(gte(allocations.date, startDateStr));\n\n    const [employeeStats] = await db\n      .select({\n        total: sql<number>`count(*)`,\n        active: sql<number>`count(*) filter (where ${employees.status} = 'active')`,\n      })\n      .from(employees);\n\n    const [docStats] = await db\n      .select({\n        employeesWithDocs: sql<number>`count(distinct ${documents.employeeId})`,\n      })\n      .from(documents);\n\n    const [occurrenceStats] = await db\n      .select({\n        count: sql<number>`count(*)`,\n      })\n      .from(occurrences)\n      .where(gte(occurrences.date, startDateStr));\n\n    const totalAllocations = Number(allocationStats?.total) || 0;\n    const presentAllocations = Number(allocationStats?.present) || 0;\n    const totalEmployees = Number(employeeStats?.total) || 0;\n    const activeEmployees = Number(employeeStats?.active) || 0;\n    const employeesWithDocs = Number(docStats?.employeesWithDocs) || 0;\n    const occurrenceCount = Number(occurrenceStats?.count) || 0;\n\n    const safeDiv = (numerator: number, denominator: number, multiplier: number = 100) => {\n      if (denominator <= 0) return 0;\n      return Math.round((numerator / denominator) * multiplier);\n    };\n\n    return {\n      attendanceRate: safeDiv(presentAllocations, totalAllocations),\n      documentationRate: safeDiv(employeesWithDocs, totalEmployees),\n      activeEmployeeRate: safeDiv(activeEmployees, totalEmployees),\n      occurrenceRate: activeEmployees > 0 ? Math.round((occurrenceCount / activeEmployees) * 10) / 10 : 0,\n    };\n  }\n\n  async getNotificationSettings(): Promise<NotificationSettingsWithRelations[]> {\n    const result = await db.query.notificationSettings.findMany({\n      with: {\n        user: true,\n      },\n      orderBy: [desc(notificationSettings.createdAt)],\n    });\n    return result;\n  }\n\n  async getNotificationSettingsByUser(userId: string): Promise<NotificationSettings | undefined> {\n    const [settings] = await db\n      .select()\n      .from(notificationSettings)\n      .where(eq(notificationSettings.userId, userId));\n    return settings;\n  }\n\n  async createNotificationSettings(settings: InsertNotificationSettings): Promise<NotificationSettings> {\n    const [created] = await db.insert(notificationSettings).values(settings).returning();\n    return created;\n  }\n\n  async updateNotificationSettings(id: number, settings: Partial<InsertNotificationSettings>): Promise<NotificationSettings | undefined> {\n    const [updated] = await db\n      .update(notificationSettings)\n      .set({ ...settings, updatedAt: new Date() })\n      .where(eq(notificationSettings.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteNotificationSettings(id: number): Promise<boolean> {\n    const result = await db.delete(notificationSettings).where(eq(notificationSettings.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getActiveNotificationRecipients(notificationType: 'occurrences' | 'allocations' | 'documents' | 'daily'): Promise<string[]> {\n    let condition;\n    switch (notificationType) {\n      case 'occurrences':\n        condition = eq(notificationSettings.notifyNewOccurrences, true);\n        break;\n      case 'allocations':\n        condition = eq(notificationSettings.notifyMissingAllocations, true);\n        break;\n      case 'documents':\n        condition = eq(notificationSettings.notifyDocumentExpiration, true);\n        break;\n      case 'daily':\n        condition = eq(notificationSettings.notifyDailySummary, true);\n        break;\n    }\n\n    const settings = await db\n      .select({ email: notificationSettings.email })\n      .from(notificationSettings)\n      .where(and(eq(notificationSettings.isActive, true), condition));\n\n    return settings.map(s => s.email);\n  }\n\n  async createLgpdLog(log: InsertLgpdLog): Promise<LgpdLog> {\n    const [created] = await db.insert(lgpdLogs).values(log).returning();\n    return created;\n  }\n\n  async getLgpdLogsFiltered(filters?: { userId?: string; accessType?: string; dataCategory?: string; entityType?: string; startDate?: string; endDate?: string; limit?: number }): Promise<LgpdLogWithRelations[]> {\n    const conditions = [];\n    if (filters?.userId) conditions.push(eq(lgpdLogs.userId, filters.userId));\n    if (filters?.accessType) conditions.push(eq(lgpdLogs.accessType, filters.accessType as any));\n    if (filters?.dataCategory) conditions.push(eq(lgpdLogs.dataCategory, filters.dataCategory as any));\n    if (filters?.entityType) conditions.push(eq(lgpdLogs.entityType, filters.entityType));\n    if (filters?.startDate) conditions.push(gte(lgpdLogs.timestamp, new Date(filters.startDate)));\n    if (filters?.endDate) {\n      const endDate = new Date(filters.endDate);\n      endDate.setHours(23, 59, 59, 999);\n      conditions.push(lte(lgpdLogs.timestamp, endDate));\n    }\n\n    const result = await db.query.lgpdLogs.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        user: true,\n      },\n      orderBy: [desc(lgpdLogs.timestamp)],\n      limit: filters?.limit || 500,\n    });\n    return result;\n  }\n\n  async getPrevistoRealizadoReport(filters: { startDate: string; endDate: string; postId?: number }): Promise<{\n    summary: { totalPrevisto: number; totalRealizado: number; compliancePercentage: number };\n    byPost: Array<{\n      postId: number;\n      postCode: string;\n      postName: string;\n      previsto: number;\n      realizado: number;\n      compliance: number;\n    }>;\n    byDate: Array<{\n      date: string;\n      previsto: number;\n      realizado: number;\n    }>;\n  }> {\n    const conditions = [\n      gte(allocations.date, filters.startDate),\n      lte(allocations.date, filters.endDate),\n    ];\n    if (filters.postId) {\n      conditions.push(eq(allocations.postId, filters.postId));\n    }\n\n    const byPostResult = await db\n      .select({\n        postId: allocations.postId,\n        postCode: servicePosts.postCode,\n        postName: servicePosts.postName,\n        previsto: sql<number>`count(*)`,\n        realizado: sql<number>`count(*) filter (where ${allocations.status} = 'present')`,\n      })\n      .from(allocations)\n      .innerJoin(servicePosts, eq(allocations.postId, servicePosts.id))\n      .where(and(...conditions))\n      .groupBy(allocations.postId, servicePosts.postCode, servicePosts.postName)\n      .orderBy(servicePosts.postCode);\n\n    const byDateResult = await db\n      .select({\n        date: allocations.date,\n        previsto: sql<number>`count(*)`,\n        realizado: sql<number>`count(*) filter (where ${allocations.status} = 'present')`,\n      })\n      .from(allocations)\n      .where(and(...conditions))\n      .groupBy(allocations.date)\n      .orderBy(allocations.date);\n\n    const totalPrevisto = byPostResult.reduce((sum, row) => sum + Number(row.previsto), 0);\n    const totalRealizado = byPostResult.reduce((sum, row) => sum + Number(row.realizado), 0);\n    const compliancePercentage = totalPrevisto > 0 ? Math.round((totalRealizado / totalPrevisto) * 100 * 10) / 10 : 0;\n\n    return {\n      summary: {\n        totalPrevisto,\n        totalRealizado,\n        compliancePercentage,\n      },\n      byPost: byPostResult.map(row => ({\n        postId: row.postId,\n        postCode: row.postCode,\n        postName: row.postName,\n        previsto: Number(row.previsto),\n        realizado: Number(row.realizado),\n        compliance: Number(row.previsto) > 0 ? Math.round((Number(row.realizado) / Number(row.previsto)) * 100 * 10) / 10 : 0,\n      })),\n      byDate: byDateResult.map(row => ({\n        date: row.date,\n        previsto: Number(row.previsto),\n        realizado: Number(row.realizado),\n      })),\n    };\n  }\n\n  // Document Checklists\n  async getDocumentChecklists(postId?: number): Promise<DocumentChecklistWithRelations[]> {\n    const conditions = postId ? [eq(documentChecklists.postId, postId)] : [];\n    const result = await db.query.documentChecklists.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        post: true,\n      },\n      orderBy: [documentChecklists.name],\n    });\n    return result;\n  }\n\n  async getDocumentChecklist(id: number): Promise<DocumentChecklistWithRelations | undefined> {\n    const result = await db.query.documentChecklists.findFirst({\n      where: eq(documentChecklists.id, id),\n      with: {\n        post: true,\n      },\n    });\n    return result;\n  }\n\n  async createDocumentChecklist(checklist: InsertDocumentChecklist): Promise<DocumentChecklist> {\n    const [created] = await db.insert(documentChecklists).values(checklist).returning();\n    return created;\n  }\n\n  async updateDocumentChecklist(id: number, checklist: Partial<InsertDocumentChecklist>): Promise<DocumentChecklist | undefined> {\n    const [updated] = await db\n      .update(documentChecklists)\n      .set({ ...checklist, updatedAt: new Date() })\n      .where(eq(documentChecklists.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteDocumentChecklist(id: number): Promise<boolean> {\n    const result = await db.delete(documentChecklists).where(eq(documentChecklists.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getChecklistComplianceByPost(postId: number): Promise<{\n    checklist: DocumentChecklist;\n    fulfilled: boolean;\n    latestDocument: Document | null;\n  }[]> {\n    const checklists = await db.select().from(documentChecklists).where(eq(documentChecklists.postId, postId));\n    const today = new Date().toISOString().split('T')[0];\n    \n    const results = await Promise.all(checklists.map(async (checklist) => {\n      const [latestDoc] = await db\n        .select()\n        .from(documents)\n        .where(\n          and(\n            eq(documents.postId, postId),\n            eq(documents.documentType, checklist.documentType)\n          )\n        )\n        .orderBy(desc(documents.createdAt))\n        .limit(1);\n      \n      const fulfilled = latestDoc !== undefined && \n        (!latestDoc.expirationDate || latestDoc.expirationDate >= today);\n      \n      return {\n        checklist,\n        fulfilled,\n        latestDocument: latestDoc || null,\n      };\n    }));\n    \n    return results;\n  }\n\n  // Document Version Tracking\n  async getDocumentVersions(documentId: number): Promise<DocumentWithRelations[]> {\n    const doc = await this.getDocument(documentId);\n    if (!doc) return [];\n    \n    const versions: DocumentWithRelations[] = [doc];\n    let currentPreviousId: number | null = doc.previousVersionId;\n    \n    while (currentPreviousId) {\n      const prevDoc = await this.getDocument(currentPreviousId);\n      if (!prevDoc) break;\n      versions.push(prevDoc);\n      currentPreviousId = prevDoc.previousVersionId;\n    }\n    \n    return versions;\n  }\n\n  async createDocumentVersion(originalDocId: number, newDocument: InsertDocument): Promise<Document> {\n    const originalDoc = await this.getDocument(originalDocId);\n    if (!originalDoc) {\n      throw new Error(\"Original document not found\");\n    }\n    \n    const newVersion = (originalDoc.version || 1) + 1;\n    const [created] = await db.insert(documents).values({\n      ...newDocument,\n      version: newVersion,\n      previousVersionId: originalDocId,\n    }).returning();\n    \n    return created;\n  }\n\n  // Férias & Licenças\n  async getFeriasLicencas(filters?: { employeeId?: number; type?: string; status?: string }): Promise<FeriasLicencasWithRelations[]> {\n    const conditions = [];\n    if (filters?.employeeId) conditions.push(eq(feriasLicencas.employeeId, filters.employeeId));\n    if (filters?.type) conditions.push(eq(feriasLicencas.type, filters.type as any));\n    if (filters?.status) conditions.push(eq(feriasLicencas.status, filters.status as any));\n\n    const result = await db.query.feriasLicencas.findMany({\n      where: conditions.length > 0 ? and(...conditions) : undefined,\n      with: {\n        employee: true,\n        createdByUser: true,\n      },\n      orderBy: [desc(feriasLicencas.startDate)],\n    });\n    return result;\n  }\n\n  async getFeriasLicenca(id: number): Promise<FeriasLicencasWithRelations | undefined> {\n    const result = await db.query.feriasLicencas.findFirst({\n      where: eq(feriasLicencas.id, id),\n      with: {\n        employee: true,\n        createdByUser: true,\n      },\n    });\n    return result;\n  }\n\n  async createFeriasLicenca(data: InsertFeriasLicencas): Promise<FeriasLicencas> {\n    const [created] = await db.insert(feriasLicencas).values(data).returning();\n    return created;\n  }\n\n  async updateFeriasLicenca(id: number, data: Partial<InsertFeriasLicencas>): Promise<FeriasLicencas | undefined> {\n    const [updated] = await db\n      .update(feriasLicencas)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(feriasLicencas.id, id))\n      .returning();\n    return updated;\n  }\n\n  async deleteFeriasLicenca(id: number): Promise<boolean> {\n    const result = await db.delete(feriasLicencas).where(eq(feriasLicencas.id, id));\n    return (result.rowCount ?? 0) > 0;\n  }\n\n  async getActiveFeriasLicencas(): Promise<FeriasLicencasWithRelations[]> {\n    const today = new Date().toISOString().split('T')[0];\n    const result = await db.query.feriasLicencas.findMany({\n      where: and(\n        lte(feriasLicencas.startDate, today),\n        gte(feriasLicencas.endDate, today),\n        or(\n          eq(feriasLicencas.status, 'aprovado'),\n          eq(feriasLicencas.status, 'em_andamento')\n        )\n      ),\n      with: {\n        employee: true,\n        createdByUser: true,\n      },\n      orderBy: [feriasLicencas.endDate],\n    });\n    return result;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":38090,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"contract-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","path":null,"size_bytes":1606,"size_tokens":null},"client/src/pages/service-posts/service-post-form.tsx":{"content":"import { useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport type { ServicePost } from \"@shared/schema\";\n\nconst formSchema = z.object({\n  postCode: z.string().min(1, translations.validation.required),\n  postName: z.string().min(2, \"Nome do posto deve ter pelo menos 2 caracteres\"),\n  description: z.string().optional(),\n  unit: z.string().min(2, translations.validation.required),\n  modality: z.enum([\"onsite\", \"hybrid\", \"remote\"]),\n  tipoPosto: z.string().optional(),\n  horarioTrabalho: z.string().optional(),\n  escalaRegime: z.string().optional(),\n  quantidadePrevista: z.coerce.number().int().min(0).optional().nullable(),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface ServicePostFormProps {\n  postId?: number;\n}\n\nexport default function ServicePostForm({ postId }: ServicePostFormProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const isEditing = !!postId;\n\n  const { data: servicePost, isLoading } = useQuery<ServicePost>({\n    queryKey: [\"/api/service-posts\", postId],\n    enabled: isEditing,\n  });\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      postCode: \"\",\n      postName: \"\",\n      description: \"\",\n      unit: \"\",\n      modality: \"onsite\",\n      tipoPosto: \"\",\n      horarioTrabalho: \"\",\n      escalaRegime: \"\",\n      quantidadePrevista: null,\n    },\n  });\n\n  useEffect(() => {\n    if (servicePost) {\n      form.reset({\n        postCode: servicePost.postCode,\n        postName: servicePost.postName,\n        description: servicePost.description || \"\",\n        unit: servicePost.unit,\n        modality: servicePost.modality,\n        tipoPosto: servicePost.tipoPosto || \"\",\n        horarioTrabalho: servicePost.horarioTrabalho || \"\",\n        escalaRegime: servicePost.escalaRegime || \"\",\n        quantidadePrevista: servicePost.quantidadePrevista ?? null,\n      });\n    }\n  }, [servicePost, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      if (isEditing) {\n        await apiRequest(\"PATCH\", `/api/service-posts/${postId}`, data);\n      } else {\n        await apiRequest(\"POST\", \"/api/service-posts\", data);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/service-posts\"] });\n      toast({\n        title: translations.common.success,\n        description: isEditing ? translations.servicePosts.postUpdated : translations.servicePosts.postCreated,\n      });\n      setLocation(\"/service-posts\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: translations.common.error,\n        description: error.message || translations.errors.saveError,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isEditing && isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title={translations.common.loading} />\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"animate-pulse space-y-4\">\n              <div className=\"h-10 bg-muted rounded\" />\n              <div className=\"h-10 bg-muted rounded\" />\n              <div className=\"h-24 bg-muted rounded\" />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={isEditing ? translations.servicePosts.editPost : translations.servicePosts.addPost}\n        description={isEditing ? \"Atualizar informações do posto de serviço\" : \"Criar um novo posto de serviço\"}\n      />\n\n      <Card className=\"max-w-3xl\">\n        <CardHeader>\n          <CardTitle>Informações do Posto de Serviço</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-6\">\n              <div className=\"grid gap-6 sm:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"postCode\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.servicePosts.postCode} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Ex: POST-001\" {...field} className=\"font-mono\" data-testid=\"input-post-code\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"modality\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.servicePosts.modality} *</FormLabel>\n                      <Select onValueChange={field.onChange} value={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-post-modality\">\n                            <SelectValue placeholder={translations.common.selectOption} />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          <SelectItem value=\"onsite\">{translations.servicePosts.onsite}</SelectItem>\n                          <SelectItem value=\"hybrid\">{translations.servicePosts.hybrid}</SelectItem>\n                          <SelectItem value=\"remote\">{translations.servicePosts.remote}</SelectItem>\n                        </SelectContent>\n                      </Select>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"postName\"\n                  render={({ field }) => (\n                    <FormItem className=\"sm:col-span-2\">\n                      <FormLabel>{translations.servicePosts.postName} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Digite o nome do posto\" {...field} data-testid=\"input-post-name\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"unit\"\n                  render={({ field }) => (\n                    <FormItem className=\"sm:col-span-2\">\n                      <FormLabel>{translations.common.unit} *</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Digite a unidade\" {...field} data-testid=\"input-post-unit\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem className=\"sm:col-span-2\">\n                      <FormLabel>{translations.common.description}</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Digite a descrição (opcional)\"\n                          rows={4}\n                          {...field}\n                          data-testid=\"input-post-description\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"tipoPosto\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.servicePosts.tipoPosto}</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Ex: Administrativo, Operacional\" \n                          {...field} \n                          value={field.value || \"\"} \n                          data-testid=\"input-tipo-posto\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"horarioTrabalho\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.servicePosts.horarioTrabalho}</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Ex: 08:00 - 17:00\" \n                          {...field} \n                          value={field.value || \"\"} \n                          data-testid=\"input-horario-trabalho\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"escalaRegime\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.servicePosts.escalaRegime}</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"Ex: 5x2, 12x36\" \n                          {...field} \n                          value={field.value || \"\"} \n                          data-testid=\"input-escala-regime\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"quantidadePrevista\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.servicePosts.quantidadePrevista}</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"number\" \n                          min=\"0\" \n                          placeholder=\"Ex: 5\" \n                          {...field} \n                          value={field.value ?? \"\"} \n                          onChange={(e) => field.onChange(e.target.value === \"\" ? null : parseInt(e.target.value, 10))}\n                          data-testid=\"input-quantidade-prevista\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <div className=\"flex justify-end gap-3\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setLocation(\"/service-posts\")}\n                  data-testid=\"button-cancel\"\n                >\n                  {translations.common.cancel}\n                </Button>\n                <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                  {mutation.isPending ? \"Salvando...\" : isEditing ? translations.common.update : translations.common.save}\n                </Button>\n              </div>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":12139,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/components/confirm-dialog.tsx":{"content":"import {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface ConfirmDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  title: string;\n  description: string;\n  confirmText?: string;\n  cancelText?: string;\n  onConfirm: () => void;\n  variant?: \"default\" | \"destructive\";\n  isLoading?: boolean;\n}\n\nexport function ConfirmDialog({\n  open,\n  onOpenChange,\n  title,\n  description,\n  confirmText = \"Confirm\",\n  cancelText = \"Cancel\",\n  onConfirm,\n  variant = \"default\",\n  isLoading,\n}: ConfirmDialogProps) {\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle data-testid=\"dialog-confirm-title\">{title}</AlertDialogTitle>\n          <AlertDialogDescription data-testid=\"dialog-confirm-description\">\n            {description}\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel disabled={isLoading} data-testid=\"button-dialog-cancel\">\n            {cancelText}\n          </AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onConfirm}\n            disabled={isLoading}\n            className={variant === \"destructive\" ? \"bg-destructive text-destructive-foreground hover:bg-destructive/90\" : \"\"}\n            data-testid=\"button-dialog-confirm\"\n          >\n            {isLoading ? \"Processing...\" : confirmText}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":1689,"size_tokens":null},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ThemeToggle } from \"@/components/theme-toggle\";\nimport { Building2, Users, Briefcase, CalendarDays, FileText, BarChart3, Shield, CheckCircle } from \"lucide-react\";\nimport { translations } from \"@/lib/translations\";\nimport { DicaLogo } from \"@/components/dica-logo\";\n\nconst features = [\n  {\n    icon: Users,\n    title: translations.landing.features.employees,\n    description: translations.landing.features.employeesDesc,\n  },\n  {\n    icon: Briefcase,\n    title: translations.landing.features.posts,\n    description: translations.landing.features.postsDesc,\n  },\n  {\n    icon: CalendarDays,\n    title: translations.landing.features.allocation,\n    description: translations.landing.features.allocationDesc,\n  },\n  {\n    icon: FileText,\n    title: translations.landing.features.documents,\n    description: translations.landing.features.documentsDesc,\n  },\n  {\n    icon: BarChart3,\n    title: translations.landing.features.reports,\n    description: translations.landing.features.reportsDesc,\n  },\n  {\n    icon: Shield,\n    title: translations.landing.features.audit,\n    description: translations.landing.features.auditDesc,\n  },\n];\n\nexport default function Landing() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <header className=\"sticky top-0 z-50 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n        <div className=\"container mx-auto px-6 lg:px-8\">\n          <div className=\"flex h-16 items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-3\">\n              <DicaLogo className=\"h-9 w-9\" />\n              <span className=\"text-lg font-semibold\">{translations.branding.appName}</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <ThemeToggle />\n              <Button asChild data-testid=\"button-login\">\n                <a href=\"/api/login\">{translations.auth.login}</a>\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      <main>\n        <section className=\"py-16 lg:py-24\">\n          <div className=\"container mx-auto px-6 lg:px-8\">\n            <div className=\"mx-auto max-w-3xl text-center\">\n              <h1 className=\"text-3xl font-semibold tracking-tight sm:text-4xl lg:text-5xl\" data-testid=\"text-hero-title\">\n                {translations.landing.title}\n              </h1>\n              <p className=\"mt-2 text-xl text-muted-foreground\">\n                {translations.landing.subtitle}\n              </p>\n              <p className=\"mt-4 text-lg text-muted-foreground\" data-testid=\"text-hero-description\">\n                {translations.landing.description}\n              </p>\n              <div className=\"mt-8 flex flex-col items-center gap-4 sm:flex-row sm:justify-center\">\n                <Button size=\"lg\" asChild data-testid=\"button-get-started\">\n                  <a href=\"/api/login\">{translations.landing.loginButton}</a>\n                </Button>\n                <Button size=\"lg\" variant=\"outline\" asChild data-testid=\"button-learn-more\">\n                  <a href=\"#features\">{translations.common.learnMore}</a>\n                </Button>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section id=\"features\" className=\"py-16 bg-muted/30\">\n          <div className=\"container mx-auto px-6 lg:px-8\">\n            <div className=\"mx-auto max-w-2xl text-center\">\n              <h2 className=\"text-2xl font-semibold tracking-tight sm:text-3xl\" data-testid=\"text-features-title\">\n                {translations.landing.everythingYouNeed}\n              </h2>\n              <p className=\"mt-2 text-muted-foreground\">\n                {translations.landing.completeTools}\n              </p>\n            </div>\n            <div className=\"mx-auto mt-12 grid max-w-5xl gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n              {features.map((feature, index) => (\n                <Card key={index} className=\"border bg-card\" data-testid={`card-feature-${index}`}>\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex h-10 w-10 items-center justify-center rounded-md bg-primary/10\">\n                      <feature.icon className=\"h-5 w-5 text-primary\" />\n                    </div>\n                    <CardTitle className=\"text-base font-medium mt-3\">{feature.title}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <CardDescription className=\"text-sm\">{feature.description}</CardDescription>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        <section className=\"py-16\">\n          <div className=\"container mx-auto px-6 lg:px-8\">\n            <div className=\"mx-auto max-w-3xl\">\n              <Card className=\"border-2 border-primary/20 bg-card\">\n                <CardHeader className=\"text-center\">\n                  <CardTitle className=\"text-xl font-semibold\">{translations.landing.roleBasedAccess}</CardTitle>\n                  <CardDescription>\n                    {translations.landing.accessLevelsDesigned}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid gap-6 sm:grid-cols-2\">\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <Shield className=\"h-5 w-5 text-primary\" />\n                        <span className=\"font-medium\">{translations.roles.admin}</span>\n                      </div>\n                      <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\n                          {translations.landing.fullAccessModules}\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\n                          {translations.landing.userManagementSettings}\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\n                          {translations.landing.uploadDocManagement}\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-primary\" />\n                          {translations.landing.reportGeneration}\n                        </li>\n                      </ul>\n                    </div>\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-5 w-5 text-muted-foreground\" />\n                        <span className=\"font-medium\">{translations.roles.viewer}</span>\n                      </div>\n                      <ul className=\"space-y-2 text-sm text-muted-foreground\">\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\n                          {translations.landing.viewAllRecords}\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\n                          {translations.landing.accessReportsAnalytics}\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\n                          {translations.landing.exportDataCsv}\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <CheckCircle className=\"h-4 w-4 text-muted-foreground\" />\n                          {translations.landing.downloadDocuments}\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n      </main>\n\n      <footer className=\"border-t py-8\">\n        <div className=\"container mx-auto px-6 lg:px-8\">\n          <div className=\"flex flex-col items-center justify-between gap-4 sm:flex-row\">\n            <div className=\"flex items-center gap-2\">\n              <DicaLogo className=\"h-5 w-5\" />\n              <span className=\"text-sm text-muted-foreground\">\n                {translations.branding.fullTitle}\n              </span>\n            </div>\n            <p className=\"text-sm text-muted-foreground\">\n              {translations.landing.solutionForContracts}\n            </p>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":9016,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/pages/employees/index.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Plus, Eye, Pencil, Trash2, Search, Filter, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { DataTable } from \"@/components/data-table\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { ConfirmDialog } from \"@/components/confirm-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport type { Employee } from \"@shared/schema\";\n\nexport default function EmployeesPage() {\n  const { isAdmin } = useAuth();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [unitFilter, setUnitFilter] = useState<string>(\"all\");\n  const [deleteId, setDeleteId] = useState<number | null>(null);\n\n  const { data: employees, isLoading } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/employees/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/employees\"] });\n      toast({ title: translations.common.success, description: translations.employees.employeeDeleted });\n      setDeleteId(null);\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.deleteError, variant: \"destructive\" });\n    },\n  });\n\n  const uniqueUnits = useMemo(() => {\n    const units = new Set<string>();\n    employees?.forEach(e => units.add(e.unit));\n    return Array.from(units).sort();\n  }, [employees]);\n\n  const filteredEmployees = employees?.filter((employee) => {\n    const matchesSearch = \n      employee.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      employee.cpf.includes(searchQuery) ||\n      employee.unit.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesStatus = statusFilter === \"all\" || employee.status === statusFilter;\n    const matchesUnit = unitFilter === \"all\" || employee.unit === unitFilter;\n    return matchesSearch && matchesStatus && matchesUnit;\n  }) || [];\n\n  const activeFilters = [\n    statusFilter !== \"all\" ? `${translations.common.status}: ${statusFilter === \"active\" ? translations.employees.active : translations.employees.inactive}` : null,\n    unitFilter !== \"all\" ? `${translations.common.unit}: ${unitFilter}` : null,\n  ].filter(Boolean);\n\n  const clearFilters = () => {\n    setStatusFilter(\"all\");\n    setUnitFilter(\"all\");\n  };\n\n  const columns = [\n    {\n      key: \"name\",\n      header: translations.employees.name,\n      cell: (employee: Employee) => (\n        <div className=\"font-medium\" data-testid={`text-employee-name-${employee.id}`}>\n          {employee.name}\n        </div>\n      ),\n    },\n    {\n      key: \"cpf\",\n      header: translations.employees.cpf,\n      cell: (employee: Employee) => (\n        <span className=\"font-mono text-sm\" data-testid={`text-employee-cpf-${employee.id}`}>\n          {employee.cpf}\n        </span>\n      ),\n    },\n    {\n      key: \"function\",\n      header: translations.employees.functionPost,\n      cell: (employee: Employee) => employee.functionPost,\n    },\n    {\n      key: \"unit\",\n      header: translations.employees.unit,\n      cell: (employee: Employee) => employee.unit,\n    },\n    {\n      key: \"status\",\n      header: translations.employees.status,\n      cell: (employee: Employee) => (\n        <StatusBadge status={employee.status} />\n      ),\n    },\n    {\n      key: \"actions\",\n      header: translations.common.actions,\n      className: \"text-right\",\n      cell: (employee: Employee) => (\n        <div className=\"flex items-center justify-end gap-1\">\n          <Button variant=\"ghost\" size=\"icon\" asChild data-testid={`button-view-employee-${employee.id}`}>\n            <Link href={`/employees/${employee.id}`}>\n              <Eye className=\"h-4 w-4\" />\n            </Link>\n          </Button>\n          {isAdmin && (\n            <>\n              <Button variant=\"ghost\" size=\"icon\" asChild data-testid={`button-edit-employee-${employee.id}`}>\n                <Link href={`/employees/${employee.id}/edit`}>\n                  <Pencil className=\"h-4 w-4\" />\n                </Link>\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setDeleteId(employee.id)}\n                data-testid={`button-delete-employee-${employee.id}`}\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.employees.title}\n        description={translations.employees.description}\n      >\n        {isAdmin && (\n          <Button asChild data-testid=\"button-add-employee\">\n            <Link href=\"/employees/new\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {translations.employees.addEmployee}\n            </Link>\n          </Button>\n        )}\n      </PageHeader>\n\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center\">\n          <div className=\"relative flex-1 max-w-sm\">\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n            <Input\n              placeholder={translations.employees.searchPlaceholder}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9\"\n              data-testid=\"input-search-employees\"\n            />\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <Filter className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n            <Select value={statusFilter} onValueChange={setStatusFilter}>\n              <SelectTrigger className=\"w-[130px]\" data-testid=\"select-status-filter\">\n                <SelectValue placeholder={translations.common.status} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{translations.employees.allStatuses}</SelectItem>\n                <SelectItem value=\"active\">{translations.employees.active}</SelectItem>\n                <SelectItem value=\"inactive\">{translations.employees.inactive}</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={unitFilter} onValueChange={setUnitFilter}>\n              <SelectTrigger className=\"w-[150px]\" data-testid=\"select-unit-filter\">\n                <SelectValue placeholder={translations.common.unit} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{translations.employees.allUnits}</SelectItem>\n                {uniqueUnits.map((unit) => (\n                  <SelectItem key={unit} value={unit}>{unit}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n        {activeFilters.length > 0 && (\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <span className=\"text-sm text-muted-foreground\">{translations.common.filter}:</span>\n            {activeFilters.map((filter) => (\n              <Badge key={filter} variant=\"secondary\" className=\"text-xs\">\n                {filter}\n              </Badge>\n            ))}\n            <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters} className=\"h-7 px-2\" data-testid=\"button-clear-filters\">\n              <X className=\"h-3 w-3 mr-1\" />\n              {translations.common.clearFilters}\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <DataTable\n        columns={columns}\n        data={filteredEmployees}\n        isLoading={isLoading}\n        emptyMessage={translations.employees.noEmployees}\n        emptyDescription={translations.employees.addEmployee}\n        testIdPrefix=\"employees\"\n      />\n\n      <ConfirmDialog\n        open={deleteId !== null}\n        onOpenChange={(open) => !open && setDeleteId(null)}\n        title={translations.employees.deleteEmployee}\n        description={translations.employees.deleteConfirm}\n        confirmText={translations.common.delete}\n        onConfirm={() => deleteId && deleteMutation.mutate(deleteId)}\n        variant=\"destructive\"\n        isLoading={deleteMutation.isPending}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":8874,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useTheme } from \"@/components/theme-provider\";\n\nexport function ThemeToggle() {\n  const { setTheme } = useTheme();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-theme-toggle\">\n          <Sun className=\"h-4 w-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0\" />\n          <Moon className=\"absolute h-4 w-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100\" />\n          <span className=\"sr-only\">Toggle theme</span>\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        <DropdownMenuItem onClick={() => setTheme(\"light\")} data-testid=\"menu-item-light\">\n          Light\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"dark\")} data-testid=\"menu-item-dark\">\n          Dark\n        </DropdownMenuItem>\n        <DropdownMenuItem onClick={() => setTheme(\"system\")} data-testid=\"menu-item-system\">\n          System\n        </DropdownMenuItem>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n","path":null,"size_bytes":1307,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/pages/reports.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format, startOfMonth, endOfMonth, eachDayOfInterval } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { Download, FileSpreadsheet, Calendar, AlertCircle, FileText, TrendingUp, BarChart3 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { StatusBadge, CategoryBadge } from \"@/components/status-badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { getMonthYearOptions, formatDate } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line } from \"recharts\";\nimport type { Allocation, Occurrence, Document, Employee, ServicePost } from \"@shared/schema\";\n\ntype PrevistoRealizadoReport = {\n  summary: { totalPrevisto: number; totalRealizado: number; compliancePercentage: number };\n  byPost: Array<{\n    postId: number;\n    postCode: string;\n    postName: string;\n    previsto: number;\n    realizado: number;\n    compliance: number;\n  }>;\n  byDate: Array<{\n    date: string;\n    previsto: number;\n    realizado: number;\n  }>;\n};\n\nexport default function ReportsPage() {\n  const [selectedMonth, setSelectedMonth] = useState(format(new Date(), \"yyyy-MM\"));\n  const [selectedPostId, setSelectedPostId] = useState<string>(\"all\");\n  const monthYearOptions = getMonthYearOptions();\n\n  const { data: employees } = useQuery<Employee[]>({ queryKey: [\"/api/employees\"] });\n  const { data: servicePosts } = useQuery<ServicePost[]>({ queryKey: [\"/api/service-posts\"] });\n  const { data: allocations, isLoading: allocationsLoading } = useQuery<Allocation[]>({ queryKey: [\"/api/allocations\"] });\n  const { data: occurrences, isLoading: occurrencesLoading } = useQuery<Occurrence[]>({ queryKey: [\"/api/occurrences\"] });\n  const { data: documents, isLoading: documentsLoading } = useQuery<Document[]>({ queryKey: [\"/api/documents\"] });\n\n  const [year, month] = selectedMonth.split(\"-\").map(Number);\n  const monthStart = startOfMonth(new Date(year, month - 1));\n  const monthEnd = endOfMonth(new Date(year, month - 1));\n  const startDateStr = format(monthStart, \"yyyy-MM-dd\");\n  const endDateStr = format(monthEnd, \"yyyy-MM-dd\");\n\n  const { data: previstoRealizadoReport, isLoading: previstoLoading } = useQuery<PrevistoRealizadoReport>({\n    queryKey: [\"/api/reports/previsto-realizado\", startDateStr, endDateStr, selectedPostId],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        startDate: startDateStr,\n        endDate: endDateStr,\n      });\n      if (selectedPostId !== \"all\") {\n        params.append(\"postId\", selectedPostId);\n      }\n      const res = await fetch(`/api/reports/previsto-realizado?${params}`, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch report\");\n      return res.json();\n    },\n  });\n\n  const employeeMap = new Map(employees?.map(e => [e.id, e]) || []);\n  const postMap = new Map(servicePosts?.map(p => [p.id, p]) || []);\n\n  const filteredAllocations = allocations?.filter(a => {\n    const d = new Date(a.date);\n    return d >= monthStart && d <= monthEnd;\n  }) || [];\n\n  const filteredOccurrences = occurrences?.filter(o => {\n    const d = new Date(o.date);\n    return d >= monthStart && d <= monthEnd;\n  }) || [];\n\n  const downloadAllocationCSV = () => {\n    const headers = [\"Data\", \"Funcionário\", \"Posto de Serviço\", \"Status\", \"Observações\"];\n    const rows = filteredAllocations.map(a => [\n      a.date,\n      employeeMap.get(a.employeeId)?.name || \"\",\n      postMap.get(a.postId)?.postName || \"\",\n      a.status,\n      a.notes || \"\",\n    ]);\n\n    const csvContent = [headers, ...rows].map(row => row.map(cell => `\"${cell}\"`).join(\",\")).join(\"\\n\");\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `alocacoes-${selectedMonth}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  const downloadOccurrenceCSV = () => {\n    const headers = [\"Data\", \"Categoria\", \"Funcionário\", \"Descrição\"];\n    const rows = filteredOccurrences.map(o => [\n      o.date,\n      o.category,\n      o.employeeId ? (employeeMap.get(o.employeeId)?.name || \"\") : \"\",\n      o.description,\n    ]);\n\n    const csvContent = [headers, ...rows].map(row => row.map(cell => `\"${cell}\"`).join(\",\")).join(\"\\n\");\n    const blob = new Blob([csvContent], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `ocorrencias-${selectedMonth}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.reports.title}\n        description={translations.reports.description}\n      />\n\n      <div className=\"flex items-center gap-4\">\n        <span className=\"text-sm text-muted-foreground\">Período:</span>\n        <Select value={selectedMonth} onValueChange={setSelectedMonth}>\n          <SelectTrigger className=\"w-[200px]\" data-testid=\"select-report-month\">\n            <SelectValue placeholder={translations.reports.selectMonth} />\n          </SelectTrigger>\n          <SelectContent>\n            {monthYearOptions.map((opt) => (\n              <SelectItem key={opt.value} value={opt.value}>\n                {opt.label}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      <Tabs defaultValue=\"allocations\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"allocations\" data-testid=\"tab-allocations\">\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            {translations.nav.allocation}\n          </TabsTrigger>\n          <TabsTrigger value=\"occurrences\" data-testid=\"tab-occurrences\">\n            <AlertCircle className=\"h-4 w-4 mr-2\" />\n            {translations.nav.occurrences}\n          </TabsTrigger>\n          <TabsTrigger value=\"documents\" data-testid=\"tab-documents\">\n            <FileText className=\"h-4 w-4 mr-2\" />\n            {translations.nav.documents}\n          </TabsTrigger>\n          <TabsTrigger value=\"previsto-realizado\" data-testid=\"tab-previsto-realizado\">\n            <BarChart3 className=\"h-4 w-4 mr-2\" />\n            Previsto x Realizado\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"allocations\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n              <div>\n                <CardTitle>{translations.reports.dailyAllocation}</CardTitle>\n                <CardDescription>\n                  {filteredAllocations.length} registros de alocação para {format(monthStart, \"MMMM 'de' yyyy\", { locale: ptBR })}\n                </CardDescription>\n              </div>\n              <Button variant=\"outline\" onClick={downloadAllocationCSV} data-testid=\"button-download-allocations\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                {translations.reports.exportCsv}\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {allocationsLoading ? (\n                <div className=\"space-y-2\">\n                  {Array.from({ length: 5 }).map((_, i) => <Skeleton key={i} className=\"h-12 w-full\" />)}\n                </div>\n              ) : filteredAllocations.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">{translations.allocation.noAllocationsInMonth}</div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>{translations.common.date}</TableHead>\n                        <TableHead>{translations.occurrences.employee}</TableHead>\n                        <TableHead>{translations.nav.servicePosts}</TableHead>\n                        <TableHead>{translations.common.status}</TableHead>\n                        <TableHead>{translations.allocation.notes}</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredAllocations.slice(0, 50).map((allocation) => (\n                        <TableRow key={allocation.id}>\n                          <TableCell>{formatDate(allocation.date)}</TableCell>\n                          <TableCell>{employeeMap.get(allocation.employeeId)?.name || \"-\"}</TableCell>\n                          <TableCell>{postMap.get(allocation.postId)?.postName || \"-\"}</TableCell>\n                          <TableCell><StatusBadge status={allocation.status} /></TableCell>\n                          <TableCell className=\"max-w-[200px] truncate\">{allocation.notes || \"-\"}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                  {filteredAllocations.length > 50 && (\n                    <p className=\"text-sm text-muted-foreground mt-2\">Mostrando 50 de {filteredAllocations.length} registros. Exporte o CSV para dados completos.</p>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"occurrences\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-4\">\n              <div>\n                <CardTitle>{translations.reports.occurrencesList}</CardTitle>\n                <CardDescription>\n                  {filteredOccurrences.length} ocorrências para {format(monthStart, \"MMMM 'de' yyyy\", { locale: ptBR })}\n                </CardDescription>\n              </div>\n              <Button variant=\"outline\" onClick={downloadOccurrenceCSV} data-testid=\"button-download-occurrences\">\n                <Download className=\"h-4 w-4 mr-2\" />\n                {translations.reports.exportCsv}\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {occurrencesLoading ? (\n                <div className=\"space-y-2\">\n                  {Array.from({ length: 5 }).map((_, i) => <Skeleton key={i} className=\"h-12 w-full\" />)}\n                </div>\n              ) : filteredOccurrences.length === 0 ? (\n                <div className=\"text-center py-8 text-muted-foreground\">{translations.occurrences.noOccurrences}</div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>{translations.common.date}</TableHead>\n                        <TableHead>{translations.occurrences.category}</TableHead>\n                        <TableHead>{translations.occurrences.employee}</TableHead>\n                        <TableHead>{translations.common.description}</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredOccurrences.map((occurrence) => (\n                        <TableRow key={occurrence.id}>\n                          <TableCell>{formatDate(occurrence.date)}</TableCell>\n                          <TableCell><CategoryBadge category={occurrence.category} /></TableCell>\n                          <TableCell>{occurrence.employeeId ? employeeMap.get(occurrence.employeeId)?.name : \"-\"}</TableCell>\n                          <TableCell className=\"max-w-[300px] truncate\">{occurrence.description}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"documents\">\n          <Card>\n            <CardHeader>\n              <CardTitle>{translations.reports.documentsSent}</CardTitle>\n              <CardDescription>Resumo de todos os documentos enviados</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {documentsLoading ? (\n                <div className=\"space-y-2\">\n                  {Array.from({ length: 3 }).map((_, i) => <Skeleton key={i} className=\"h-16 w-full\" />)}\n                </div>\n              ) : (\n                <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-4\">\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"text-2xl font-semibold\">{documents?.filter(d => d.documentType === \"aso\").length || 0}</div>\n                      <div className=\"text-sm text-muted-foreground\">{translations.documents.aso}</div>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"text-2xl font-semibold\">{documents?.filter(d => d.documentType === \"certification\").length || 0}</div>\n                      <div className=\"text-sm text-muted-foreground\">{translations.documents.certification}</div>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"text-2xl font-semibold\">{documents?.filter(d => d.documentType === \"evidence\").length || 0}</div>\n                      <div className=\"text-sm text-muted-foreground\">{translations.documents.evidence}</div>\n                    </CardContent>\n                  </Card>\n                  <Card>\n                    <CardContent className=\"p-4\">\n                      <div className=\"text-2xl font-semibold\">{documents?.length || 0}</div>\n                      <div className=\"text-sm text-muted-foreground\">Total de Documentos</div>\n                    </CardContent>\n                  </Card>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"previsto-realizado\">\n          <div className=\"space-y-6\">\n            <div className=\"flex flex-wrap items-center gap-4\">\n              <span className=\"text-sm text-muted-foreground\">Filtrar por Posto:</span>\n              <Select value={selectedPostId} onValueChange={setSelectedPostId}>\n                <SelectTrigger className=\"w-[250px]\" data-testid=\"select-post-filter\">\n                  <SelectValue placeholder=\"Todos os Postos\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos os Postos</SelectItem>\n                  {servicePosts?.map((post) => (\n                    <SelectItem key={post.id} value={post.id.toString()}>\n                      {post.postCode} - {post.postName}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"grid gap-4 sm:grid-cols-3\">\n              <Card>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Calendar className=\"h-5 w-5 text-muted-foreground\" />\n                    <span className=\"text-sm text-muted-foreground\">Total Previsto</span>\n                  </div>\n                  <div className=\"text-3xl font-bold mt-2\" data-testid=\"text-total-previsto\">\n                    {previstoLoading ? <Skeleton className=\"h-9 w-20\" /> : previstoRealizadoReport?.summary.totalPrevisto || 0}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">alocações planejadas</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"h-5 w-5 text-muted-foreground\" />\n                    <span className=\"text-sm text-muted-foreground\">Total Realizado</span>\n                  </div>\n                  <div className=\"text-3xl font-bold mt-2\" data-testid=\"text-total-realizado\">\n                    {previstoLoading ? <Skeleton className=\"h-9 w-20\" /> : previstoRealizadoReport?.summary.totalRealizado || 0}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">presenças confirmadas</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <BarChart3 className=\"h-5 w-5 text-muted-foreground\" />\n                    <span className=\"text-sm text-muted-foreground\">Taxa de Cumprimento</span>\n                  </div>\n                  <div className=\"text-3xl font-bold mt-2\" data-testid=\"text-compliance-rate\">\n                    {previstoLoading ? <Skeleton className=\"h-9 w-20\" /> : (\n                      <span className={\n                        (previstoRealizadoReport?.summary.compliancePercentage || 0) >= 90 ? \"text-green-600 dark:text-green-400\" :\n                        (previstoRealizadoReport?.summary.compliancePercentage || 0) >= 70 ? \"text-yellow-600 dark:text-yellow-400\" :\n                        \"text-red-600 dark:text-red-400\"\n                      }>\n                        {previstoRealizadoReport?.summary.compliancePercentage || 0}%\n                      </span>\n                    )}\n                  </div>\n                  <div className=\"text-sm text-muted-foreground\">realizado / previsto</div>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Comparativo por Posto de Serviço</CardTitle>\n                <CardDescription>Previstos vs Realizados para {format(monthStart, \"MMMM 'de' yyyy\", { locale: ptBR })}</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {previstoLoading ? (\n                  <Skeleton className=\"h-[300px] w-full\" />\n                ) : !previstoRealizadoReport?.byPost.length ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">Nenhum dado disponível para o período selecionado</div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={300}>\n                    <BarChart data={previstoRealizadoReport.byPost} margin={{ top: 20, right: 30, left: 20, bottom: 60 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis \n                        dataKey=\"postCode\" \n                        angle={-45} \n                        textAnchor=\"end\" \n                        height={60}\n                        tick={{ fontSize: 12 }}\n                        className=\"fill-muted-foreground\"\n                      />\n                      <YAxis className=\"fill-muted-foreground\" />\n                      <Tooltip \n                        contentStyle={{ backgroundColor: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }}\n                        labelStyle={{ color: 'hsl(var(--foreground))' }}\n                      />\n                      <Legend />\n                      <Bar dataKey=\"previsto\" name=\"Previsto\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\n                      <Bar dataKey=\"realizado\" name=\"Realizado\" fill=\"hsl(142.1 76.2% 36.3%)\" radius={[4, 4, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Evolução Diária</CardTitle>\n                <CardDescription>Tendência de presenças ao longo do mês</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {previstoLoading ? (\n                  <Skeleton className=\"h-[250px] w-full\" />\n                ) : !previstoRealizadoReport?.byDate.length ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">Nenhum dado disponível para o período selecionado</div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height={250}>\n                    <LineChart data={previstoRealizadoReport.byDate} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis \n                        dataKey=\"date\" \n                        tick={{ fontSize: 10 }}\n                        tickFormatter={(value) => format(new Date(value), \"dd/MM\")}\n                        className=\"fill-muted-foreground\"\n                      />\n                      <YAxis className=\"fill-muted-foreground\" />\n                      <Tooltip \n                        contentStyle={{ backgroundColor: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }}\n                        labelFormatter={(value) => format(new Date(value), \"dd/MM/yyyy\")}\n                      />\n                      <Legend />\n                      <Line type=\"monotone\" dataKey=\"previsto\" name=\"Previsto\" stroke=\"hsl(var(--primary))\" strokeWidth={2} dot={{ r: 3 }} />\n                      <Line type=\"monotone\" dataKey=\"realizado\" name=\"Realizado\" stroke=\"hsl(142.1 76.2% 36.3%)\" strokeWidth={2} dot={{ r: 3 }} />\n                    </LineChart>\n                  </ResponsiveContainer>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Detalhamento por Posto</CardTitle>\n                <CardDescription>Dados completos de previsto vs realizado</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {previstoLoading ? (\n                  <div className=\"space-y-2\">\n                    {Array.from({ length: 5 }).map((_, i) => <Skeleton key={i} className=\"h-12 w-full\" />)}\n                  </div>\n                ) : !previstoRealizadoReport?.byPost.length ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">Nenhum dado disponível para o período selecionado</div>\n                ) : (\n                  <div className=\"overflow-x-auto\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead>Código</TableHead>\n                          <TableHead>Posto de Serviço</TableHead>\n                          <TableHead className=\"text-right\">Previsto</TableHead>\n                          <TableHead className=\"text-right\">Realizado</TableHead>\n                          <TableHead className=\"text-right\">Diferença</TableHead>\n                          <TableHead className=\"text-right\">Cumprimento</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {previstoRealizadoReport.byPost.map((row) => (\n                          <TableRow key={row.postId} data-testid={`row-post-${row.postId}`}>\n                            <TableCell className=\"font-medium\">{row.postCode}</TableCell>\n                            <TableCell>{row.postName}</TableCell>\n                            <TableCell className=\"text-right\">{row.previsto}</TableCell>\n                            <TableCell className=\"text-right\">{row.realizado}</TableCell>\n                            <TableCell className=\"text-right\">\n                              <span className={row.realizado - row.previsto >= 0 ? \"text-green-600 dark:text-green-400\" : \"text-red-600 dark:text-red-400\"}>\n                                {row.realizado - row.previsto >= 0 ? \"+\" : \"\"}{row.realizado - row.previsto}\n                              </span>\n                            </TableCell>\n                            <TableCell className=\"text-right\">\n                              <Badge variant={row.compliance >= 90 ? \"default\" : row.compliance >= 70 ? \"secondary\" : \"destructive\"}>\n                                {row.compliance}%\n                              </Badge>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":24883,"size_tokens":null},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}\n\nexport function formatCPF(value: string): string {\n  const numbers = value.replace(/\\D/g, '');\n  return numbers\n    .replace(/(\\d{3})(\\d)/, '$1.$2')\n    .replace(/(\\d{3})(\\d)/, '$1.$2')\n    .replace(/(\\d{3})(\\d{1,2})$/, '$1-$2')\n    .slice(0, 14);\n}\n\nexport function formatDate(date: string | Date): string {\n  const d = new Date(date);\n  return d.toLocaleDateString('pt-BR');\n}\n\nexport function formatDateTime(date: string | Date): string {\n  const d = new Date(date);\n  return d.toLocaleString('pt-BR');\n}\n\nexport function getMonthYearOptions(startYear: number = 2024): { value: string; label: string }[] {\n  const options: { value: string; label: string }[] = [];\n  const currentDate = new Date();\n  const currentYear = currentDate.getFullYear();\n  const currentMonth = currentDate.getMonth();\n\n  for (let year = startYear; year <= currentYear; year++) {\n    const maxMonth = year === currentYear ? currentMonth : 11;\n    for (let month = 0; month <= maxMonth; month++) {\n      const monthStr = String(month + 1).padStart(2, '0');\n      const value = `${year}-${monthStr}`;\n      const label = new Date(year, month).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });\n      options.push({ value, label: label.charAt(0).toUpperCase() + label.slice(1) });\n    }\n  }\n\n  return options.reverse();\n}\n\nexport function getDaysInMonth(year: number, month: number): number {\n  return new Date(year, month + 1, 0).getDate();\n}\n\nexport function generateMonthDates(year: number, month: number): Date[] {\n  const days = getDaysInMonth(year, month);\n  return Array.from({ length: days }, (_, i) => new Date(year, month, i + 1));\n}\n","path":null,"size_bytes":1750,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":395,"size_tokens":null},"shared/schema.ts":{"content":"import { sql, relations } from \"drizzle-orm\";\nimport {\n  index,\n  jsonb,\n  pgTable,\n  timestamp,\n  varchar,\n  text,\n  integer,\n  date,\n  boolean,\n  pgEnum,\n} from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const userRoleEnum = pgEnum(\"user_role\", [\"admin\", \"admin_dica\", \"operator_dica\", \"fiscal_petrobras\", \"viewer\"]);\nexport const employeeStatusEnum = pgEnum(\"employee_status\", [\"active\", \"inactive\"]);\nexport const modalityEnum = pgEnum(\"modality\", [\"onsite\", \"hybrid\", \"remote\"]);\nexport const allocationStatusEnum = pgEnum(\"allocation_status\", [\"present\", \"absent\", \"justified\", \"vacation\", \"medical_leave\"]);\nexport const occurrenceCategoryEnum = pgEnum(\"occurrence_category\", [\"absence\", \"substitution\", \"issue\", \"note\"]);\nexport const documentTypeEnum = pgEnum(\"document_type\", [\"aso\", \"certification\", \"evidence\", \"contract\", \"other\"]);\nexport const documentCategoryEnum = pgEnum(\"document_category\", [\"atestados\", \"comprovantes\", \"relatorios_mensais\", \"evidencias_posto\", \"treinamentos\", \"certidoes\", \"outros\"]);\nexport const alertTypeEnum = pgEnum(\"alert_type\", [\"unallocated_employee\", \"expired_document\", \"untreated_occurrence\"]);\nexport const alertStatusEnum = pgEnum(\"alert_status\", [\"pending\", \"resolved\"]);\nexport const lgpdAccessTypeEnum = pgEnum(\"lgpd_access_type\", [\"view\", \"export\", \"search\"]);\nexport const lgpdDataCategoryEnum = pgEnum(\"lgpd_data_category\", [\"personal_data\", \"sensitive_data\", \"financial_data\"]);\nexport const feriasLicencasTypeEnum = pgEnum(\"ferias_licencas_type\", [\n  \"ferias\", \n  \"licenca_medica\", \n  \"licenca_maternidade\", \n  \"licenca_paternidade\", \n  \"licenca_nojo\", \n  \"licenca_casamento\",\n  \"outros\"\n]);\nexport const feriasLicencasStatusEnum = pgEnum(\"ferias_licencas_status\", [\n  \"pendente\", \n  \"aprovado\", \n  \"rejeitado\", \n  \"em_andamento\", \n  \"concluido\"\n]);\n\n// Session storage table - Required for Replit Auth\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Users table - Required for Replit Auth with role extension\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: userRoleEnum(\"role\").default(\"viewer\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Employees table\nexport const employees = pgTable(\"employees\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  cpf: varchar(\"cpf\", { length: 14 }).notNull().unique(),\n  functionPost: varchar(\"function_post\", { length: 255 }).notNull(),\n  unit: varchar(\"unit\", { length: 255 }).notNull(),\n  status: employeeStatusEnum(\"status\").default(\"active\").notNull(),\n  admissionDate: date(\"admission_date\"),\n  linkedPostId: integer(\"linked_post_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Service Posts table (Anexo 1A enhanced)\nexport const servicePosts = pgTable(\"service_posts\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  postCode: varchar(\"post_code\", { length: 50 }).notNull().unique(),\n  postName: varchar(\"post_name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  unit: varchar(\"unit\", { length: 255 }).notNull(),\n  modality: modalityEnum(\"modality\").default(\"onsite\").notNull(),\n  tipoPosto: varchar(\"tipo_posto\", { length: 100 }),\n  horarioTrabalho: varchar(\"horario_trabalho\", { length: 100 }),\n  escalaRegime: varchar(\"escala_regime\", { length: 100 }),\n  quantidadePrevista: integer(\"quantidade_prevista\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Allocations table\nexport const allocations = pgTable(\"allocations\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  employeeId: integer(\"employee_id\").notNull().references(() => employees.id, { onDelete: \"cascade\" }),\n  postId: integer(\"post_id\").notNull().references(() => servicePosts.id, { onDelete: \"cascade\" }),\n  date: date(\"date\").notNull(),\n  status: allocationStatusEnum(\"status\").default(\"present\").notNull(),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Occurrences table (enhanced with treated status)\nexport const occurrences = pgTable(\"occurrences\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  date: date(\"date\").notNull(),\n  employeeId: integer(\"employee_id\").references(() => employees.id, { onDelete: \"set null\" }),\n  postId: integer(\"post_id\").references(() => servicePosts.id, { onDelete: \"set null\" }),\n  description: text(\"description\").notNull(),\n  category: occurrenceCategoryEnum(\"category\").notNull(),\n  treated: boolean(\"treated\").default(false).notNull(),\n  treatedBy: varchar(\"treated_by\").references(() => users.id, { onDelete: \"set null\" }),\n  treatedAt: timestamp(\"treated_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Documents table (Anexo 1B enhanced with version tracking)\nexport const documents = pgTable(\"documents\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  filename: varchar(\"filename\", { length: 255 }).notNull(),\n  originalName: varchar(\"original_name\", { length: 255 }).notNull(),\n  mimeType: varchar(\"mime_type\", { length: 100 }).notNull(),\n  size: integer(\"size\").notNull(),\n  path: varchar(\"path\", { length: 500 }).notNull(),\n  documentType: documentTypeEnum(\"document_type\").default(\"other\").notNull(),\n  category: documentCategoryEnum(\"category\").default(\"outros\"),\n  employeeId: integer(\"employee_id\").references(() => employees.id, { onDelete: \"set null\" }),\n  postId: integer(\"post_id\").references(() => servicePosts.id, { onDelete: \"set null\" }),\n  monthYear: varchar(\"month_year\", { length: 7 }),\n  expirationDate: date(\"expiration_date\"),\n  observations: text(\"observations\"),\n  uploadedBy: varchar(\"uploaded_by\").references(() => users.id, { onDelete: \"set null\" }),\n  version: integer(\"version\").default(1).notNull(),\n  previousVersionId: integer(\"previous_version_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Document Checklists table (required documents per posto)\nexport const documentChecklists = pgTable(\"document_checklists\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  postId: integer(\"post_id\").notNull().references(() => servicePosts.id, { onDelete: \"cascade\" }),\n  documentType: documentTypeEnum(\"document_type\").notNull(),\n  name: varchar(\"name\", { length: 255 }).notNull(),\n  description: text(\"description\"),\n  isRequired: boolean(\"is_required\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Audit Logs table (enhanced with diff tracking)\nexport const auditLogs = pgTable(\"audit_logs\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"set null\" }),\n  action: varchar(\"action\", { length: 50 }).notNull(),\n  entityType: varchar(\"entity_type\", { length: 100 }).notNull(),\n  entityId: varchar(\"entity_id\", { length: 100 }),\n  details: jsonb(\"details\"),\n  diffBefore: jsonb(\"diff_before\"),\n  diffAfter: jsonb(\"diff_after\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Notification Settings table\nexport const notificationSettings = pgTable(\"notification_settings\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"cascade\" }),\n  email: varchar(\"email\", { length: 255 }).notNull(),\n  notifyNewOccurrences: boolean(\"notify_new_occurrences\").default(true).notNull(),\n  notifyMissingAllocations: boolean(\"notify_missing_allocations\").default(true).notNull(),\n  notifyDocumentExpiration: boolean(\"notify_document_expiration\").default(true).notNull(),\n  notifyDailySummary: boolean(\"notify_daily_summary\").default(false).notNull(),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Alerts table (for workflows)\nexport const alerts = pgTable(\"alerts\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  type: alertTypeEnum(\"type\").notNull(),\n  status: alertStatusEnum(\"status\").default(\"pending\").notNull(),\n  message: text(\"message\").notNull(),\n  entityType: varchar(\"entity_type\", { length: 50 }),\n  entityId: integer(\"entity_id\"),\n  resolvedBy: varchar(\"resolved_by\").references(() => users.id, { onDelete: \"set null\" }),\n  resolvedAt: timestamp(\"resolved_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// LGPD Logs table (for data protection compliance)\nexport const lgpdLogs = pgTable(\"lgpd_logs\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  userId: varchar(\"user_id\").references(() => users.id, { onDelete: \"set null\" }),\n  accessType: lgpdAccessTypeEnum(\"access_type\").notNull(),\n  dataCategory: lgpdDataCategoryEnum(\"data_category\").notNull(),\n  entityType: varchar(\"entity_type\", { length: 100 }).notNull(),\n  entityId: varchar(\"entity_id\", { length: 100 }),\n  ipAddress: varchar(\"ip_address\", { length: 45 }),\n  userAgent: text(\"user_agent\"),\n  details: jsonb(\"details\"),\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Férias e Licenças table\nexport const feriasLicencas = pgTable(\"ferias_licencas\", {\n  id: integer(\"id\").primaryKey().generatedAlwaysAsIdentity(),\n  employeeId: integer(\"employee_id\").notNull().references(() => employees.id, { onDelete: \"cascade\" }),\n  type: feriasLicencasTypeEnum(\"type\").notNull(),\n  startDate: date(\"start_date\").notNull(),\n  endDate: date(\"end_date\").notNull(),\n  status: feriasLicencasStatusEnum(\"status\").default(\"pendente\").notNull(),\n  observations: text(\"observations\"),\n  createdBy: varchar(\"created_by\").references(() => users.id, { onDelete: \"set null\" }),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  documents: many(documents),\n  auditLogs: many(auditLogs),\n  notificationSettings: many(notificationSettings),\n  resolvedAlerts: many(alerts),\n  lgpdLogs: many(lgpdLogs),\n}));\n\nexport const notificationSettingsRelations = relations(notificationSettings, ({ one }) => ({\n  user: one(users, {\n    fields: [notificationSettings.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const employeesRelations = relations(employees, ({ one, many }) => ({\n  linkedPost: one(servicePosts, {\n    fields: [employees.linkedPostId],\n    references: [servicePosts.id],\n  }),\n  allocations: many(allocations),\n  occurrences: many(occurrences),\n  documents: many(documents),\n  feriasLicencas: many(feriasLicencas),\n}));\n\nexport const servicePostsRelations = relations(servicePosts, ({ many }) => ({\n  allocations: many(allocations),\n  documents: many(documents),\n  checklists: many(documentChecklists),\n}));\n\nexport const documentChecklistsRelations = relations(documentChecklists, ({ one }) => ({\n  post: one(servicePosts, {\n    fields: [documentChecklists.postId],\n    references: [servicePosts.id],\n  }),\n}));\n\nexport const allocationsRelations = relations(allocations, ({ one }) => ({\n  employee: one(employees, {\n    fields: [allocations.employeeId],\n    references: [employees.id],\n  }),\n  post: one(servicePosts, {\n    fields: [allocations.postId],\n    references: [servicePosts.id],\n  }),\n}));\n\nexport const occurrencesRelations = relations(occurrences, ({ one }) => ({\n  employee: one(employees, {\n    fields: [occurrences.employeeId],\n    references: [employees.id],\n  }),\n  post: one(servicePosts, {\n    fields: [occurrences.postId],\n    references: [servicePosts.id],\n  }),\n  treatedByUser: one(users, {\n    fields: [occurrences.treatedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const documentsRelations = relations(documents, ({ one }) => ({\n  employee: one(employees, {\n    fields: [documents.employeeId],\n    references: [employees.id],\n  }),\n  post: one(servicePosts, {\n    fields: [documents.postId],\n    references: [servicePosts.id],\n  }),\n  uploader: one(users, {\n    fields: [documents.uploadedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const auditLogsRelations = relations(auditLogs, ({ one }) => ({\n  user: one(users, {\n    fields: [auditLogs.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const alertsRelations = relations(alerts, ({ one }) => ({\n  resolver: one(users, {\n    fields: [alerts.resolvedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const lgpdLogsRelations = relations(lgpdLogs, ({ one }) => ({\n  user: one(users, {\n    fields: [lgpdLogs.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const feriasLicencasRelations = relations(feriasLicencas, ({ one }) => ({\n  employee: one(employees, {\n    fields: [feriasLicencas.employeeId],\n    references: [employees.id],\n  }),\n  createdByUser: one(users, {\n    fields: [feriasLicencas.createdBy],\n    references: [users.id],\n  }),\n}));\n\n// Insert Schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertEmployeeSchema = createInsertSchema(employees).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  cpf: z.string().regex(/^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$/, \"CPF deve estar no formato XXX.XXX.XXX-XX\"),\n});\n\nexport const insertServicePostSchema = createInsertSchema(servicePosts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAllocationSchema = createInsertSchema(allocations).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertOccurrenceSchema = createInsertSchema(occurrences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  treated: true,\n  treatedBy: true,\n  treatedAt: true,\n});\n\nexport const insertDocumentSchema = createInsertSchema(documents).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAuditLogSchema = createInsertSchema(auditLogs).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertNotificationSettingsSchema = createInsertSchema(notificationSettings).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertAlertSchema = createInsertSchema(alerts).omit({\n  id: true,\n  createdAt: true,\n  resolvedBy: true,\n  resolvedAt: true,\n});\n\nexport const insertLgpdLogSchema = createInsertSchema(lgpdLogs).omit({\n  id: true,\n  timestamp: true,\n});\n\nexport const insertDocumentChecklistSchema = createInsertSchema(documentChecklists).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertFeriasLicencasSchema = createInsertSchema(feriasLicencas).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertEmployee = z.infer<typeof insertEmployeeSchema>;\nexport type Employee = typeof employees.$inferSelect;\nexport type InsertServicePost = z.infer<typeof insertServicePostSchema>;\nexport type ServicePost = typeof servicePosts.$inferSelect;\nexport type InsertAllocation = z.infer<typeof insertAllocationSchema>;\nexport type Allocation = typeof allocations.$inferSelect;\nexport type InsertOccurrence = z.infer<typeof insertOccurrenceSchema>;\nexport type Occurrence = typeof occurrences.$inferSelect;\nexport type InsertDocument = z.infer<typeof insertDocumentSchema>;\nexport type Document = typeof documents.$inferSelect;\nexport type InsertAuditLog = z.infer<typeof insertAuditLogSchema>;\nexport type AuditLog = typeof auditLogs.$inferSelect;\nexport type InsertNotificationSettings = z.infer<typeof insertNotificationSettingsSchema>;\nexport type NotificationSettings = typeof notificationSettings.$inferSelect;\nexport type InsertAlert = z.infer<typeof insertAlertSchema>;\nexport type Alert = typeof alerts.$inferSelect;\nexport type InsertLgpdLog = z.infer<typeof insertLgpdLogSchema>;\nexport type LgpdLog = typeof lgpdLogs.$inferSelect;\n\n// Extended types with relations\nexport type EmployeeWithRelations = Employee & {\n  linkedPost?: ServicePost | null;\n};\n\nexport type AllocationWithRelations = Allocation & {\n  employee?: Employee;\n  post?: ServicePost;\n};\n\nexport type OccurrenceWithRelations = Occurrence & {\n  employee?: Employee | null;\n  post?: ServicePost | null;\n  treatedByUser?: User | null;\n};\n\nexport type DocumentWithRelations = Document & {\n  employee?: Employee | null;\n  post?: ServicePost | null;\n  uploader?: User | null;\n};\n\nexport type AuditLogWithRelations = AuditLog & {\n  user?: User | null;\n};\n\nexport type NotificationSettingsWithRelations = NotificationSettings & {\n  user?: User | null;\n};\n\nexport type AlertWithRelations = Alert & {\n  resolver?: User | null;\n};\n\nexport type LgpdLogWithRelations = LgpdLog & {\n  user?: User | null;\n};\n\nexport type InsertDocumentChecklist = z.infer<typeof insertDocumentChecklistSchema>;\nexport type DocumentChecklist = typeof documentChecklists.$inferSelect;\n\nexport type DocumentChecklistWithRelations = DocumentChecklist & {\n  post?: ServicePost | null;\n};\n\nexport type InsertFeriasLicencas = z.infer<typeof insertFeriasLicencasSchema>;\nexport type FeriasLicencas = typeof feriasLicencas.$inferSelect;\n\nexport type FeriasLicencasWithRelations = FeriasLicencas & {\n  employee?: Employee | null;\n  createdByUser?: User | null;\n};\n","path":null,"size_bytes":17826,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/pages/documents/index.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Plus, Download, Trash2, Search, Filter, FileText, Image, File, Eye, X, AlertTriangle, Clock, Calendar, History } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from \"@/components/ui/dialog\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { DataTable } from \"@/components/data-table\";\nimport { DocTypeBadge } from \"@/components/status-badge\";\nimport { ConfirmDialog } from \"@/components/confirm-dialog\";\nimport { DocumentUploadDialog } from \"./document-upload-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDate } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport type { Document, Employee, ServicePost } from \"@shared/schema\";\n\nfunction getFileIcon(mimeType: string) {\n  if (mimeType.startsWith(\"image/\")) return Image;\n  if (mimeType === \"application/pdf\") return FileText;\n  return File;\n}\n\nfunction getExpirationStatus(expirationDate: string | null): { status: \"expired\" | \"expiring\" | \"valid\" | \"none\"; daysLeft: number | null } {\n  if (!expirationDate) return { status: \"none\", daysLeft: null };\n  \n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const expDate = new Date(expirationDate);\n  expDate.setHours(0, 0, 0, 0);\n  \n  const diffTime = expDate.getTime() - today.getTime();\n  const daysLeft = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n  \n  if (daysLeft < 0) return { status: \"expired\", daysLeft };\n  if (daysLeft <= 30) return { status: \"expiring\", daysLeft };\n  return { status: \"valid\", daysLeft };\n}\n\nfunction ExpirationBadge({ expirationDate }: { expirationDate: string | null }) {\n  const { status, daysLeft } = getExpirationStatus(expirationDate);\n  \n  if (status === \"none\") return null;\n  \n  if (status === \"expired\") {\n    return (\n      <Badge variant=\"destructive\" className=\"text-xs gap-1\">\n        <AlertTriangle className=\"h-3 w-3\" />\n        {translations.documents.expired}\n      </Badge>\n    );\n  }\n  \n  if (status === \"expiring\") {\n    return (\n      <Badge variant=\"outline\" className=\"text-xs gap-1 border-yellow-500 text-yellow-600 dark:text-yellow-400\">\n        <Clock className=\"h-3 w-3\" />\n        {daysLeft === 0 ? translations.common.today : `${daysLeft}d`}\n      </Badge>\n    );\n  }\n  \n  return (\n    <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n      <Calendar className=\"h-3 w-3\" />\n      {expirationDate ? formatDate(expirationDate) : \"-\"}\n    </span>\n  );\n}\n\nexport default function DocumentsPage() {\n  const { isAdmin } = useAuth();\n  const { toast } = useToast();\n  const [location] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [employeeFilter, setEmployeeFilter] = useState<string>(\"all\");\n  const [postFilter, setPostFilter] = useState<string>(\"all\");\n  const [deleteId, setDeleteId] = useState<number | null>(null);\n  const [isUploadOpen, setIsUploadOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"all\");\n  const [versionHistoryDocId, setVersionHistoryDocId] = useState<number | null>(null);\n\n  const { data: documentVersions, isLoading: isLoadingVersions } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\", versionHistoryDocId, \"versions\"],\n    queryFn: async () => {\n      if (!versionHistoryDocId) return [];\n      const res = await fetch(`/api/documents/${versionHistoryDocId}/versions`, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch versions\");\n      return res.json();\n    },\n    enabled: !!versionHistoryDocId,\n  });\n\n  const params = new URLSearchParams(location.split(\"?\")[1] || \"\");\n  const employeeIdParam = params.get(\"employeeId\");\n  const postIdParam = params.get(\"postId\");\n\n  const { data: documents, isLoading } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const { data: expiringDocuments, isLoading: isLoadingExpiring } = useQuery<Document[]>({\n    queryKey: [\"/api/documents/expiring\"],\n  });\n\n  const { data: expiredDocuments, isLoading: isLoadingExpired } = useQuery<Document[]>({\n    queryKey: [\"/api/documents/expired\"],\n  });\n\n  const { data: employees } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: servicePosts } = useQuery<ServicePost[]>({\n    queryKey: [\"/api/service-posts\"],\n  });\n\n  const employeeMap = new Map(employees?.map(e => [e.id, e]) || []);\n  const postMap = new Map(servicePosts?.map(p => [p.id, p]) || []);\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/documents/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents/expiring\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/documents/expired\"] });\n      toast({ title: translations.common.success, description: translations.documents.documentDeleted });\n      setDeleteId(null);\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.deleteError, variant: \"destructive\" });\n    },\n  });\n\n  const filteredDocuments = documents?.filter((doc) => {\n    const matchesSearch = doc.originalName.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesType = typeFilter === \"all\" || doc.documentType === typeFilter;\n    const matchesEmployeeUrl = !employeeIdParam || doc.employeeId?.toString() === employeeIdParam;\n    const matchesPostUrl = !postIdParam || doc.postId?.toString() === postIdParam;\n    const matchesEmployeeFilter = employeeFilter === \"all\" || doc.employeeId?.toString() === employeeFilter;\n    const matchesPostFilter = postFilter === \"all\" || doc.postId?.toString() === postFilter;\n    return matchesSearch && matchesType && matchesEmployeeUrl && matchesPostUrl && matchesEmployeeFilter && matchesPostFilter;\n  }) || [];\n\n  const activeFilters = [\n    typeFilter !== \"all\" ? `${translations.common.type}: ${typeFilter}` : null,\n    employeeFilter !== \"all\" ? `${translations.documents.employee}: ${employeeMap.get(Number(employeeFilter))?.name || employeeFilter}` : null,\n    postFilter !== \"all\" ? `${translations.documents.post}: ${postMap.get(Number(postFilter))?.postName || postFilter}` : null,\n  ].filter(Boolean);\n\n  const clearFilters = () => {\n    setTypeFilter(\"all\");\n    setEmployeeFilter(\"all\");\n    setPostFilter(\"all\");\n  };\n\n  const columns = [\n    {\n      key: \"name\",\n      header: translations.documents.filename,\n      cell: (doc: Document) => {\n        const Icon = getFileIcon(doc.mimeType);\n        return (\n          <div className=\"flex items-center gap-2\">\n            <Icon className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n            <span className=\"truncate max-w-[200px]\" data-testid={`text-doc-name-${doc.id}`}>\n              {doc.originalName}\n            </span>\n          </div>\n        );\n      },\n    },\n    {\n      key: \"type\",\n      header: translations.common.type,\n      cell: (doc: Document) => <DocTypeBadge type={doc.documentType} />,\n    },\n    {\n      key: \"linkedTo\",\n      header: translations.documents.linkedTo,\n      cell: (doc: Document) => {\n        if (doc.employeeId) {\n          const employee = employeeMap.get(doc.employeeId);\n          return <span className=\"text-sm\">{employee?.name || `Funcionário #${doc.employeeId}`}</span>;\n        }\n        if (doc.postId) {\n          const post = postMap.get(doc.postId);\n          return <span className=\"text-sm\">{post?.postName || `Posto #${doc.postId}`}</span>;\n        }\n        if (doc.monthYear) {\n          return <span className=\"text-sm\">{doc.monthYear}</span>;\n        }\n        return <span className=\"text-sm text-muted-foreground\">{translations.documents.none}</span>;\n      },\n    },\n    {\n      key: \"size\",\n      header: translations.documents.size,\n      cell: (doc: Document) => (\n        <span className=\"text-sm text-muted-foreground\">\n          {(doc.size / 1024).toFixed(1)} KB\n        </span>\n      ),\n    },\n    {\n      key: \"version\",\n      header: \"Versão\",\n      cell: (doc: Document) => (\n        <Badge variant=\"outline\" className=\"text-xs\">\n          v{(doc as any).version || 1}\n        </Badge>\n      ),\n    },\n    {\n      key: \"expiration\",\n      header: translations.documents.expirationDate,\n      cell: (doc: Document) => <ExpirationBadge expirationDate={(doc as any).expirationDate} />,\n    },\n    {\n      key: \"date\",\n      header: translations.documents.uploadedAt,\n      cell: (doc: Document) => (\n        <span className=\"text-sm text-muted-foreground\">\n          {doc.createdAt ? formatDate(doc.createdAt) : \"N/A\"}\n        </span>\n      ),\n    },\n    {\n      key: \"actions\",\n      header: translations.common.actions,\n      className: \"text-right\",\n      cell: (doc: Document) => (\n        <div className=\"flex items-center justify-end gap-1\">\n          <Button variant=\"ghost\" size=\"icon\" asChild data-testid={`button-view-doc-${doc.id}`}>\n            <a href={`/api/documents/${doc.id}/download`} target=\"_blank\" rel=\"noopener noreferrer\">\n              <Eye className=\"h-4 w-4\" />\n            </a>\n          </Button>\n          <Button variant=\"ghost\" size=\"icon\" asChild data-testid={`button-download-doc-${doc.id}`}>\n            <a href={`/api/documents/${doc.id}/download`} download>\n              <Download className=\"h-4 w-4\" />\n            </a>\n          </Button>\n          {(doc as any).version > 1 && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setVersionHistoryDocId(doc.id)}\n              data-testid={`button-history-doc-${doc.id}`}\n            >\n              <History className=\"h-4 w-4\" />\n            </Button>\n          )}\n          {isAdmin && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setDeleteId(doc.id)}\n              data-testid={`button-delete-doc-${doc.id}`}\n            >\n              <Trash2 className=\"h-4 w-4\" />\n            </Button>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  const expiringCount = expiringDocuments?.length || 0;\n  const expiredCount = expiredDocuments?.length || 0;\n\n  const getTabData = () => {\n    switch (activeTab) {\n      case \"expiring\":\n        return expiringDocuments || [];\n      case \"expired\":\n        return expiredDocuments || [];\n      default:\n        return filteredDocuments;\n    }\n  };\n\n  const getTabLoading = () => {\n    switch (activeTab) {\n      case \"expiring\":\n        return isLoadingExpiring;\n      case \"expired\":\n        return isLoadingExpired;\n      default:\n        return isLoading;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.documents.title}\n        description={translations.documents.description}\n      >\n        {isAdmin && (\n          <Button onClick={() => setIsUploadOpen(true)} data-testid=\"button-upload-document\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            {translations.documents.uploadDocument}\n          </Button>\n        )}\n      </PageHeader>\n\n      {(expiredCount > 0 || expiringCount > 0) && (\n        <div className=\"flex flex-col sm:flex-row gap-4\">\n          {expiredCount > 0 && (\n            <Card className=\"flex-1 border-destructive/50\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{translations.documents.expiredDocuments}</CardTitle>\n                <AlertTriangle className=\"h-4 w-4 text-destructive\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-expired-count\">{expiredCount}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Documentos que requerem atenção imediata\n                </p>\n                <Button \n                  variant=\"ghost\" \n                  className=\"p-0 h-auto text-xs mt-1 underline\" \n                  onClick={() => setActiveTab(\"expired\")}\n                  data-testid=\"button-view-expired\"\n                >\n                  Ver documentos vencidos\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n          {expiringCount > 0 && (\n            <Card className=\"flex-1 border-yellow-500/50\">\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <CardTitle className=\"text-sm font-medium\">{translations.documents.expiringDocuments}</CardTitle>\n                <Clock className=\"h-4 w-4 text-yellow-500\" />\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\" data-testid=\"text-expiring-count\">{expiringCount}</div>\n                <p className=\"text-xs text-muted-foreground\">\n                  Documentos vencendo nos próximos 30 dias\n                </p>\n                <Button \n                  variant=\"ghost\" \n                  className=\"p-0 h-auto text-xs mt-1 underline\" \n                  onClick={() => setActiveTab(\"expiring\")}\n                  data-testid=\"button-view-expiring\"\n                >\n                  Ver documentos vencendo\n                </Button>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      )}\n\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\n        <TabsList data-testid=\"tabs-document-status\">\n          <TabsTrigger value=\"all\" data-testid=\"tab-all-documents\">\n            Todos os Documentos\n          </TabsTrigger>\n          <TabsTrigger value=\"expiring\" data-testid=\"tab-expiring-documents\">\n            Vencendo em Breve\n            {expiringCount > 0 && (\n              <Badge variant=\"outline\" className=\"ml-2 text-xs border-yellow-500 text-yellow-600 dark:text-yellow-400\">\n                {expiringCount}\n              </Badge>\n            )}\n          </TabsTrigger>\n          <TabsTrigger value=\"expired\" data-testid=\"tab-expired-documents\">\n            Vencidos\n            {expiredCount > 0 && (\n              <Badge variant=\"destructive\" className=\"ml-2 text-xs\">\n                {expiredCount}\n              </Badge>\n            )}\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={activeTab} className=\"mt-4\">\n          {activeTab === \"all\" && (\n            <div className=\"flex flex-col gap-4 mb-4\">\n              <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center\">\n                <div className=\"relative flex-1 max-w-sm\">\n                  <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                  <Input\n                    placeholder={translations.documents.searchPlaceholder}\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    className=\"pl-9\"\n                    data-testid=\"input-search-documents\"\n                  />\n                </div>\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <Filter className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n                  <Select value={typeFilter} onValueChange={setTypeFilter}>\n                    <SelectTrigger className=\"w-[150px]\" data-testid=\"select-type-filter\">\n                      <SelectValue placeholder={translations.common.type} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{translations.documents.allTypes}</SelectItem>\n                      <SelectItem value=\"aso\">{translations.documents.aso}</SelectItem>\n                      <SelectItem value=\"certification\">{translations.documents.certification}</SelectItem>\n                      <SelectItem value=\"evidence\">{translations.documents.evidence}</SelectItem>\n                      <SelectItem value=\"contract\">{translations.documents.contract}</SelectItem>\n                      <SelectItem value=\"other\">{translations.documents.other}</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Select value={employeeFilter} onValueChange={setEmployeeFilter}>\n                    <SelectTrigger className=\"w-[180px]\" data-testid=\"select-employee-filter\">\n                      <SelectValue placeholder={translations.documents.employee} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{translations.documents.allEmployees}</SelectItem>\n                      {employees?.map((emp) => (\n                        <SelectItem key={emp.id} value={emp.id.toString()}>{emp.name}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <Select value={postFilter} onValueChange={setPostFilter}>\n                    <SelectTrigger className=\"w-[180px]\" data-testid=\"select-post-filter\">\n                      <SelectValue placeholder={translations.documents.post} />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">{translations.documents.allPosts}</SelectItem>\n                      {servicePosts?.map((post) => (\n                        <SelectItem key={post.id} value={post.id.toString()}>{post.postCode} - {post.postName}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n              {activeFilters.length > 0 && (\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                  <span className=\"text-sm text-muted-foreground\">Filtros ativos:</span>\n                  {activeFilters.map((filter) => (\n                    <Badge key={filter} variant=\"secondary\" className=\"text-xs\">\n                      {filter}\n                    </Badge>\n                  ))}\n                  <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters} className=\"h-7 px-2\" data-testid=\"button-clear-filters\">\n                    <X className=\"h-3 w-3 mr-1\" />\n                    {translations.common.clearFilters}\n                  </Button>\n                </div>\n              )}\n            </div>\n          )}\n\n          <DataTable\n            columns={columns}\n            data={getTabData()}\n            isLoading={getTabLoading()}\n            emptyMessage={activeTab === \"all\" ? translations.documents.noDocuments : activeTab === \"expiring\" ? \"Nenhum documento vencendo em breve\" : \"Nenhum documento vencido\"}\n            emptyDescription={activeTab === \"all\" ? \"Envie documentos para armazenar evidências e certificações.\" : activeTab === \"expiring\" ? \"Todos os documentos estão em dia.\" : \"Nenhum documento expirou.\"}\n            testIdPrefix=\"documents\"\n          />\n        </TabsContent>\n      </Tabs>\n\n      <DocumentUploadDialog\n        open={isUploadOpen}\n        onOpenChange={setIsUploadOpen}\n        employees={employees || []}\n        servicePosts={servicePosts || []}\n      />\n\n      <Dialog open={versionHistoryDocId !== null} onOpenChange={(open) => !open && setVersionHistoryDocId(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Histórico de Versões</DialogTitle>\n            <DialogDescription>Versões anteriores deste documento</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n            {isLoadingVersions ? (\n              <div className=\"text-center py-4 text-muted-foreground\">Carregando...</div>\n            ) : documentVersions?.length === 0 ? (\n              <div className=\"text-center py-4 text-muted-foreground\">Nenhuma versão anterior</div>\n            ) : (\n              documentVersions?.map((ver) => (\n                <div key={ver.id} className=\"flex items-center justify-between gap-2 p-3 border rounded-md\">\n                  <div className=\"flex items-center gap-3\">\n                    <Badge variant=\"outline\">v{(ver as any).version}</Badge>\n                    <div>\n                      <div className=\"font-medium text-sm\">{ver.originalName}</div>\n                      <div className=\"text-xs text-muted-foreground\">{ver.createdAt ? formatDate(ver.createdAt) : \"N/A\"}</div>\n                    </div>\n                  </div>\n                  <Button variant=\"ghost\" size=\"icon\" asChild>\n                    <a href={`/api/documents/${ver.id}/download`} download>\n                      <Download className=\"h-4 w-4\" />\n                    </a>\n                  </Button>\n                </div>\n              ))\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <ConfirmDialog\n        open={deleteId !== null}\n        onOpenChange={(open) => !open && setDeleteId(null)}\n        title={translations.documents.deleteDocument}\n        description={translations.documents.deleteConfirm}\n        confirmText={translations.common.delete}\n        onConfirm={() => deleteId && deleteMutation.mutate(deleteId)}\n        variant=\"destructive\"\n        isLoading={deleteMutation.isPending}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":21856,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/pages/occurrences/index.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Plus, Pencil, Trash2, Search, Filter, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { DataTable } from \"@/components/data-table\";\nimport { CategoryBadge } from \"@/components/status-badge\";\nimport { ConfirmDialog } from \"@/components/confirm-dialog\";\nimport { OccurrenceDialog } from \"./occurrence-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDate } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport type { Occurrence, Employee, ServicePost } from \"@shared/schema\";\n\nexport default function OccurrencesPage() {\n  const { isAdmin } = useAuth();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [categoryFilter, setCategoryFilter] = useState<string>(\"all\");\n  const [employeeFilter, setEmployeeFilter] = useState<string>(\"all\");\n  const [deleteId, setDeleteId] = useState<number | null>(null);\n  const [editingOccurrence, setEditingOccurrence] = useState<Occurrence | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  const { data: occurrences, isLoading } = useQuery<Occurrence[]>({\n    queryKey: [\"/api/occurrences\"],\n  });\n\n  const { data: employees } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: servicePosts } = useQuery<ServicePost[]>({\n    queryKey: [\"/api/service-posts\"],\n  });\n\n  const employeeMap = new Map(employees?.map(e => [e.id, e]) || []);\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/occurrences/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/occurrences\"] });\n      toast({ title: translations.common.success, description: translations.occurrences.occurrenceDeleted });\n      setDeleteId(null);\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.deleteError, variant: \"destructive\" });\n    },\n  });\n\n  const categoryLabels: Record<string, string> = {\n    absence: translations.occurrences.absence,\n    substitution: translations.occurrences.substitution,\n    issue: translations.occurrences.issue,\n    note: translations.occurrences.note,\n  };\n\n  const filteredOccurrences = occurrences?.filter((occurrence) => {\n    const matchesSearch = occurrence.description.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesCategory = categoryFilter === \"all\" || occurrence.category === categoryFilter;\n    const matchesEmployee = employeeFilter === \"all\" || occurrence.employeeId?.toString() === employeeFilter;\n    return matchesSearch && matchesCategory && matchesEmployee;\n  }) || [];\n\n  const activeFilters = [\n    categoryFilter !== \"all\" ? `${translations.occurrences.category}: ${categoryLabels[categoryFilter] || categoryFilter}` : null,\n    employeeFilter !== \"all\" ? `${translations.occurrences.employee}: ${employeeMap.get(Number(employeeFilter))?.name || employeeFilter}` : null,\n  ].filter(Boolean);\n\n  const clearFilters = () => {\n    setCategoryFilter(\"all\");\n    setEmployeeFilter(\"all\");\n  };\n\n  const columns = [\n    {\n      key: \"date\",\n      header: translations.occurrences.date,\n      cell: (occurrence: Occurrence) => (\n        <span data-testid={`text-occurrence-date-${occurrence.id}`}>\n          {formatDate(occurrence.date)}\n        </span>\n      ),\n    },\n    {\n      key: \"category\",\n      header: translations.occurrences.category,\n      cell: (occurrence: Occurrence) => (\n        <CategoryBadge category={occurrence.category} />\n      ),\n    },\n    {\n      key: \"employee\",\n      header: translations.occurrences.employee,\n      cell: (occurrence: Occurrence) => {\n        const employee = occurrence.employeeId ? employeeMap.get(occurrence.employeeId) : null;\n        return (\n          <span data-testid={`text-occurrence-employee-${occurrence.id}`}>\n            {employee ? employee.name : \"N/A\"}\n          </span>\n        );\n      },\n    },\n    {\n      key: \"description\",\n      header: translations.common.description,\n      cell: (occurrence: Occurrence) => (\n        <div className=\"max-w-[300px] truncate\" data-testid={`text-occurrence-description-${occurrence.id}`}>\n          {occurrence.description}\n        </div>\n      ),\n    },\n    {\n      key: \"actions\",\n      header: translations.common.actions,\n      className: \"text-right\",\n      cell: (occurrence: Occurrence) => (\n        <div className=\"flex items-center justify-end gap-1\">\n          {isAdmin && (\n            <>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => {\n                  setEditingOccurrence(occurrence);\n                  setIsDialogOpen(true);\n                }}\n                data-testid={`button-edit-occurrence-${occurrence.id}`}\n              >\n                <Pencil className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setDeleteId(occurrence.id)}\n                data-testid={`button-delete-occurrence-${occurrence.id}`}\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.occurrences.title}\n        description={translations.occurrences.pageDescription}\n      />\n\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center flex-1\">\n            <div className=\"relative flex-1 max-w-sm\">\n              <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                placeholder={translations.occurrences.searchPlaceholder}\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-occurrences\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <Filter className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n              <Select value={categoryFilter} onValueChange={setCategoryFilter}>\n                <SelectTrigger className=\"w-[160px]\" data-testid=\"select-category-filter\">\n                  <SelectValue placeholder={translations.occurrences.category} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{translations.occurrences.allCategories}</SelectItem>\n                  <SelectItem value=\"absence\">{translations.occurrences.absence}</SelectItem>\n                  <SelectItem value=\"substitution\">{translations.occurrences.substitution}</SelectItem>\n                  <SelectItem value=\"issue\">{translations.occurrences.issue}</SelectItem>\n                  <SelectItem value=\"note\">{translations.occurrences.note}</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={employeeFilter} onValueChange={setEmployeeFilter}>\n                <SelectTrigger className=\"w-[180px]\" data-testid=\"select-employee-filter\">\n                  <SelectValue placeholder={translations.occurrences.employee} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{translations.occurrences.allEmployees}</SelectItem>\n                  {employees?.map((emp) => (\n                    <SelectItem key={emp.id} value={emp.id.toString()}>{emp.name}</SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n          {isAdmin && (\n            <Button\n              onClick={() => {\n                setEditingOccurrence(null);\n                setIsDialogOpen(true);\n              }}\n              data-testid=\"button-new-occurrence\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Nova Ocorrência\n            </Button>\n          )}\n        </div>\n        {activeFilters.length > 0 && (\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <span className=\"text-sm text-muted-foreground\">Filtros ativos:</span>\n            {activeFilters.map((filter) => (\n              <Badge key={filter} variant=\"secondary\" className=\"text-xs\">\n                {filter}\n              </Badge>\n            ))}\n            <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters} className=\"h-7 px-2\" data-testid=\"button-clear-filters\">\n              <X className=\"h-3 w-3 mr-1\" />\n              {translations.common.clearFilters}\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <DataTable\n        columns={columns}\n        data={filteredOccurrences}\n        isLoading={isLoading}\n        emptyMessage={translations.occurrences.noOccurrences}\n        emptyDescription=\"Registre incidentes e anotações aqui.\"\n        testIdPrefix=\"occurrences\"\n      />\n\n      <OccurrenceDialog\n        open={isDialogOpen}\n        onOpenChange={setIsDialogOpen}\n        occurrence={editingOccurrence}\n        employees={employees || []}\n        servicePosts={servicePosts || []}\n      />\n\n      <ConfirmDialog\n        open={deleteId !== null}\n        onOpenChange={(open) => !open && setDeleteId(null)}\n        title={translations.occurrences.deleteOccurrence}\n        description={translations.occurrences.deleteConfirm}\n        confirmText={translations.common.delete}\n        onConfirm={() => deleteId && deleteMutation.mutate(deleteId)}\n        variant=\"destructive\"\n        isLoading={deleteMutation.isPending}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":10249,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\n/**\n * DEVELOPMENT ROLE OVERRIDE:\n * \n * In development mode, we read the dev role from localStorage and include it\n * as an X-Dev-Role header in all API requests. This allows the backend to\n * simulate different user roles for testing purposes.\n * \n * We read from localStorage directly (rather than React context) because\n * these functions are called outside of React component tree.\n * The DevRoleContext persists the role to localStorage, so they stay in sync.\n */\nfunction getDevRoleHeader(): Record<string, string> {\n  // Only in development mode (Vite sets this at build time)\n  if (import.meta.env.PROD) {\n    return {};\n  }\n  \n  const devRole = localStorage.getItem(\"dev-role-override\");\n  if (devRole && [\"admin\", \"fiscal\", \"operador\", \"visualizador\"].includes(devRole)) {\n    return { \"X-Dev-Role\": devRole };\n  }\n  return {};\n}\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  // Include dev role header for backend role simulation in development\n  const devRoleHeader = getDevRoleHeader();\n  \n  const res = await fetch(url, {\n    method,\n    headers: {\n      ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n      ...devRoleHeader,\n    },\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    // Include dev role header for backend role simulation in development\n    const devRoleHeader = getDevRoleHeader();\n    \n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n      headers: devRoleHeader,\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":2543,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-[60] pointer-events-auto max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5763,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/status-badge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\ntype StatusType = \"active\" | \"inactive\" | \"present\" | \"absent\" | \"justified\" | \"vacation\" | \"medical_leave\" | \"onsite\" | \"hybrid\" | \"remote\";\n\ninterface StatusBadgeProps {\n  status: StatusType;\n  className?: string;\n}\n\nconst statusConfig: Record<StatusType, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  active: { label: \"Active\", variant: \"default\" },\n  inactive: { label: \"Inactive\", variant: \"secondary\" },\n  present: { label: \"Present\", variant: \"default\" },\n  absent: { label: \"Absent\", variant: \"destructive\" },\n  justified: { label: \"Justified\", variant: \"secondary\" },\n  vacation: { label: \"Vacation\", variant: \"outline\" },\n  medical_leave: { label: \"Medical Leave\", variant: \"outline\" },\n  onsite: { label: \"On-site\", variant: \"default\" },\n  hybrid: { label: \"Hybrid\", variant: \"secondary\" },\n  remote: { label: \"Remote\", variant: \"outline\" },\n};\n\nexport function StatusBadge({ status, className }: StatusBadgeProps) {\n  const config = statusConfig[status] || { label: status, variant: \"secondary\" as const };\n\n  return (\n    <Badge variant={config.variant} className={cn(\"text-xs\", className)} data-testid={`badge-status-${status}`}>\n      {config.label}\n    </Badge>\n  );\n}\n\ntype CategoryType = \"absence\" | \"substitution\" | \"issue\" | \"note\";\n\ninterface CategoryBadgeProps {\n  category: CategoryType;\n  className?: string;\n}\n\nconst categoryConfig: Record<CategoryType, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  absence: { label: \"Absence\", variant: \"destructive\" },\n  substitution: { label: \"Substitution\", variant: \"secondary\" },\n  issue: { label: \"Issue\", variant: \"outline\" },\n  note: { label: \"Note\", variant: \"default\" },\n};\n\nexport function CategoryBadge({ category, className }: CategoryBadgeProps) {\n  const config = categoryConfig[category] || { label: category, variant: \"secondary\" as const };\n\n  return (\n    <Badge variant={config.variant} className={cn(\"text-xs\", className)} data-testid={`badge-category-${category}`}>\n      {config.label}\n    </Badge>\n  );\n}\n\ntype DocType = \"aso\" | \"certification\" | \"evidence\" | \"contract\" | \"other\";\n\ninterface DocTypeBadgeProps {\n  type: DocType;\n  className?: string;\n}\n\nconst docTypeConfig: Record<DocType, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  aso: { label: \"ASO\", variant: \"default\" },\n  certification: { label: \"Certification\", variant: \"secondary\" },\n  evidence: { label: \"Evidence\", variant: \"outline\" },\n  contract: { label: \"Contract\", variant: \"default\" },\n  other: { label: \"Other\", variant: \"secondary\" },\n};\n\nexport function DocTypeBadge({ type, className }: DocTypeBadgeProps) {\n  const config = docTypeConfig[type] || { label: type, variant: \"secondary\" as const };\n\n  return (\n    <Badge variant={config.variant} className={cn(\"text-xs\", className)} data-testid={`badge-doctype-${type}`}>\n      {config.label}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":3026,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated, isAdmin } from \"./replitAuth\";\nimport {\n  insertEmployeeSchema,\n  insertServicePostSchema,\n  insertAllocationSchema,\n  insertOccurrenceSchema,\n  insertNotificationSettingsSchema,\n  insertDocumentChecklistSchema,\n  insertFeriasLicencasSchema,\n} from \"@shared/schema\";\nimport { emailService } from \"./emailService\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { randomUUID } from \"crypto\";\n\nconst uploadDir = path.join(process.cwd(), \"uploads\");\nif (!fs.existsSync(uploadDir)) {\n  fs.mkdirSync(uploadDir, { recursive: true });\n}\n\nconst upload = multer({\n  storage: multer.diskStorage({\n    destination: (_req, _file, cb) => {\n      cb(null, uploadDir);\n    },\n    filename: (_req, file, cb) => {\n      const ext = path.extname(file.originalname);\n      const filename = `${randomUUID()}${ext}`;\n      cb(null, filename);\n    },\n  }),\n  limits: {\n    fileSize: 10 * 1024 * 1024,\n  },\n});\n\nasync function logAction(\n  userId: string | undefined,\n  action: string,\n  entityType: string,\n  entityId?: string | number,\n  details?: any,\n  diffBefore?: any,\n  diffAfter?: any\n) {\n  try {\n    await storage.createAuditLogWithDiff({\n      userId: userId || null,\n      action,\n      entityType,\n      entityId: entityId?.toString() || null,\n      details,\n      diffBefore: diffBefore || null,\n      diffAfter: diffAfter || null,\n    });\n  } catch (error) {\n    console.error(\"Failed to create audit log:\", error);\n  }\n}\n\nasync function logLgpdAccess(\n  req: any,\n  accessType: \"view\" | \"export\" | \"search\",\n  dataCategory: \"personal_data\" | \"sensitive_data\" | \"financial_data\",\n  entityType: string,\n  entityId?: string | number,\n  details?: any\n) {\n  try {\n    const userId = req.user?.claims?.sub || null;\n    const ipAddress = req.ip || req.connection?.remoteAddress || null;\n    const userAgent = req.get(\"User-Agent\") || null;\n    \n    await storage.createLgpdLog({\n      userId,\n      accessType,\n      dataCategory,\n      entityType,\n      entityId: entityId?.toString() || null,\n      ipAddress,\n      userAgent,\n      details,\n    });\n  } catch (error) {\n    console.error(\"Failed to create LGPD log:\", error);\n  }\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  await setupAuth(app);\n\n  app.get(\"/api/auth/user\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/stats\", isAuthenticated, async (_req, res) => {\n    try {\n      const stats = await storage.getDashboardStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Error fetching dashboard stats:\", error);\n      res.status(500).json({ message: \"Failed to fetch dashboard stats\" });\n    }\n  });\n\n  app.get(\"/api/analytics/allocation-trends\", isAuthenticated, async (req, res) => {\n    try {\n      const days = req.query.days ? parseInt(req.query.days as string) : 30;\n      const trends = await storage.getAllocationTrends(days);\n      res.json(trends);\n    } catch (error) {\n      console.error(\"Error fetching allocation trends:\", error);\n      res.status(500).json({ message: \"Failed to fetch allocation trends\" });\n    }\n  });\n\n  app.get(\"/api/analytics/occurrences-by-category\", isAuthenticated, async (_req, res) => {\n    try {\n      const data = await storage.getOccurrencesByCategory();\n      res.json(data);\n    } catch (error) {\n      console.error(\"Error fetching occurrences by category:\", error);\n      res.status(500).json({ message: \"Failed to fetch occurrences by category\" });\n    }\n  });\n\n  app.get(\"/api/analytics/compliance-metrics\", isAuthenticated, async (_req, res) => {\n    try {\n      const metrics = await storage.getComplianceMetrics();\n      res.json(metrics);\n    } catch (error) {\n      console.error(\"Error fetching compliance metrics:\", error);\n      res.status(500).json({ message: \"Failed to fetch compliance metrics\" });\n    }\n  });\n\n  app.get(\"/api/employees\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { search } = req.query;\n      const employeesList = search\n        ? await storage.searchEmployees(search as string)\n        : await storage.getEmployees();\n      \n      // LGPD logging for personal data access\n      if (search) {\n        await logLgpdAccess(req, \"search\", \"personal_data\", \"employees_search\", undefined, { searchTerm: search, resultCount: employeesList.length });\n      } else {\n        await logLgpdAccess(req, \"view\", \"personal_data\", \"employees_list\", undefined, { count: employeesList.length });\n      }\n      \n      res.json(employeesList);\n    } catch (error) {\n      console.error(\"Error fetching employees:\", error);\n      res.status(500).json({ message: \"Failed to fetch employees\" });\n    }\n  });\n\n  app.get(\"/api/employees/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const employee = await storage.getEmployee(id);\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      \n      // LGPD logging for personal data access\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"employee\", id, { employeeName: employee.name });\n      \n      res.json(employee);\n    } catch (error) {\n      console.error(\"Error fetching employee:\", error);\n      res.status(500).json({ message: \"Failed to fetch employee\" });\n    }\n  });\n\n  app.post(\"/api/employees\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertEmployeeSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      const employee = await storage.createEmployee(parsed.data);\n      await logAction(req.user?.claims?.sub, \"create\", \"employee\", employee.id, { name: employee.name });\n      res.status(201).json(employee);\n    } catch (error: any) {\n      console.error(\"Error creating employee:\", error);\n      if (error.code === \"23505\") {\n        return res.status(400).json({ message: \"CPF already exists\" });\n      }\n      res.status(500).json({ message: \"Failed to create employee\" });\n    }\n  });\n\n  app.patch(\"/api/employees/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getEmployee(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      const employee = await storage.updateEmployee(id, req.body);\n      if (!employee) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"employee\", id, req.body, before, employee);\n      res.json(employee);\n    } catch (error: any) {\n      console.error(\"Error updating employee:\", error);\n      if (error.code === \"23505\") {\n        return res.status(400).json({ message: \"CPF already exists\" });\n      }\n      res.status(500).json({ message: \"Failed to update employee\" });\n    }\n  });\n\n  app.delete(\"/api/employees/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getEmployee(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      const deleted = await storage.deleteEmployee(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Employee not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"employee\", id, null, before, null);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting employee:\", error);\n      res.status(500).json({ message: \"Failed to delete employee\" });\n    }\n  });\n\n  app.get(\"/api/service-posts\", isAuthenticated, async (req, res) => {\n    try {\n      const { search } = req.query;\n      const posts = search\n        ? await storage.searchServicePosts(search as string)\n        : await storage.getServicePosts();\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching service posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch service posts\" });\n    }\n  });\n\n  app.get(\"/api/service-posts/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const post = await storage.getServicePost(id);\n      if (!post) {\n        return res.status(404).json({ message: \"Service post not found\" });\n      }\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error fetching service post:\", error);\n      res.status(500).json({ message: \"Failed to fetch service post\" });\n    }\n  });\n\n  app.post(\"/api/service-posts\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertServicePostSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      const post = await storage.createServicePost(parsed.data);\n      await logAction(req.user?.claims?.sub, \"create\", \"service_post\", post.id, { postCode: post.postCode });\n      res.status(201).json(post);\n    } catch (error: any) {\n      console.error(\"Error creating service post:\", error);\n      if (error.code === \"23505\") {\n        return res.status(400).json({ message: \"Post code already exists\" });\n      }\n      res.status(500).json({ message: \"Failed to create service post\" });\n    }\n  });\n\n  app.patch(\"/api/service-posts/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getServicePost(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Service post not found\" });\n      }\n      const post = await storage.updateServicePost(id, req.body);\n      if (!post) {\n        return res.status(404).json({ message: \"Service post not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"service_post\", id, req.body, before, post);\n      res.json(post);\n    } catch (error: any) {\n      console.error(\"Error updating service post:\", error);\n      if (error.code === \"23505\") {\n        return res.status(400).json({ message: \"Post code already exists\" });\n      }\n      res.status(500).json({ message: \"Failed to update service post\" });\n    }\n  });\n\n  app.delete(\"/api/service-posts/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getServicePost(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Service post not found\" });\n      }\n      const deleted = await storage.deleteServicePost(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Service post not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"service_post\", id, null, before, null);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting service post:\", error);\n      res.status(500).json({ message: \"Failed to delete service post\" });\n    }\n  });\n\n  app.get(\"/api/allocations\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { date, employeeId, postId, startDate, endDate } = req.query;\n      let allocationsList;\n      if (startDate && endDate) {\n        allocationsList = await storage.getAllocationsByDateRange(\n          startDate as string,\n          endDate as string\n        );\n      } else {\n        allocationsList = await storage.getAllocations({\n          date: date as string | undefined,\n          employeeId: employeeId ? parseInt(employeeId as string) : undefined,\n          postId: postId ? parseInt(postId as string) : undefined,\n        });\n      }\n      \n      // LGPD logging for allocation data access (contains employee info)\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"allocations_list\", undefined, { count: allocationsList.length, filters: { date, employeeId, postId, startDate, endDate } });\n      res.json(allocationsList);\n    } catch (error) {\n      console.error(\"Error fetching allocations:\", error);\n      res.status(500).json({ message: \"Failed to fetch allocations\" });\n    }\n  });\n\n  app.get(\"/api/allocations/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const allocation = await storage.getAllocation(id);\n      if (!allocation) {\n        return res.status(404).json({ message: \"Allocation not found\" });\n      }\n      \n      // LGPD logging for allocation detail access\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"allocation\", id, { employeeId: allocation.employeeId, date: allocation.date });\n      \n      res.json(allocation);\n    } catch (error) {\n      console.error(\"Error fetching allocation:\", error);\n      res.status(500).json({ message: \"Failed to fetch allocation\" });\n    }\n  });\n\n  app.post(\"/api/allocations\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertAllocationSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      const allocation = await storage.createAllocation(parsed.data);\n      await logAction(req.user?.claims?.sub, \"create\", \"allocation\", allocation.id);\n      res.status(201).json(allocation);\n    } catch (error) {\n      console.error(\"Error creating allocation:\", error);\n      res.status(500).json({ message: \"Failed to create allocation\" });\n    }\n  });\n\n  app.patch(\"/api/allocations/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getAllocation(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Allocation not found\" });\n      }\n      const allocation = await storage.updateAllocation(id, req.body);\n      if (!allocation) {\n        return res.status(404).json({ message: \"Allocation not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"allocation\", id, req.body, before, allocation);\n      res.json(allocation);\n    } catch (error) {\n      console.error(\"Error updating allocation:\", error);\n      res.status(500).json({ message: \"Failed to update allocation\" });\n    }\n  });\n\n  app.delete(\"/api/allocations/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getAllocation(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Allocation not found\" });\n      }\n      const deleted = await storage.deleteAllocation(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Allocation not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"allocation\", id, null, before, null);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting allocation:\", error);\n      res.status(500).json({ message: \"Failed to delete allocation\" });\n    }\n  });\n\n  app.post(\"/api/allocations/copy-month\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { sourceMonth, targetMonth, postId } = req.body;\n      \n      if (!sourceMonth || !targetMonth || !postId) {\n        return res.status(400).json({ message: \"sourceMonth, targetMonth, and postId are required\" });\n      }\n\n      const parsedPostId = parseInt(postId);\n      if (isNaN(parsedPostId) || parsedPostId <= 0) {\n        return res.status(400).json({ message: \"Invalid postId\" });\n      }\n\n      if (!/^\\d{4}-\\d{2}$/.test(sourceMonth) || !/^\\d{4}-\\d{2}$/.test(targetMonth)) {\n        return res.status(400).json({ message: \"Invalid month format. Use YYYY-MM\" });\n      }\n\n      if (sourceMonth === targetMonth) {\n        return res.status(400).json({ message: \"Source and target months must be different\" });\n      }\n\n      const sourceStart = `${sourceMonth}-01`;\n      const sourceYear = parseInt(sourceMonth.split(\"-\")[0]);\n      const sourceMonthNum = parseInt(sourceMonth.split(\"-\")[1]);\n      const sourceDaysInMonth = new Date(sourceYear, sourceMonthNum, 0).getDate();\n      const sourceEnd = `${sourceMonth}-${String(sourceDaysInMonth).padStart(2, \"0\")}`;\n\n      const targetYear = parseInt(targetMonth.split(\"-\")[0]);\n      const targetMonthNum = parseInt(targetMonth.split(\"-\")[1]);\n      const targetDaysInMonth = new Date(targetYear, targetMonthNum, 0).getDate();\n      const targetStart = `${targetMonth}-01`;\n      const targetEnd = `${targetMonth}-${String(targetDaysInMonth).padStart(2, \"0\")}`;\n\n      const sourceAllocations = await storage.getAllocationsByDateRangeAndPost(\n        sourceStart,\n        sourceEnd,\n        parsedPostId\n      );\n\n      if (sourceAllocations.length === 0) {\n        return res.status(400).json({ message: \"No allocations found in source month\" });\n      }\n\n      await storage.deleteAllocationsByDateRangeAndPost(targetStart, targetEnd, parsedPostId);\n\n      const newAllocations = sourceAllocations.map((allocation) => {\n        const sourceDate = new Date(allocation.date);\n        const dayOfMonth = sourceDate.getDate();\n        const adjustedDay = Math.min(dayOfMonth, targetDaysInMonth);\n        const targetDate = `${targetMonth}-${String(adjustedDay).padStart(2, \"0\")}`;\n\n        return {\n          employeeId: allocation.employeeId,\n          postId: parsedPostId,\n          date: targetDate,\n          status: allocation.status,\n          notes: allocation.notes,\n        };\n      });\n\n      const uniqueAllocations = newAllocations.reduce((acc, curr) => {\n        const key = `${curr.employeeId}-${curr.date}`;\n        if (!acc.has(key)) {\n          acc.set(key, curr);\n        }\n        return acc;\n      }, new Map());\n\n      const created = await storage.bulkCreateAllocations(Array.from(uniqueAllocations.values()));\n      await logAction(req.user?.claims?.sub, \"bulk_copy\", \"allocation\", undefined, {\n        sourceMonth,\n        targetMonth,\n        postId,\n        count: created.length,\n      });\n\n      res.status(201).json({ message: \"Allocations copied successfully\", count: created.length });\n    } catch (error) {\n      console.error(\"Error copying allocations:\", error);\n      res.status(500).json({ message: \"Failed to copy allocations\" });\n    }\n  });\n\n  app.post(\n    \"/api/allocations/import-csv\",\n    isAuthenticated,\n    isAdmin,\n    upload.single(\"file\"),\n    async (req: any, res) => {\n      try {\n        if (!req.file) {\n          return res.status(400).json({ message: \"No file uploaded\" });\n        }\n\n        const { postId, month } = req.body;\n        if (!postId || !month) {\n          fs.unlinkSync(req.file.path);\n          return res.status(400).json({ message: \"postId and month are required\" });\n        }\n\n        const parsedPostId = parseInt(postId);\n        if (isNaN(parsedPostId) || parsedPostId <= 0) {\n          fs.unlinkSync(req.file.path);\n          return res.status(400).json({ message: \"Invalid postId\" });\n        }\n\n        const fileContent = fs.readFileSync(req.file.path, \"utf-8\");\n        fs.unlinkSync(req.file.path);\n\n        const normalizedContent = fileContent.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\n        const lines = normalizedContent.trim().split(\"\\n\");\n        if (lines.length < 2) {\n          return res.status(400).json({ message: \"CSV file must have headers and at least one data row\" });\n        }\n\n        const headers = lines[0].split(\",\").map((h) => h.trim().toLowerCase().replace(/^[\"']|[\"']$/g, \"\"));\n        const employeeIdIndex = headers.findIndex((h) => h === \"employee_id\" || h === \"employeeid\");\n        const dateIndex = headers.findIndex((h) => h === \"date\");\n        const statusIndex = headers.findIndex((h) => h === \"status\");\n\n        if (employeeIdIndex === -1 || dateIndex === -1 || statusIndex === -1) {\n          return res.status(400).json({\n            message: \"CSV must have columns: employee_id (or employeeid), date, status\",\n          });\n        }\n\n        const validStatuses = [\"present\", \"absent\", \"justified\", \"vacation\", \"medical_leave\"];\n        const allocationsToCreate: any[] = [];\n        const errors: string[] = [];\n\n        for (let i = 1; i < lines.length; i++) {\n          const line = lines[i].trim();\n          if (!line) continue;\n\n          const values = line.split(\",\").map((v) => v.trim().replace(/^[\"']|[\"']$/g, \"\"));\n          const employeeId = parseInt(values[employeeIdIndex]);\n          const dateValue = values[dateIndex];\n          const statusValue = values[statusIndex]?.toLowerCase();\n\n          if (isNaN(employeeId) || employeeId <= 0) {\n            errors.push(`Row ${i + 1}: Invalid employee_id`);\n            continue;\n          }\n\n          if (!dateValue || !/^\\d{4}-\\d{2}-\\d{2}$/.test(dateValue)) {\n            errors.push(`Row ${i + 1}: Invalid date format (use YYYY-MM-DD)`);\n            continue;\n          }\n\n          if (!statusValue || !validStatuses.includes(statusValue)) {\n            errors.push(`Row ${i + 1}: Invalid status \"${statusValue || 'empty'}\". Valid: ${validStatuses.join(\", \")}`);\n            continue;\n          }\n\n          allocationsToCreate.push({\n            employeeId,\n            postId: parsedPostId,\n            date: dateValue,\n            status: statusValue,\n          });\n        }\n\n        if (allocationsToCreate.length === 0) {\n          return res.status(400).json({\n            message: \"No valid allocations found in CSV\",\n            errors,\n          });\n        }\n\n        const uniqueAllocations = allocationsToCreate.reduce((acc, curr) => {\n          const key = `${curr.employeeId}-${curr.date}`;\n          acc.set(key, curr);\n          return acc;\n        }, new Map());\n\n        const created = await storage.bulkCreateAllocations(Array.from(uniqueAllocations.values()));\n        await logAction(req.user?.claims?.sub, \"bulk_import\", \"allocation\", undefined, {\n          postId,\n          month,\n          count: created.length,\n        });\n\n        res.status(201).json({\n          message: \"CSV imported successfully\",\n          imported: created.length,\n          errors: errors.length > 0 ? errors : undefined,\n        });\n      } catch (error) {\n        console.error(\"Error importing CSV:\", error);\n        res.status(500).json({ message: \"Failed to import CSV\" });\n      }\n    }\n  );\n\n  app.get(\"/api/occurrences\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { startDate, endDate, category, employeeId } = req.query;\n      const occurrencesList = await storage.getOccurrences({\n        startDate: startDate as string | undefined,\n        endDate: endDate as string | undefined,\n        category: category as string | undefined,\n        employeeId: employeeId ? parseInt(employeeId as string) : undefined,\n      });\n      \n      // LGPD logging for occurrence data access (may contain employee info)\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"occurrences_list\", undefined, { count: occurrencesList.length, filters: { startDate, endDate, category, employeeId } });\n      \n      res.json(occurrencesList);\n    } catch (error) {\n      console.error(\"Error fetching occurrences:\", error);\n      res.status(500).json({ message: \"Failed to fetch occurrences\" });\n    }\n  });\n\n  app.get(\"/api/occurrences/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const occurrence = await storage.getOccurrence(id);\n      if (!occurrence) {\n        return res.status(404).json({ message: \"Occurrence not found\" });\n      }\n      \n      // LGPD logging for occurrence detail access\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"occurrence\", id, { employeeId: occurrence.employeeId, date: occurrence.date });\n      \n      res.json(occurrence);\n    } catch (error) {\n      console.error(\"Error fetching occurrence:\", error);\n      res.status(500).json({ message: \"Failed to fetch occurrence\" });\n    }\n  });\n\n  app.post(\"/api/occurrences\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertOccurrenceSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      const occurrence = await storage.createOccurrence(parsed.data);\n      await logAction(req.user?.claims?.sub, \"create\", \"occurrence\", occurrence.id);\n      res.status(201).json(occurrence);\n    } catch (error) {\n      console.error(\"Error creating occurrence:\", error);\n      res.status(500).json({ message: \"Failed to create occurrence\" });\n    }\n  });\n\n  app.patch(\"/api/occurrences/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getOccurrence(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Occurrence not found\" });\n      }\n      const occurrence = await storage.updateOccurrence(id, req.body);\n      if (!occurrence) {\n        return res.status(404).json({ message: \"Occurrence not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"occurrence\", id, req.body, before, occurrence);\n      res.json(occurrence);\n    } catch (error) {\n      console.error(\"Error updating occurrence:\", error);\n      res.status(500).json({ message: \"Failed to update occurrence\" });\n    }\n  });\n\n  app.delete(\"/api/occurrences/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getOccurrence(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Occurrence not found\" });\n      }\n      const deleted = await storage.deleteOccurrence(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Occurrence not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"occurrence\", id, null, before, null);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting occurrence:\", error);\n      res.status(500).json({ message: \"Failed to delete occurrence\" });\n    }\n  });\n\n  app.get(\"/api/documents\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { documentType, employeeId, postId, monthYear } = req.query;\n      const documentsList = await storage.getDocuments({\n        documentType: documentType as string | undefined,\n        employeeId: employeeId ? parseInt(employeeId as string) : undefined,\n        postId: postId ? parseInt(postId as string) : undefined,\n        monthYear: monthYear as string | undefined,\n      });\n      \n      // LGPD logging for document access (may contain personal data)\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"documents_list\", undefined, { count: documentsList.length, filters: { documentType, employeeId, postId, monthYear } });\n      \n      res.json(documentsList);\n    } catch (error) {\n      console.error(\"Error fetching documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch documents\" });\n    }\n  });\n\n  app.get(\"/api/documents/expiring\", isAuthenticated, async (req: any, res) => {\n    try {\n      const daysAhead = req.query.days ? parseInt(req.query.days as string) : 30;\n      const expiringDocs = await storage.getExpiringDocuments(daysAhead);\n      \n      // LGPD logging for expiring documents access\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"documents_expiring\", undefined, { daysAhead, count: expiringDocs.length });\n      \n      res.json(expiringDocs);\n    } catch (error) {\n      console.error(\"Error fetching expiring documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch expiring documents\" });\n    }\n  });\n\n  app.get(\"/api/documents/expired\", isAuthenticated, async (req: any, res) => {\n    try {\n      const expiredDocs = await storage.getExpiredDocuments();\n      \n      // LGPD logging for expired documents access\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"documents_expired\", undefined, { count: expiredDocs.length });\n      \n      res.json(expiredDocs);\n    } catch (error) {\n      console.error(\"Error fetching expired documents:\", error);\n      res.status(500).json({ message: \"Failed to fetch expired documents\" });\n    }\n  });\n\n  app.get(\"/api/documents/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const document = await storage.getDocument(id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      \n      // LGPD logging for document access\n      await logLgpdAccess(req, \"view\", \"personal_data\", \"document\", id, { filename: document.originalName, documentType: document.documentType });\n      \n      res.json(document);\n    } catch (error) {\n      console.error(\"Error fetching document:\", error);\n      res.status(500).json({ message: \"Failed to fetch document\" });\n    }\n  });\n\n  app.post(\n    \"/api/documents/upload\",\n    isAuthenticated,\n    isAdmin,\n    upload.single(\"file\"),\n    async (req: any, res) => {\n      try {\n        if (!req.file) {\n          return res.status(400).json({ message: \"No file uploaded\" });\n        }\n\n        const { documentType, employeeId, postId, monthYear, expirationDate } = req.body;\n\n        const document = await storage.createDocument({\n          filename: req.file.filename,\n          originalName: req.file.originalname,\n          mimeType: req.file.mimetype,\n          size: req.file.size,\n          path: req.file.path,\n          documentType: documentType || \"other\",\n          employeeId: employeeId ? parseInt(employeeId) : null,\n          postId: postId ? parseInt(postId) : null,\n          monthYear: monthYear || null,\n          expirationDate: expirationDate || null,\n          uploadedBy: req.user?.claims?.sub || null,\n        });\n\n        await logAction(req.user?.claims?.sub, \"upload\", \"document\", document.id, {\n          filename: document.originalName,\n        });\n        res.status(201).json(document);\n      } catch (error) {\n        console.error(\"Error uploading document:\", error);\n        res.status(500).json({ message: \"Failed to upload document\" });\n      }\n    }\n  );\n\n  app.get(\"/api/documents/:id/download\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const document = await storage.getDocument(id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n\n      if (!fs.existsSync(document.path)) {\n        return res.status(404).json({ message: \"File not found\" });\n      }\n      \n      // LGPD logging for document download (export of personal data)\n      await logLgpdAccess(req, \"export\", \"personal_data\", \"document_download\", id, { filename: document.originalName, documentType: document.documentType });\n\n      res.download(document.path, document.originalName);\n    } catch (error) {\n      console.error(\"Error downloading document:\", error);\n      res.status(500).json({ message: \"Failed to download document\" });\n    }\n  });\n\n  app.delete(\"/api/documents/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const document = await storage.getDocument(id);\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n\n      if (fs.existsSync(document.path)) {\n        fs.unlinkSync(document.path);\n      }\n\n      await storage.deleteDocument(id);\n      await logAction(req.user?.claims?.sub, \"delete\", \"document\", id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting document:\", error);\n      res.status(500).json({ message: \"Failed to delete document\" });\n    }\n  });\n\n  app.patch(\"/api/documents/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const { expirationDate } = req.body;\n      \n      const document = await storage.updateDocument(id, { expirationDate: expirationDate || null });\n      if (!document) {\n        return res.status(404).json({ message: \"Document not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"document\", id, { expirationDate });\n      res.json(document);\n    } catch (error) {\n      console.error(\"Error updating document:\", error);\n      res.status(500).json({ message: \"Failed to update document\" });\n    }\n  });\n\n  app.get(\"/api/users\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const usersList = await storage.getAllUsers();\n      res.json(usersList);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.patch(\"/api/users/:id/role\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { id } = req.params;\n      const { role } = req.body;\n      if (![\"admin\", \"viewer\"].includes(role)) {\n        return res.status(400).json({ message: \"Invalid role\" });\n      }\n      const user = await storage.updateUserRole(id, role);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update_role\", \"user\", id, { role });\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error updating user role:\", error);\n      res.status(500).json({ message: \"Failed to update user role\" });\n    }\n  });\n\n  app.get(\"/api/audit-logs\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : 100;\n      const logs = await storage.getAuditLogs(limit);\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching audit logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch audit logs\" });\n    }\n  });\n\n  app.get(\"/api/notification-settings\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const settings = await storage.getNotificationSettings();\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching notification settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch notification settings\" });\n    }\n  });\n\n  app.get(\"/api/notification-settings/my\", isAuthenticated, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub;\n      const settings = await storage.getNotificationSettingsByUser(userId);\n      res.json(settings || null);\n    } catch (error) {\n      console.error(\"Error fetching user notification settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch notification settings\" });\n    }\n  });\n\n  app.post(\"/api/notification-settings\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertNotificationSettingsSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      const settings = await storage.createNotificationSettings(parsed.data);\n      await logAction(req.user?.claims?.sub, \"create\", \"notification_settings\", settings.id);\n      res.status(201).json(settings);\n    } catch (error) {\n      console.error(\"Error creating notification settings:\", error);\n      res.status(500).json({ message: \"Failed to create notification settings\" });\n    }\n  });\n\n  app.patch(\"/api/notification-settings/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const settings = await storage.updateNotificationSettings(id, req.body);\n      if (!settings) {\n        return res.status(404).json({ message: \"Notification settings not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"notification_settings\", id, req.body);\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error updating notification settings:\", error);\n      res.status(500).json({ message: \"Failed to update notification settings\" });\n    }\n  });\n\n  app.delete(\"/api/notification-settings/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const deleted = await storage.deleteNotificationSettings(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Notification settings not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"notification_settings\", id);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting notification settings:\", error);\n      res.status(500).json({ message: \"Failed to delete notification settings\" });\n    }\n  });\n\n  app.get(\"/api/notifications/status\", isAuthenticated, async (_req, res) => {\n    try {\n      res.json({\n        emailServiceConfigured: emailService.isReady(),\n        smtpConfigured: !!process.env.SMTP_HOST,\n      });\n    } catch (error) {\n      console.error(\"Error checking notification status:\", error);\n      res.status(500).json({ message: \"Failed to check notification status\" });\n    }\n  });\n\n  app.post(\"/api/notifications/test\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { email } = req.body;\n      if (!email) {\n        return res.status(400).json({ message: \"Email address is required\" });\n      }\n\n      if (!emailService.isReady()) {\n        return res.status(400).json({ \n          message: \"Email service not configured. Please set SMTP_HOST, SMTP_PORT, SMTP_USER, and SMTP_PASS environment variables.\" \n        });\n      }\n\n      const sent = await emailService.sendEmail({\n        to: email,\n        subject: \"Test Notification - Contract Management System\",\n        html: `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <h2 style=\"color: #1a365d;\">Test Notification</h2>\n            <p>This is a test email from the Contract Management System.</p>\n            <p>If you received this, your email notifications are configured correctly.</p>\n          </div>\n        `,\n        text: \"This is a test email from the Contract Management System.\",\n      });\n\n      if (sent) {\n        res.json({ message: \"Test email sent successfully\" });\n      } else {\n        res.status(500).json({ message: \"Failed to send test email\" });\n      }\n    } catch (error) {\n      console.error(\"Error sending test notification:\", error);\n      res.status(500).json({ message: \"Failed to send test notification\" });\n    }\n  });\n\n  app.post(\"/api/notifications/send-document-expiration\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      if (!emailService.isReady()) {\n        return res.status(400).json({ message: \"Email service not configured\" });\n      }\n\n      const recipients = await storage.getActiveNotificationRecipients('documents');\n      if (recipients.length === 0) {\n        return res.status(400).json({ message: \"No recipients configured for document expiration notifications\" });\n      }\n\n      const expiredDocs = await storage.getExpiredDocuments();\n      const expiringDocs = await storage.getExpiringDocuments(30);\n\n      if (expiredDocs.length === 0 && expiringDocs.length === 0) {\n        return res.json({ message: \"No expired or expiring documents to notify about\" });\n      }\n\n      const today = new Date();\n      const documents = [\n        ...expiredDocs.map(doc => ({\n          documentType: doc.documentType,\n          originalName: doc.originalName,\n          expirationDate: doc.expirationDate || '',\n          employeeName: doc.employee?.name,\n          postName: doc.post?.postName,\n          daysUntilExpiration: doc.expirationDate \n            ? Math.floor((new Date(doc.expirationDate).getTime() - today.getTime()) / (1000 * 60 * 60 * 24))\n            : 0,\n        })),\n        ...expiringDocs.map(doc => ({\n          documentType: doc.documentType,\n          originalName: doc.originalName,\n          expirationDate: doc.expirationDate || '',\n          employeeName: doc.employee?.name,\n          postName: doc.post?.postName,\n          daysUntilExpiration: doc.expirationDate \n            ? Math.floor((new Date(doc.expirationDate).getTime() - today.getTime()) / (1000 * 60 * 60 * 24))\n            : 0,\n        })),\n      ];\n\n      let sentCount = 0;\n      for (const recipient of recipients) {\n        const sent = await emailService.sendDocumentExpirationNotification(recipient, documents);\n        if (sent) sentCount++;\n      }\n\n      await logAction(req.user?.claims?.sub, \"send_notification\", \"document_expiration\", undefined, {\n        recipientCount: recipients.length,\n        sentCount,\n        expiredCount: expiredDocs.length,\n        expiringCount: expiringDocs.length,\n      });\n\n      res.json({ \n        message: `Document expiration notifications sent to ${sentCount} of ${recipients.length} recipients`,\n        expiredDocuments: expiredDocs.length,\n        expiringDocuments: expiringDocs.length,\n      });\n    } catch (error) {\n      console.error(\"Error sending document expiration notifications:\", error);\n      res.status(500).json({ message: \"Failed to send document expiration notifications\" });\n    }\n  });\n\n  app.post(\"/api/notifications/send-daily-summary\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      if (!emailService.isReady()) {\n        return res.status(400).json({ message: \"Email service not configured\" });\n      }\n\n      const recipients = await storage.getActiveNotificationRecipients('daily');\n      if (recipients.length === 0) {\n        return res.status(400).json({ message: \"No recipients configured for daily summary notifications\" });\n      }\n\n      const today = new Date().toISOString().split('T')[0];\n      const stats = await storage.getDashboardStats();\n      const expiredDocs = await storage.getExpiredDocuments();\n      const expiringDocs = await storage.getExpiringDocuments(30);\n\n      const summary = {\n        date: today,\n        newOccurrences: stats.recentOccurrences,\n        missingAllocations: 0,\n        expiredDocuments: expiredDocs.length,\n        expiringDocuments: expiringDocs.length,\n      };\n\n      let sentCount = 0;\n      for (const recipient of recipients) {\n        const sent = await emailService.sendDailySummaryNotification(recipient, summary);\n        if (sent) sentCount++;\n      }\n\n      await logAction(req.user?.claims?.sub, \"send_notification\", \"daily_summary\", undefined, {\n        recipientCount: recipients.length,\n        sentCount,\n        summary,\n      });\n\n      res.json({ \n        message: `Daily summary sent to ${sentCount} of ${recipients.length} recipients`,\n        summary,\n      });\n    } catch (error) {\n      console.error(\"Error sending daily summary:\", error);\n      res.status(500).json({ message: \"Failed to send daily summary\" });\n    }\n  });\n\n  // Admin Audit Logs Routes\n  app.get(\"/api/admin/audit-logs\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const { userId, entityType, action, startDate, endDate, limit } = req.query;\n      const logs = await storage.getAuditLogsFiltered({\n        userId: userId as string | undefined,\n        entityType: entityType as string | undefined,\n        action: action as string | undefined,\n        startDate: startDate as string | undefined,\n        endDate: endDate as string | undefined,\n        limit: limit ? parseInt(limit as string) : undefined,\n      });\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching audit logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch audit logs\" });\n    }\n  });\n\n  app.get(\"/api/admin/audit-logs/export\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { userId, entityType, action, startDate, endDate } = req.query;\n      const logs = await storage.getAuditLogsFiltered({\n        userId: userId as string | undefined,\n        entityType: entityType as string | undefined,\n        action: action as string | undefined,\n        startDate: startDate as string | undefined,\n        endDate: endDate as string | undefined,\n        limit: 10000,\n      });\n\n      // LGPD logging for audit log export\n      await logLgpdAccess(req, \"export\", \"sensitive_data\", \"audit_logs_export\", undefined, { count: logs.length, filters: { userId, entityType, action, startDate, endDate } });\n\n      const csvHeader = \"ID,Data/Hora,Usuário,Ação,Entidade,ID Entidade,Detalhes\\n\";\n      const csvRows = logs.map(log => {\n        const timestamp = log.timestamp ? new Date(log.timestamp).toLocaleString('pt-BR') : '';\n        const userName = log.user ? `${log.user.firstName || ''} ${log.user.lastName || ''}`.trim() : 'Sistema';\n        const details = log.details ? JSON.stringify(log.details).replace(/\"/g, '\"\"') : '';\n        return `${log.id},\"${timestamp}\",\"${userName}\",\"${log.action}\",\"${log.entityType}\",\"${log.entityId || ''}\",\"${details}\"`;\n      }).join(\"\\n\");\n\n      res.setHeader('Content-Type', 'text/csv; charset=utf-8');\n      res.setHeader('Content-Disposition', `attachment; filename=audit_logs_${new Date().toISOString().split('T')[0]}.csv`);\n      res.send('\\uFEFF' + csvHeader + csvRows);\n    } catch (error) {\n      console.error(\"Error exporting audit logs:\", error);\n      res.status(500).json({ message: \"Failed to export audit logs\" });\n    }\n  });\n\n  app.get(\"/api/admin/audit-logs/entity-types\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const entityTypes = [\"employee\", \"service_post\", \"allocation\", \"occurrence\", \"document\", \"user\", \"notification_settings\", \"alert\"];\n      res.json(entityTypes);\n    } catch (error) {\n      console.error(\"Error fetching entity types:\", error);\n      res.status(500).json({ message: \"Failed to fetch entity types\" });\n    }\n  });\n\n  app.get(\"/api/admin/audit-logs/actions\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const actions = [\"create\", \"update\", \"delete\", \"bulk_copy\", \"bulk_import\", \"send_notification\", \"mark_treated\", \"resolve\"];\n      res.json(actions);\n    } catch (error) {\n      console.error(\"Error fetching actions:\", error);\n      res.status(500).json({ message: \"Failed to fetch actions\" });\n    }\n  });\n\n  // Admin LGPD Logs Routes\n  app.get(\"/api/admin/lgpd-logs\", isAuthenticated, isAdmin, async (req, res) => {\n    try {\n      const { userId, accessType, dataCategory, entityType, startDate, endDate, limit } = req.query;\n      const logs = await storage.getLgpdLogsFiltered({\n        userId: userId as string | undefined,\n        accessType: accessType as string | undefined,\n        dataCategory: dataCategory as string | undefined,\n        entityType: entityType as string | undefined,\n        startDate: startDate as string | undefined,\n        endDate: endDate as string | undefined,\n        limit: limit ? parseInt(limit as string) : undefined,\n      });\n      res.json(logs);\n    } catch (error) {\n      console.error(\"Error fetching LGPD logs:\", error);\n      res.status(500).json({ message: \"Failed to fetch LGPD logs\" });\n    }\n  });\n\n  app.get(\"/api/admin/lgpd-logs/export\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const { userId, accessType, dataCategory, entityType, startDate, endDate } = req.query;\n      const logs = await storage.getLgpdLogsFiltered({\n        userId: userId as string | undefined,\n        accessType: accessType as string | undefined,\n        dataCategory: dataCategory as string | undefined,\n        entityType: entityType as string | undefined,\n        startDate: startDate as string | undefined,\n        endDate: endDate as string | undefined,\n        limit: 10000,\n      });\n\n      // LGPD logging for LGPD logs export (meta-logging)\n      await logLgpdAccess(req, \"export\", \"sensitive_data\", \"lgpd_logs_export\", undefined, { count: logs.length, filters: { userId, accessType, dataCategory, entityType, startDate, endDate } });\n\n      const csvHeader = \"ID,Data/Hora,Usuário,Tipo de Acesso,Categoria de Dados,Entidade,ID Entidade,Endereço IP,Detalhes\\n\";\n      const csvRows = logs.map(log => {\n        const timestamp = log.timestamp ? new Date(log.timestamp).toLocaleString('pt-BR') : '';\n        const userName = log.user ? `${log.user.firstName || ''} ${log.user.lastName || ''}`.trim() : 'Sistema';\n        const details = log.details ? JSON.stringify(log.details).replace(/\"/g, '\"\"') : '';\n        return `${log.id},\"${timestamp}\",\"${userName}\",\"${log.accessType}\",\"${log.dataCategory}\",\"${log.entityType}\",\"${log.entityId || ''}\",\"${log.ipAddress || ''}\",\"${details}\"`;\n      }).join(\"\\n\");\n\n      res.setHeader('Content-Type', 'text/csv; charset=utf-8');\n      res.setHeader('Content-Disposition', `attachment; filename=lgpd_logs_${new Date().toISOString().split('T')[0]}.csv`);\n      res.send('\\uFEFF' + csvHeader + csvRows);\n    } catch (error) {\n      console.error(\"Error exporting LGPD logs:\", error);\n      res.status(500).json({ message: \"Failed to export LGPD logs\" });\n    }\n  });\n\n  app.get(\"/api/admin/lgpd-logs/access-types\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const accessTypes = [\"view\", \"export\", \"search\"];\n      res.json(accessTypes);\n    } catch (error) {\n      console.error(\"Error fetching access types:\", error);\n      res.status(500).json({ message: \"Failed to fetch access types\" });\n    }\n  });\n\n  app.get(\"/api/admin/lgpd-logs/data-categories\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const dataCategories = [\"personal_data\", \"sensitive_data\", \"financial_data\"];\n      res.json(dataCategories);\n    } catch (error) {\n      console.error(\"Error fetching data categories:\", error);\n      res.status(500).json({ message: \"Failed to fetch data categories\" });\n    }\n  });\n\n  app.get(\"/api/admin/lgpd-logs/entity-types\", isAuthenticated, isAdmin, async (_req, res) => {\n    try {\n      const entityTypes = [\n        \"employee\", \"employees_list\", \"employees_search\",\n        \"allocation\", \"allocations_list\",\n        \"occurrence\", \"occurrences_list\",\n        \"document\", \"documents_list\", \"document_download\", \"documents_expiring\", \"documents_expired\",\n        \"audit_logs_export\", \"lgpd_logs_export\"\n      ];\n      res.json(entityTypes);\n    } catch (error) {\n      console.error(\"Error fetching entity types:\", error);\n      res.status(500).json({ message: \"Failed to fetch entity types\" });\n    }\n  });\n\n  app.get(\"/api/reports/previsto-realizado\", isAuthenticated, async (req, res) => {\n    try {\n      const { startDate, endDate, postId } = req.query;\n\n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"startDate and endDate are required\" });\n      }\n\n      const report = await storage.getPrevistoRealizadoReport({\n        startDate: startDate as string,\n        endDate: endDate as string,\n        postId: postId ? parseInt(postId as string) : undefined,\n      });\n\n      res.json(report);\n    } catch (error) {\n      console.error(\"Error fetching previsto-realizado report:\", error);\n      res.status(500).json({ message: \"Failed to fetch previsto-realizado report\" });\n    }\n  });\n\n  // Document Checklists Routes\n  app.get(\"/api/document-checklists\", isAuthenticated, async (req, res) => {\n    try {\n      const { postId } = req.query;\n      const checklists = await storage.getDocumentChecklists(\n        postId ? parseInt(postId as string) : undefined\n      );\n      res.json(checklists);\n    } catch (error) {\n      console.error(\"Error fetching document checklists:\", error);\n      res.status(500).json({ message: \"Failed to fetch document checklists\" });\n    }\n  });\n\n  app.get(\"/api/document-checklists/:id\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const checklist = await storage.getDocumentChecklist(id);\n      if (!checklist) {\n        return res.status(404).json({ message: \"Document checklist not found\" });\n      }\n      res.json(checklist);\n    } catch (error) {\n      console.error(\"Error fetching document checklist:\", error);\n      res.status(500).json({ message: \"Failed to fetch document checklist\" });\n    }\n  });\n\n  app.post(\"/api/document-checklists\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertDocumentChecklistSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      const checklist = await storage.createDocumentChecklist(parsed.data);\n      await logAction(req.user?.claims?.sub, \"create\", \"document_checklist\", checklist.id, { name: checklist.name, postId: checklist.postId });\n      res.status(201).json(checklist);\n    } catch (error) {\n      console.error(\"Error creating document checklist:\", error);\n      res.status(500).json({ message: \"Failed to create document checklist\" });\n    }\n  });\n\n  app.patch(\"/api/document-checklists/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getDocumentChecklist(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Document checklist not found\" });\n      }\n      const checklist = await storage.updateDocumentChecklist(id, req.body);\n      if (!checklist) {\n        return res.status(404).json({ message: \"Document checklist not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"update\", \"document_checklist\", id, req.body, before, checklist);\n      res.json(checklist);\n    } catch (error) {\n      console.error(\"Error updating document checklist:\", error);\n      res.status(500).json({ message: \"Failed to update document checklist\" });\n    }\n  });\n\n  app.delete(\"/api/document-checklists/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getDocumentChecklist(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Document checklist not found\" });\n      }\n      const deleted = await storage.deleteDocumentChecklist(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Document checklist not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"document_checklist\", id, null, before, null);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting document checklist:\", error);\n      res.status(500).json({ message: \"Failed to delete document checklist\" });\n    }\n  });\n\n  app.get(\"/api/service-posts/:id/checklist-compliance\", isAuthenticated, async (req, res) => {\n    try {\n      const postId = parseInt(req.params.id);\n      const compliance = await storage.getChecklistComplianceByPost(postId);\n      res.json(compliance);\n    } catch (error) {\n      console.error(\"Error fetching checklist compliance:\", error);\n      res.status(500).json({ message: \"Failed to fetch checklist compliance\" });\n    }\n  });\n\n  // Document Version Tracking Routes\n  app.get(\"/api/documents/:id/versions\", isAuthenticated, async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const versions = await storage.getDocumentVersions(id);\n      res.json(versions);\n    } catch (error) {\n      console.error(\"Error fetching document versions:\", error);\n      res.status(500).json({ message: \"Failed to fetch document versions\" });\n    }\n  });\n\n  app.post(\n    \"/api/documents/:id/new-version\",\n    isAuthenticated,\n    isAdmin,\n    upload.single(\"file\"),\n    async (req: any, res) => {\n      try {\n        const originalDocId = parseInt(req.params.id);\n        const originalDoc = await storage.getDocument(originalDocId);\n        if (!originalDoc) {\n          if (req.file) fs.unlinkSync(req.file.path);\n          return res.status(404).json({ message: \"Original document not found\" });\n        }\n\n        if (!req.file) {\n          return res.status(400).json({ message: \"No file uploaded\" });\n        }\n\n        const newDocument = await storage.createDocumentVersion(originalDocId, {\n          filename: req.file.filename,\n          originalName: req.file.originalname,\n          mimeType: req.file.mimetype,\n          size: req.file.size,\n          path: req.file.path,\n          documentType: originalDoc.documentType,\n          employeeId: originalDoc.employeeId,\n          postId: originalDoc.postId,\n          monthYear: originalDoc.monthYear,\n          expirationDate: req.body.expirationDate || originalDoc.expirationDate,\n          observations: req.body.observations || originalDoc.observations,\n          uploadedBy: req.user?.claims?.sub || null,\n        });\n\n        await logAction(req.user?.claims?.sub, \"create_version\", \"document\", newDocument.id, {\n          previousVersionId: originalDocId,\n          version: newDocument.version,\n        });\n\n        res.status(201).json(newDocument);\n      } catch (error) {\n        console.error(\"Error creating document version:\", error);\n        if (req.file && fs.existsSync(req.file.path)) {\n          fs.unlinkSync(req.file.path);\n        }\n        res.status(500).json({ message: \"Failed to create document version\" });\n      }\n    }\n  );\n\n  // Férias & Licenças Routes\n  app.get(\"/api/ferias-licencas\", isAuthenticated, async (req: any, res) => {\n    try {\n      const { employeeId, type, status } = req.query;\n      const feriasLicencas = await storage.getFeriasLicencas({\n        employeeId: employeeId ? parseInt(employeeId as string) : undefined,\n        type: type as string | undefined,\n        status: status as string | undefined,\n      });\n      \n      await logLgpdAccess(req, \"view\", \"personal_data\", \"ferias_licencas_list\", undefined, { count: feriasLicencas.length });\n      res.json(feriasLicencas);\n    } catch (error) {\n      console.error(\"Error fetching férias/licenças:\", error);\n      res.status(500).json({ message: \"Failed to fetch férias/licenças\" });\n    }\n  });\n\n  app.get(\"/api/ferias-licencas/:id\", isAuthenticated, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const feriasLicenca = await storage.getFeriasLicenca(id);\n      if (!feriasLicenca) {\n        return res.status(404).json({ message: \"Férias/Licença not found\" });\n      }\n      \n      await logLgpdAccess(req, \"view\", \"personal_data\", \"ferias_licenca\", id, { employeeId: feriasLicenca.employeeId });\n      res.json(feriasLicenca);\n    } catch (error) {\n      console.error(\"Error fetching férias/licença:\", error);\n      res.status(500).json({ message: \"Failed to fetch férias/licença\" });\n    }\n  });\n\n  function getLeaveAllocationStatus(type: string): \"vacation\" | \"medical_leave\" {\n    switch (type) {\n      case \"ferias\":\n        return \"vacation\";\n      case \"licenca_medica\":\n      case \"licenca_maternidade\":\n      case \"licenca_paternidade\":\n      case \"licenca_nojo\":\n      case \"licenca_casamento\":\n      case \"outros\":\n      default:\n        return \"medical_leave\";\n    }\n  }\n\n  async function syncAllocationStatusForVacation(\n    employeeId: number,\n    startDate: string,\n    endDate: string,\n    type: string,\n    status: string\n  ) {\n    const allocationStatus = getLeaveAllocationStatus(type);\n    const shouldApply = status === \"aprovado\" || status === \"em_andamento\";\n    \n    const allocations = await storage.getAllocationsByDateRange(startDate, endDate);\n    const employeeAllocations = allocations.filter(a => a.employeeId === employeeId);\n    \n    for (const allocation of employeeAllocations) {\n      if (shouldApply) {\n        await storage.updateAllocation(allocation.id, { status: allocationStatus });\n      } else {\n        await storage.updateAllocation(allocation.id, { status: \"present\" });\n      }\n    }\n  }\n\n  function validateDateRange(startDate: string, endDate: string): boolean {\n    return new Date(startDate) <= new Date(endDate);\n  }\n\n  app.post(\"/api/ferias-licencas\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const parsed = insertFeriasLicencasSchema.safeParse({\n        ...req.body,\n        createdBy: req.user?.claims?.sub || null,\n      });\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      \n      if (!validateDateRange(parsed.data.startDate, parsed.data.endDate)) {\n        return res.status(400).json({ message: \"Data de início deve ser anterior ou igual à data de término\" });\n      }\n      \n      const feriasLicenca = await storage.createFeriasLicenca(parsed.data);\n      \n      if (feriasLicenca.status === \"aprovado\" || feriasLicenca.status === \"em_andamento\") {\n        await syncAllocationStatusForVacation(\n          feriasLicenca.employeeId,\n          feriasLicenca.startDate,\n          feriasLicenca.endDate,\n          feriasLicenca.type,\n          feriasLicenca.status\n        );\n      }\n      \n      await logAction(req.user?.claims?.sub, \"create\", \"ferias_licenca\", feriasLicenca.id, { \n        employeeId: feriasLicenca.employeeId, \n        type: feriasLicenca.type,\n        startDate: feriasLicenca.startDate,\n        endDate: feriasLicenca.endDate,\n      });\n      res.status(201).json(feriasLicenca);\n    } catch (error) {\n      console.error(\"Error creating férias/licença:\", error);\n      res.status(500).json({ message: \"Failed to create férias/licença\" });\n    }\n  });\n\n  app.patch(\"/api/ferias-licencas/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getFeriasLicenca(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Férias/Licença not found\" });\n      }\n      \n      const updateSchema = insertFeriasLicencasSchema.partial().omit({ createdBy: true });\n      const parsed = updateSchema.safeParse(req.body);\n      if (!parsed.success) {\n        return res.status(400).json({ message: \"Invalid data\", errors: parsed.error.errors });\n      }\n      \n      const startDate = parsed.data.startDate || before.startDate;\n      const endDate = parsed.data.endDate || before.endDate;\n      if (!validateDateRange(startDate, endDate)) {\n        return res.status(400).json({ message: \"Data de início deve ser anterior ou igual à data de término\" });\n      }\n      \n      const feriasLicenca = await storage.updateFeriasLicenca(id, parsed.data);\n      if (!feriasLicenca) {\n        return res.status(404).json({ message: \"Férias/Licença not found\" });\n      }\n      \n      const beforeWasActive = before.status === \"aprovado\" || before.status === \"em_andamento\";\n      const afterIsActive = feriasLicenca.status === \"aprovado\" || feriasLicenca.status === \"em_andamento\";\n      \n      if (beforeWasActive && !afterIsActive) {\n        await syncAllocationStatusForVacation(\n          before.employeeId,\n          before.startDate,\n          before.endDate,\n          before.type,\n          \"pendente\"\n        );\n      }\n      \n      if (afterIsActive) {\n        await syncAllocationStatusForVacation(\n          feriasLicenca.employeeId,\n          feriasLicenca.startDate,\n          feriasLicenca.endDate,\n          feriasLicenca.type,\n          feriasLicenca.status\n        );\n      }\n      \n      await logAction(req.user?.claims?.sub, \"update\", \"ferias_licenca\", id, parsed.data, before, feriasLicenca);\n      res.json(feriasLicenca);\n    } catch (error) {\n      console.error(\"Error updating férias/licença:\", error);\n      res.status(500).json({ message: \"Failed to update férias/licença\" });\n    }\n  });\n\n  app.delete(\"/api/ferias-licencas/:id\", isAuthenticated, isAdmin, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const before = await storage.getFeriasLicenca(id);\n      if (!before) {\n        return res.status(404).json({ message: \"Férias/Licença not found\" });\n      }\n      \n      if (before.status === \"aprovado\" || before.status === \"em_andamento\") {\n        await syncAllocationStatusForVacation(\n          before.employeeId,\n          before.startDate,\n          before.endDate,\n          before.type,\n          \"pendente\"\n        );\n      }\n      \n      const deleted = await storage.deleteFeriasLicenca(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Férias/Licença not found\" });\n      }\n      await logAction(req.user?.claims?.sub, \"delete\", \"ferias_licenca\", id, null, before, null);\n      res.status(204).send();\n    } catch (error) {\n      console.error(\"Error deleting férias/licença:\", error);\n      res.status(500).json({ message: \"Failed to delete férias/licença\" });\n    }\n  });\n\n  app.get(\"/api/dashboard/vacations-leaves\", isAuthenticated, async (_req, res) => {\n    try {\n      const activeFeriasLicencas = await storage.getActiveFeriasLicencas();\n      res.json({\n        total: activeFeriasLicencas.length,\n        items: activeFeriasLicencas,\n      });\n    } catch (error) {\n      console.error(\"Error fetching active vacations/leaves:\", error);\n      res.status(500).json({ message: \"Failed to fetch active vacations/leaves\" });\n    }\n  });\n\n  return httpServer;\n}\n","path":null,"size_bytes":65346,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertCircle, Home } from \"lucide-react\";\nimport { translations } from \"@/lib/translations\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-background\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex flex-col items-center text-center\">\n            <AlertCircle className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h1 className=\"text-2xl font-bold text-foreground\" data-testid=\"text-404-title\">\n              404 - {translations.notFound.title}\n            </h1>\n            <p className=\"mt-4 text-sm text-muted-foreground\" data-testid=\"text-404-description\">\n              {translations.notFound.description}\n            </p>\n            <Button asChild className=\"mt-6\" data-testid=\"button-back-home\">\n              <a href=\"/\">\n                <Home className=\"h-4 w-4 mr-2\" />\n                {translations.notFound.backHome}\n              </a>\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":1217,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport {\n  LayoutDashboard,\n  Users,\n  Briefcase,\n  CalendarDays,\n  AlertCircle,\n  FileText,\n  BarChart3,\n  Settings,\n  LogOut,\n  Bell,\n  AlertTriangle,\n  ClipboardList,\n  ShieldCheck,\n  CalendarCheck,\n} from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { translations } from \"@/lib/translations\";\nimport { DicaLogo } from \"@/components/dica-logo\";\n\nconst mainNavItems = [\n  {\n    title: translations.nav.dashboard,\n    url: \"/\",\n    icon: LayoutDashboard,\n  },\n  {\n    title: translations.nav.employees,\n    url: \"/employees\",\n    icon: Users,\n  },\n  {\n    title: translations.nav.servicePosts,\n    url: \"/service-posts\",\n    icon: Briefcase,\n  },\n  {\n    title: translations.nav.allocation,\n    url: \"/allocation\",\n    icon: CalendarDays,\n  },\n  {\n    title: translations.nav.feriasLicencas,\n    url: \"/ferias-licencas\",\n    icon: CalendarCheck,\n  },\n  {\n    title: translations.nav.occurrences,\n    url: \"/occurrences\",\n    icon: AlertCircle,\n  },\n  {\n    title: translations.nav.documents,\n    url: \"/documents\",\n    icon: FileText,\n  },\n  {\n    title: translations.nav.alerts,\n    url: \"/alerts\",\n    icon: AlertTriangle,\n  },\n];\n\nconst adminNavItems = [\n  {\n    title: translations.nav.reports,\n    url: \"/reports\",\n    icon: BarChart3,\n  },\n  {\n    title: translations.nav.notifications,\n    url: \"/notifications\",\n    icon: Bell,\n  },\n  {\n    title: \"Auditoria\",\n    url: \"/auditoria\",\n    icon: ClipboardList,\n  },\n  {\n    title: \"Logs LGPD\",\n    url: \"/lgpd-logs\",\n    icon: ShieldCheck,\n  },\n  {\n    title: translations.nav.adminSettings,\n    url: \"/admin\",\n    icon: Settings,\n  },\n];\n\nfunction getRoleLabel(role?: string): string {\n  switch (role) {\n    case \"admin\":\n      return translations.roles.admin;\n    case \"admin_dica\":\n      return translations.roles.adminDica;\n    case \"operator_dica\":\n      return translations.roles.operatorDica;\n    case \"fiscal_petrobras\":\n      return translations.roles.fiscalPetrobras;\n    case \"viewer\":\n      return translations.roles.viewer;\n    default:\n      return translations.roles.viewer;\n  }\n}\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { user, isAdmin, userRole } = useAuth();\n\n  const getInitials = (firstName?: string | null, lastName?: string | null) => {\n    const first = firstName?.charAt(0) || \"\";\n    const last = lastName?.charAt(0) || \"\";\n    return (first + last).toUpperCase() || \"U\";\n  };\n\n  const canViewAdminItems = isAdmin || userRole === \"admin_dica\" || userRole === \"operator_dica\";\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4\">\n        <div className=\"flex items-center gap-3\">\n          <DicaLogo className=\"h-10 w-10\" />\n          <div className=\"flex flex-col\">\n            <span className=\"text-sm font-semibold\">{translations.branding.appName}</span>\n            <span className=\"text-xs text-muted-foreground\">{translations.branding.companyName}</span>\n          </div>\n        </div>\n      </SidebarHeader>\n      \n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupLabel>{translations.nav.mainMenu}</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu>\n              {mainNavItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton\n                    asChild\n                    isActive={location === item.url || (item.url !== \"/\" && location.startsWith(item.url))}\n                  >\n                    <Link href={item.url} data-testid={`link-nav-${item.url.replace(/\\//g, '') || 'dashboard'}`}>\n                      <item.icon className=\"h-4 w-4\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        <Separator className=\"mx-4\" />\n\n        {canViewAdminItems && (\n          <SidebarGroup>\n            <SidebarGroupLabel>{translations.nav.administration}</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu>\n                {adminNavItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      isActive={location === item.url || location.startsWith(item.url)}\n                    >\n                      <Link href={item.url} data-testid={`link-nav-${item.url.replace(/\\//g, '')}`}>\n                        <item.icon className=\"h-4 w-4\" />\n                        <span>{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n      </SidebarContent>\n\n      <SidebarFooter className=\"p-4\">\n        <Separator className=\"mb-4\" />\n        <div className=\"flex items-center gap-3\">\n          <Avatar className=\"h-9 w-9\">\n            <AvatarImage src={user?.profileImageUrl || undefined} className=\"object-cover\" />\n            <AvatarFallback className=\"text-xs\">\n              {getInitials(user?.firstName, user?.lastName)}\n            </AvatarFallback>\n          </Avatar>\n          <div className=\"flex flex-1 flex-col overflow-hidden\">\n            <span className=\"truncate text-sm font-medium\">\n              {user?.firstName || user?.email || \"Usuário\"}\n            </span>\n            <Badge variant=\"secondary\" className=\"w-fit text-xs\">\n              {getRoleLabel(userRole)}\n            </Badge>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            asChild\n            data-testid=\"button-logout\"\n          >\n            <a href=\"/api/logout\">\n              <LogOut className=\"h-4 w-4\" />\n            </a>\n          </Button>\n        </div>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":6433,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/pages/admin.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Shield, Users, Clock, Activity } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { formatDateTime } from \"@/lib/authUtils\";\nimport { translations } from \"@/lib/translations\";\nimport type { User, AuditLog } from \"@shared/schema\";\n\nexport default function AdminPage() {\n  const { isAdmin, user: currentUser } = useAuth();\n  const { toast } = useToast();\n\n  const { data: users, isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  const { data: auditLogs, isLoading: logsLoading } = useQuery<AuditLog[]>({\n    queryKey: [\"/api/audit-logs\"],\n  });\n\n  const updateRoleMutation = useMutation({\n    mutationFn: async ({ userId, role }: { userId: string; role: string }) => {\n      await apiRequest(\"PATCH\", `/api/users/${userId}/role`, { role });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ title: translations.common.success, description: translations.admin.userUpdated });\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.saveError, variant: \"destructive\" });\n    },\n  });\n\n  if (!isAdmin) {\n    return (\n      <div className=\"space-y-6\">\n        <PageHeader title={translations.admin.title} />\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Shield className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h2 className=\"text-lg font-semibold\">{translations.auth.accessDenied}</h2>\n            <p className=\"text-muted-foreground text-center max-w-md\">\n              {translations.auth.permissionRequired}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const getInitials = (firstName?: string | null, lastName?: string | null, email?: string | null) => {\n    if (firstName || lastName) {\n      return ((firstName?.charAt(0) || \"\") + (lastName?.charAt(0) || \"\")).toUpperCase();\n    }\n    return email?.charAt(0).toUpperCase() || \"U\";\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.admin.title}\n        description={translations.admin.description}\n      />\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"h-5 w-5\" />\n              {translations.admin.userManagement}\n            </CardTitle>\n            <CardDescription>{translations.admin.userManagementDescription}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {usersLoading ? (\n              <div className=\"space-y-3\">\n                {Array.from({ length: 3 }).map((_, i) => (\n                  <div key={i} className=\"flex items-center gap-3\">\n                    <Skeleton className=\"h-10 w-10 rounded-full\" />\n                    <div className=\"flex-1 space-y-1\">\n                      <Skeleton className=\"h-4 w-32\" />\n                      <Skeleton className=\"h-3 w-24\" />\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : users?.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">{translations.admin.noUsers}</p>\n            ) : (\n              <div className=\"space-y-4\">\n                {users?.map((user) => (\n                  <div key={user.id} className=\"flex items-center gap-3 rounded-md border p-3\" data-testid={`user-row-${user.id}`}>\n                    <Avatar className=\"h-10 w-10\">\n                      <AvatarImage src={user.profileImageUrl || undefined} className=\"object-cover\" />\n                      <AvatarFallback>{getInitials(user.firstName, user.lastName, user.email)}</AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium truncate\">\n                        {user.firstName || user.lastName \n                          ? `${user.firstName || \"\"} ${user.lastName || \"\"}`.trim()\n                          : user.email || translations.admin.unknownUser}\n                      </p>\n                      <p className=\"text-xs text-muted-foreground truncate\">{user.email}</p>\n                    </div>\n                    <Select\n                      value={user.role}\n                      onValueChange={(role) => updateRoleMutation.mutate({ userId: user.id, role })}\n                      disabled={user.id === currentUser?.id || updateRoleMutation.isPending}\n                    >\n                      <SelectTrigger className=\"w-[120px]\" data-testid={`select-role-${user.id}`}>\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"admin\">{translations.roles.admin}</SelectItem>\n                        <SelectItem value=\"viewer\">{translations.roles.viewer}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Activity className=\"h-5 w-5\" />\n              {translations.admin.systemStats}\n            </CardTitle>\n            <CardDescription>{translations.admin.systemStatsDescription}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid gap-4 sm:grid-cols-2\">\n              <div className=\"rounded-md border p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Users className=\"h-5 w-5 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">{translations.admin.totalUsers}</span>\n                </div>\n                <p className=\"mt-2 text-2xl font-semibold\">{users?.length || 0}</p>\n              </div>\n              <div className=\"rounded-md border p-4\">\n                <div className=\"flex items-center gap-2\">\n                  <Shield className=\"h-5 w-5 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">{translations.admin.administrators}</span>\n                </div>\n                <p className=\"mt-2 text-2xl font-semibold\">{users?.filter(u => u.role === \"admin\").length || 0}</p>\n              </div>\n              <div className=\"rounded-md border p-4 sm:col-span-2\">\n                <div className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                  <span className=\"text-sm font-medium\">{translations.admin.auditRecords}</span>\n                </div>\n                <p className=\"mt-2 text-2xl font-semibold\">{auditLogs?.length || 0}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Clock className=\"h-5 w-5\" />\n            {translations.admin.auditLog}\n          </CardTitle>\n          <CardDescription>Atividade recente do sistema e alterações</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {logsLoading ? (\n            <div className=\"space-y-2\">\n              {Array.from({ length: 5 }).map((_, i) => <Skeleton key={i} className=\"h-12 w-full\" />)}\n            </div>\n          ) : auditLogs?.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground text-center py-8\">Nenhum registro de auditoria</p>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Data/Hora</TableHead>\n                    <TableHead>Usuário</TableHead>\n                    <TableHead>Ação</TableHead>\n                    <TableHead>Entidade</TableHead>\n                    <TableHead>ID da Entidade</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {auditLogs?.slice(0, 20).map((log) => (\n                    <TableRow key={log.id}>\n                      <TableCell className=\"text-sm\">\n                        {log.timestamp ? formatDateTime(log.timestamp) : \"-\"}\n                      </TableCell>\n                      <TableCell className=\"text-sm\">{log.userId || \"Sistema\"}</TableCell>\n                      <TableCell>\n                        <Badge variant={\n                          log.action === \"CREATE\" ? \"default\" :\n                          log.action === \"UPDATE\" ? \"secondary\" :\n                          log.action === \"DELETE\" ? \"destructive\" : \"outline\"\n                        }>\n                          {log.action === \"CREATE\" ? \"CRIAR\" :\n                           log.action === \"UPDATE\" ? \"ATUALIZAR\" :\n                           log.action === \"DELETE\" ? \"EXCLUIR\" : log.action}\n                        </Badge>\n                      </TableCell>\n                      <TableCell className=\"text-sm\">{log.entityType}</TableCell>\n                      <TableCell className=\"text-sm font-mono\">{log.entityId || \"-\"}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              {auditLogs && auditLogs.length > 20 && (\n                <p className=\"text-sm text-muted-foreground mt-2\">Mostrando 20 de {auditLogs.length} registros</p>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10357,"size_tokens":null},"client/src/components/page-header.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ninterface PageHeaderProps {\n  title: string;\n  description?: string;\n  children?: React.ReactNode;\n  className?: string;\n}\n\nexport function PageHeader({ title, description, children, className }: PageHeaderProps) {\n  return (\n    <div className={cn(\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\", className)}>\n      <div>\n        <h1 className=\"text-2xl font-semibold tracking-tight\" data-testid=\"text-page-title\">{title}</h1>\n        {description && (\n          <p className=\"text-sm text-muted-foreground\" data-testid=\"text-page-description\">{description}</p>\n        )}\n      </div>\n      {children && <div className=\"flex items-center gap-2 flex-wrap\">{children}</div>}\n    </div>\n  );\n}\n","path":null,"size_bytes":749,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/pages/service-posts/index.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Plus, Eye, Pencil, Trash2, Search, Filter, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { DataTable } from \"@/components/data-table\";\nimport { StatusBadge } from \"@/components/status-badge\";\nimport { ConfirmDialog } from \"@/components/confirm-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport type { ServicePost } from \"@shared/schema\";\n\nexport default function ServicePostsPage() {\n  const { isAdmin } = useAuth();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [modalityFilter, setModalityFilter] = useState<string>(\"all\");\n  const [unitFilter, setUnitFilter] = useState<string>(\"all\");\n  const [deleteId, setDeleteId] = useState<number | null>(null);\n\n  const { data: servicePosts, isLoading } = useQuery<ServicePost[]>({\n    queryKey: [\"/api/service-posts\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/service-posts/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/service-posts\"] });\n      toast({ title: translations.common.success, description: translations.servicePosts.postDeleted });\n      setDeleteId(null);\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.deleteError, variant: \"destructive\" });\n    },\n  });\n\n  const uniqueUnits = useMemo(() => {\n    const units = new Set<string>();\n    servicePosts?.forEach(p => units.add(p.unit));\n    return Array.from(units).sort();\n  }, [servicePosts]);\n\n  const filteredPosts = servicePosts?.filter((post) => {\n    const matchesSearch = \n      post.postName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      post.postCode.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      post.unit.toLowerCase().includes(searchQuery.toLowerCase());\n    const matchesModality = modalityFilter === \"all\" || post.modality === modalityFilter;\n    const matchesUnit = unitFilter === \"all\" || post.unit === unitFilter;\n    return matchesSearch && matchesModality && matchesUnit;\n  }) || [];\n\n  const activeFilters = [\n    modalityFilter !== \"all\" ? `${translations.servicePosts.modality}: ${modalityFilter === \"onsite\" ? translations.servicePosts.onsite : modalityFilter === \"hybrid\" ? translations.servicePosts.hybrid : translations.servicePosts.remote}` : null,\n    unitFilter !== \"all\" ? `${translations.common.unit}: ${unitFilter}` : null,\n  ].filter(Boolean);\n\n  const clearFilters = () => {\n    setModalityFilter(\"all\");\n    setUnitFilter(\"all\");\n  };\n\n  const columns = [\n    {\n      key: \"postCode\",\n      header: translations.servicePosts.postCode,\n      cell: (post: ServicePost) => (\n        <span className=\"font-mono text-sm\" data-testid={`text-post-code-${post.id}`}>\n          {post.postCode}\n        </span>\n      ),\n    },\n    {\n      key: \"postName\",\n      header: translations.servicePosts.postName,\n      cell: (post: ServicePost) => (\n        <div className=\"font-medium\" data-testid={`text-post-name-${post.id}`}>\n          {post.postName}\n        </div>\n      ),\n    },\n    {\n      key: \"unit\",\n      header: translations.common.unit,\n      cell: (post: ServicePost) => post.unit,\n    },\n    {\n      key: \"modality\",\n      header: translations.servicePosts.modality,\n      cell: (post: ServicePost) => (\n        <StatusBadge status={post.modality} />\n      ),\n    },\n    {\n      key: \"actions\",\n      header: translations.common.actions,\n      className: \"text-right\",\n      cell: (post: ServicePost) => (\n        <div className=\"flex items-center justify-end gap-1\">\n          <Button variant=\"ghost\" size=\"icon\" asChild data-testid={`button-view-post-${post.id}`}>\n            <Link href={`/service-posts/${post.id}`}>\n              <Eye className=\"h-4 w-4\" />\n            </Link>\n          </Button>\n          {isAdmin && (\n            <>\n              <Button variant=\"ghost\" size=\"icon\" asChild data-testid={`button-edit-post-${post.id}`}>\n                <Link href={`/service-posts/${post.id}/edit`}>\n                  <Pencil className=\"h-4 w-4\" />\n                </Link>\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setDeleteId(post.id)}\n                data-testid={`button-delete-post-${post.id}`}\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </>\n          )}\n        </div>\n      ),\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <PageHeader\n        title={translations.servicePosts.title}\n        description={translations.servicePosts.pageDescription}\n      >\n        {isAdmin && (\n          <Button asChild data-testid=\"button-add-post\">\n            <Link href=\"/service-posts/new\">\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {translations.servicePosts.addPost}\n            </Link>\n          </Button>\n        )}\n      </PageHeader>\n\n      <div className=\"flex flex-col gap-4\">\n        <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center\">\n          <div className=\"relative flex-1 max-w-sm\">\n            <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n            <Input\n              placeholder={translations.servicePosts.searchPlaceholder}\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-9\"\n              data-testid=\"input-search-posts\"\n            />\n          </div>\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <Filter className=\"h-4 w-4 text-muted-foreground shrink-0\" />\n            <Select value={modalityFilter} onValueChange={setModalityFilter}>\n              <SelectTrigger className=\"w-[160px]\" data-testid=\"select-modality-filter\">\n                <SelectValue placeholder={translations.servicePosts.modality} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{translations.servicePosts.allModalities}</SelectItem>\n                <SelectItem value=\"onsite\">{translations.servicePosts.onsite}</SelectItem>\n                <SelectItem value=\"hybrid\">{translations.servicePosts.hybrid}</SelectItem>\n                <SelectItem value=\"remote\">{translations.servicePosts.remote}</SelectItem>\n              </SelectContent>\n            </Select>\n            <Select value={unitFilter} onValueChange={setUnitFilter}>\n              <SelectTrigger className=\"w-[160px]\" data-testid=\"select-unit-filter\">\n                <SelectValue placeholder={translations.common.unit} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">{translations.servicePosts.allUnits}</SelectItem>\n                {uniqueUnits.map((unit) => (\n                  <SelectItem key={unit} value={unit}>{unit}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n        {activeFilters.length > 0 && (\n          <div className=\"flex items-center gap-2 flex-wrap\">\n            <span className=\"text-sm text-muted-foreground\">Filtros ativos:</span>\n            {activeFilters.map((filter) => (\n              <Badge key={filter} variant=\"secondary\" className=\"text-xs\">\n                {filter}\n              </Badge>\n            ))}\n            <Button variant=\"ghost\" size=\"sm\" onClick={clearFilters} className=\"h-7 px-2\" data-testid=\"button-clear-filters\">\n              <X className=\"h-3 w-3 mr-1\" />\n              {translations.common.clearFilters}\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <DataTable\n        columns={columns}\n        data={filteredPosts}\n        isLoading={isLoading}\n        emptyMessage={translations.servicePosts.noPosts}\n        emptyDescription=\"Comece adicionando seu primeiro posto de serviço.\"\n        testIdPrefix=\"service-posts\"\n      />\n\n      <ConfirmDialog\n        open={deleteId !== null}\n        onOpenChange={(open) => !open && setDeleteId(null)}\n        title={translations.servicePosts.deletePost}\n        description={translations.servicePosts.deleteConfirm}\n        confirmText={translations.common.delete}\n        onConfirm={() => deleteId && deleteMutation.mutate(deleteId)}\n        variant=\"destructive\"\n        isLoading={deleteMutation.isPending}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":8967,"size_tokens":null},"client/src/pages/occurrences/occurrence-dialog.tsx":{"content":"import { useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { z } from \"zod\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport type { Occurrence, Employee, ServicePost } from \"@shared/schema\";\n\nconst formSchema = z.object({\n  date: z.string().min(1, translations.validation.required),\n  employeeId: z.string().optional(),\n  postId: z.string().optional(),\n  category: z.enum([\"absence\", \"substitution\", \"issue\", \"note\"]),\n  description: z.string().min(5, translations.validation.descriptionMinLength.replace(\"{min}\", \"5\")),\n});\n\ntype FormData = z.infer<typeof formSchema>;\n\ninterface OccurrenceDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  occurrence: Occurrence | null;\n  employees: Employee[];\n  servicePosts: ServicePost[];\n}\n\nexport function OccurrenceDialog({ open, onOpenChange, occurrence, employees, servicePosts }: OccurrenceDialogProps) {\n  const { toast } = useToast();\n  const isEditing = !!occurrence;\n\n  const form = useForm<FormData>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      date: new Date().toISOString().split(\"T\")[0],\n      employeeId: \"\",\n      postId: \"\",\n      category: \"note\",\n      description: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (occurrence) {\n      form.reset({\n        date: occurrence.date,\n        employeeId: occurrence.employeeId?.toString() || \"\",\n        postId: occurrence.postId?.toString() || \"\",\n        category: occurrence.category,\n        description: occurrence.description,\n      });\n    } else {\n      form.reset({\n        date: new Date().toISOString().split(\"T\")[0],\n        employeeId: \"\",\n        postId: \"\",\n        category: \"note\",\n        description: \"\",\n      });\n    }\n  }, [occurrence, form]);\n\n  const mutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const payload = {\n        ...data,\n        employeeId: data.employeeId && data.employeeId !== \"none\" ? parseInt(data.employeeId) : null,\n        postId: data.postId && data.postId !== \"none\" ? parseInt(data.postId) : null,\n      };\n      if (isEditing) {\n        await apiRequest(\"PATCH\", `/api/occurrences/${occurrence.id}`, payload);\n      } else {\n        await apiRequest(\"POST\", \"/api/occurrences\", payload);\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/occurrences\"] });\n      toast({\n        title: translations.common.success,\n        description: isEditing ? translations.occurrences.occurrenceUpdated : translations.occurrences.occurrenceCreated,\n      });\n      onOpenChange(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: translations.common.error,\n        description: error.message || translations.errors.saveError,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle data-testid=\"dialog-occurrence-title\">\n            {isEditing ? translations.occurrences.editOccurrence : translations.occurrences.addOccurrence}\n          </DialogTitle>\n        </DialogHeader>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit((data) => mutation.mutate(data))} className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"date\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{translations.occurrences.date} *</FormLabel>\n                  <FormControl>\n                    <Input type=\"date\" {...field} data-testid=\"input-occurrence-date\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"category\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{translations.occurrences.category} *</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger data-testid=\"select-occurrence-category\">\n                        <SelectValue placeholder={translations.common.selectOption} />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"absence\">{translations.occurrences.absence}</SelectItem>\n                      <SelectItem value=\"substitution\">{translations.occurrences.substitution}</SelectItem>\n                      <SelectItem value=\"issue\">{translations.occurrences.issue}</SelectItem>\n                      <SelectItem value=\"note\">{translations.occurrences.note}</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"employeeId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{translations.occurrences.employee} ({translations.common.optional})</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value || \"none\"}>\n                    <FormControl>\n                      <SelectTrigger data-testid=\"select-occurrence-employee\">\n                        <SelectValue placeholder={`${translations.allocation.selectEmployee} (${translations.common.optional})`} />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"none\">Nenhum</SelectItem>\n                      {employees.map((employee) => (\n                        <SelectItem key={employee.id} value={employee.id.toString()}>\n                          {employee.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"postId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Posto de Serviço ({translations.common.optional})</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value || \"none\"}>\n                    <FormControl>\n                      <SelectTrigger data-testid=\"select-occurrence-post\">\n                        <SelectValue placeholder={`${translations.allocation.selectPost} (${translations.common.optional})`} />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"none\">Nenhum</SelectItem>\n                      {servicePosts.map((post) => (\n                        <SelectItem key={post.id} value={post.id.toString()}>\n                          {post.postCode} - {post.postName}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{translations.common.description} *</FormLabel>\n                  <FormControl>\n                    <Textarea\n                      placeholder=\"Descreva a ocorrência...\"\n                      rows={4}\n                      {...field}\n                      data-testid=\"input-occurrence-description\"\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <DialogFooter>\n              <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)} data-testid=\"button-cancel\">\n                {translations.common.cancel}\n              </Button>\n              <Button type=\"submit\" disabled={mutation.isPending} data-testid=\"button-submit\">\n                {mutation.isPending ? \"Salvando...\" : isEditing ? translations.common.update : translations.common.save}\n              </Button>\n            </DialogFooter>\n          </form>\n        </Form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9145,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines: Contract Management System\n\n## Design Approach\n\n**Selected Framework**: Carbon Design System (IBM)\n**Rationale**: This enterprise contract management application requires a robust, data-centric design language. Carbon excels at information-dense interfaces, complex tables, forms, and administrative workflows - perfectly suited for CRUD operations, reports, and audit trails.\n\n**Key Design Principles**:\n- Clarity over decoration: Information architecture drives every decision\n- Consistent patterns: Predictable interactions reduce cognitive load\n- Productive efficiency: Minimize clicks, maximize data visibility\n- Professional restraint: Enterprise-grade visual language\n\n---\n\n## Typography\n\n**Font Stack**: IBM Plex Sans (via Google Fonts CDN)\n```\n- Headings: IBM Plex Sans, weights 600 (semibold) for h1-h3, 500 (medium) for h4-h6\n- Body: IBM Plex Sans, weight 400 (regular), line-height 1.5\n- Code/Data: IBM Plex Mono, weight 400 (for CPF, codes, identifiers)\n```\n\n**Type Scale**:\n- Page Titles (h1): text-3xl (30px), font-semibold\n- Section Headings (h2): text-2xl (24px), font-semibold\n- Subsections (h3): text-xl (20px), font-medium\n- Component Labels (h4): text-lg (18px), font-medium\n- Body Text: text-base (16px)\n- Helper Text: text-sm (14px)\n- Captions/Metadata: text-xs (12px)\n\n---\n\n## Layout System\n\n**Spacing Primitives**: Use Tailwind units **2, 4, 6, 8, 12, 16** exclusively\n- Micro spacing (form fields, buttons): p-2, gap-2, space-y-2\n- Component spacing (cards, sections): p-4, p-6, gap-4\n- Page sections: py-8, px-6, gap-8\n- Major sections: py-12, px-8, space-y-12\n- Container padding: px-6 lg:px-8\n\n**Grid System**:\n- Sidebar: w-64 fixed left sidebar on desktop (lg:), full-width drawer on mobile\n- Main content: ml-64 on lg:, full-width on mobile\n- Content max-width: max-w-7xl mx-auto for wide tables/dashboards\n- Form containers: max-w-3xl for create/edit forms\n- Card grids: grid-cols-1 md:grid-cols-2 lg:grid-cols-3 with gap-6\n\n**Responsive Breakpoints**:\n- Mobile-first approach\n- md: 768px (tablet, 2-column layouts begin)\n- lg: 1024px (desktop, sidebar appears, 3-column grids)\n- xl: 1280px (wide tables expand)\n\n---\n\n## Component Library\n\n### Navigation\n**Sidebar** (Desktop):\n- Fixed position, full-height, w-64\n- Navigation items: px-4 py-2, flex items-center gap-3\n- Active state: distinct treatment (heavier font weight, indicator bar)\n- Icons from Heroicons (outline style, 20px)\n- Collapsible section groups for related features\n\n**Mobile Navigation**:\n- Top header with hamburger menu\n- Slide-out drawer overlay\n- Logo/brand in header, h-16\n\n### Data Tables\n**Structure**:\n- Full-width responsive tables with horizontal scroll on mobile\n- Sticky header row\n- Alternating row treatment for readability\n- Compact row height (h-12 to h-14)\n- Actions column (right-aligned): view, edit, delete icons\n\n**Features**:\n- Search/filter bar above table (flex justify-between items-center mb-6)\n- Pagination at bottom (center-aligned)\n- Sort indicators on column headers\n- Row selection checkboxes for bulk actions\n- Empty states with illustration placeholder and helper text\n\n### Forms\n**Layout**:\n- Vertical label-above-input pattern\n- Form groups with space-y-6\n- Labels: text-sm font-medium mb-2\n- Input fields: h-10, px-3, rounded border\n- Full-width inputs by default\n- Two-column layouts for related fields: grid grid-cols-1 md:grid-cols-2 gap-6\n\n**Elements**:\n- Text inputs, textareas, select dropdowns (consistent h-10 height)\n- Radio buttons and checkboxes with proper labels\n- Date pickers for allocation/occurrence forms\n- File upload zones with drag-drop visual treatment\n- Required field indicators (asterisk)\n- Validation messages below fields (text-sm, clear error/success states)\n\n**Actions**:\n- Form footer: flex justify-end gap-3\n- Primary button (submit/save): prominent treatment\n- Secondary button (cancel): subdued treatment\n- Both buttons: h-10 px-6 rounded\n\n### Cards\n**Employee/Service Post Cards**:\n- Structured content with clear hierarchy\n- Header section: title + status badge\n- Body: key-value pairs in grid-cols-2\n- Footer: action buttons (view details, edit)\n- Padding: p-6, rounded-lg border\n- Hover state: subtle lift effect (shadow transition)\n\n**Dashboard Stats Cards**:\n- Metric-focused: large number display (text-3xl)\n- Label below (text-sm)\n- Icon in corner (24px)\n- Grid layout: grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\n\n### Buttons & Actions\n**Primary Actions**: Filled button, h-10, px-6, rounded, font-medium\n**Secondary Actions**: Outlined button, same dimensions\n**Tertiary Actions**: Text-only button with underline on hover\n**Icon Buttons**: w-8 h-8, rounded, centered icon (Heroicons 20px)\n**Button Groups**: flex gap-2, used in table rows and forms\n\n### Modals & Overlays\n**Modal Dialog**:\n- Centered overlay with backdrop blur\n- Max-width: max-w-2xl for forms, max-w-md for confirmations\n- Header: p-6, border-bottom\n- Body: p-6, scrollable if needed\n- Footer: p-6, flex justify-end gap-3\n\n**Confirmation Dialogs**:\n- For delete/destructive actions\n- Clear warning message\n- Danger button + cancel button\n\n### Status Indicators\n**Badges**:\n- Rounded-full px-3 py-1 text-xs font-medium\n- Status types: active, inactive, present, absent, justified\n- Employee status: active (positive), inactive (neutral)\n- Allocation status: present (positive), absent (warning), justified (neutral)\n\n**Alerts/Notifications**:\n- Page-level: p-4 rounded border-l-4\n- Toast notifications: fixed bottom-right, slide-in animation (minimal)\n\n### Document Management\n**Upload Zone**:\n- Dashed border area, p-8, rounded-lg\n- Centered icon + text \"Drag and drop or click to upload\"\n- File type/size constraints shown below\n\n**Document List**:\n- Table format with columns: filename, type, upload date, uploader, actions\n- Preview icon opens modal with PDF viewer or image display\n- Download icon for direct file access\n\n### Reports Interface\n**Filter Panel**:\n- Collapsible sidebar or top panel\n- Date range picker, employee selector, post selector\n- Apply/reset buttons at bottom\n\n**Report Display**:\n- Tabs for different report types\n- Export buttons (CSV, HTML/Print) in top-right\n- Tables with proper column widths for readability\n- Subtotals/totals rows with distinct styling (font-semibold, border-t-2)\n\n---\n\n## Animations\n\n**Minimize Motion**:\n- No complex scroll animations\n- Basic transitions only:\n  - Hover states: transition-colors duration-150\n  - Modal entry: fade-in duration-200\n  - Sidebar toggle: transition-transform duration-300\n- Respect prefers-reduced-motion\n\n---\n\n## Images\n\n**No hero images** - this is an application, not a marketing site.\n\n**Functional Images Only**:\n- User avatars: 40px × 40px rounded-full in navigation header\n- Empty state illustrations: Simple SVG graphics (300px max-width) for empty tables/lists\n- Document thumbnails: 80px × 80px preview for uploaded files\n- Logo: Top-left of sidebar, max 180px wide × 48px tall\n\nAll images should be purposeful, not decorative. Focus remains on data and functionality.","path":null,"size_bytes":7040,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 210 5% 98%;\n  --foreground: 210 6% 12%;\n  --border: 210 5% 90%;\n  --card: 210 5% 96%;\n  --card-foreground: 210 6% 12%;\n  --card-border: 210 5% 92%;\n  --sidebar: 210 5% 94%;\n  --sidebar-foreground: 210 6% 12%;\n  --sidebar-border: 210 5% 88%;\n  --sidebar-primary: 210 85% 42%;\n  --sidebar-primary-foreground: 210 85% 98%;\n  --sidebar-accent: 210 8% 88%;\n  --sidebar-accent-foreground: 210 6% 12%;\n  --sidebar-ring: 210 85% 42%;\n  --popover: 210 5% 92%;\n  --popover-foreground: 210 6% 12%;\n  --popover-border: 210 5% 87%;\n  --primary: 210 85% 42%;\n  --primary-foreground: 210 85% 98%;\n  --secondary: 210 8% 86%;\n  --secondary-foreground: 210 6% 12%;\n  --muted: 210 8% 88%;\n  --muted-foreground: 210 6% 35%;\n  --accent: 210 12% 90%;\n  --accent-foreground: 210 6% 12%;\n  --destructive: 0 72% 45%;\n  --destructive-foreground: 0 72% 98%;\n  --input: 210 5% 82%;\n  --ring: 264.79deg 75.16% 68.43%;\n  --chart-1: 264.79deg 75.16% 68.43%;\n  --chart-2: 25 85% 42%;\n  --chart-3: 160 70% 35%;\n  --chart-4: 280 65% 40%;\n  --chart-5: 15 75% 45%;\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 5% 12% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 5% 12% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 1px 2px -1px hsl(210 5% 12% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 1px 2px -1px hsl(210 5% 12% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 2px 4px -1px hsl(210 5% 12% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 4px 6px -1px hsl(210 5% 12% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 5% 12% / 0.00), 0px 8px 10px -1px hsl(210 5% 12% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 5% 12% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 210 6% 8%;\n  --foreground: 210 5% 96%;\n  --border: 210 6% 16%;\n  --card: 210 6% 10%;\n  --card-foreground: 210 5% 96%;\n  --card-border: 210 6% 13%;\n  --sidebar: 210 6% 12%;\n  --sidebar-foreground: 210 5% 96%;\n  --sidebar-border: 210 6% 15%;\n  --sidebar-primary: 210 85% 48%;\n  --sidebar-primary-foreground: 210 85% 98%;\n  --sidebar-accent: 210 10% 16%;\n  --sidebar-accent-foreground: 210 5% 96%;\n  --sidebar-ring: 210 85% 48%;\n  --popover: 210 6% 14%;\n  --popover-foreground: 210 5% 96%;\n  --popover-border: 210 6% 18%;\n  --primary: 210 85% 45%;\n  --primary-foreground: 210 85% 98%;\n  --secondary: 210 10% 18%;\n  --secondary-foreground: 210 5% 96%;\n  --muted: 210 10% 17%;\n  --muted-foreground: 210 5% 65%;\n  --accent: 210 12% 15%;\n  --accent-foreground: 210 5% 96%;\n  --destructive: 0 72% 42%;\n  --destructive-foreground: 0 72% 98%;\n  --input: 210 6% 22%;\n  --ring: 210 85% 48%;\n  --chart-1: 210 85% 65%;\n  --chart-2: 25 85% 68%;\n  --chart-3: 160 70% 62%;\n  --chart-4: 280 65% 70%;\n  --chart-5: 15 75% 65%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(210 6% 8% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(210 6% 8% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 1px 2px -1px hsl(210 6% 8% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 1px 2px -1px hsl(210 6% 8% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 2px 4px -1px hsl(210 6% 8% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 4px 6px -1px hsl(210 6% 8% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(210 6% 8% / 0.00), 0px 8px 10px -1px hsl(210 6% 8% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(210 6% 8% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":11702,"size_tokens":null},"replit.md":{"content":"# Contract Management System\n\n## Overview\n\nThis is an enterprise contract management web application designed for tracking employees, service posts, allocations, and contractual documentation. The system provides role-based access control with admin and viewer roles, comprehensive CRUD operations for core entities, daily allocation tracking, occurrence management, document uploads, and audit logging. Built with a modern full-stack architecture using React, Express, and PostgreSQL.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework**: React 18 with TypeScript\n- **Router**: Wouter for client-side routing\n- **State Management**: TanStack Query (React Query) for server state management\n- **Form Handling**: React Hook Form with Zod validation via @hookform/resolvers\n- **UI Components**: Radix UI primitives with shadcn/ui design system\n- **Styling**: TailwindCSS with custom design tokens following Carbon Design System principles\n- **Theme System**: Context-based theme provider supporting light/dark/system modes\n\n**Design System**:\n- Typography: IBM Plex Sans and IBM Plex Mono font families\n- Color Scheme: Custom HSL-based color variables supporting theme switching\n- Component Library: shadcn/ui components in \"new-york\" style variant\n- Layout: Sidebar navigation with responsive mobile drawer pattern\n\n**Key Frontend Patterns**:\n- Feature-based page organization under `client/src/pages/`\n- Shared UI components in `client/src/components/`\n- Custom hooks for authentication (`useAuth`) and mobile detection\n- Centralized API request handling via query client with credential inclusion\n- Type-safe data fetching using shared schema types from backend\n\n### Backend Architecture\n\n**Framework**: Express.js with TypeScript\n- **Database ORM**: Drizzle ORM for PostgreSQL\n- **Authentication**: Replit Auth (OpenID Connect) with Passport.js\n- **Session Management**: express-session with PostgreSQL session store (connect-pg-simple)\n- **File Uploads**: Multer for multipart form data handling\n- **API Design**: RESTful endpoints under `/api/*` routes\n\n**Database Schema** (`shared/schema.ts`):\n- **Core Entities**: employees, servicePosts, allocations, occurrences, documents\n- **Auth/Audit**: users (with role enum), sessions, auditLogs\n- **Enums**: userRole, employeeStatus, modality, allocationStatus, occurrenceCategory, documentType\n- **Relations**: Defined using Drizzle ORM relations for entity associations\n\n**Storage Layer** (`server/storage.ts`):\n- Abstraction interface (`IStorage`) for all database operations\n- CRUD operations for all entities with search capabilities\n- Audit log creation for tracking system changes\n- Type-safe operations using Drizzle schema types\n\n**Authentication & Authorization**:\n- OAuth/OIDC flow via Replit Auth\n- Role-based access control (admin/viewer roles)\n- Middleware guards: `isAuthenticated`, `isAdmin`\n- Session-based authentication with secure cookie configuration\n\n**File Management**:\n- Upload directory: `uploads/` in project root\n- UUID-based filename generation to prevent collisions\n- 10MB file size limit enforced at middleware level\n- Document metadata stored in database with file path references\n\n### Build & Deployment\n\n**Development**:\n- Vite dev server with HMR for frontend\n- tsx for running TypeScript server in development\n- Middleware mode integration between Express and Vite\n\n**Production Build**:\n- Custom build script (`script/build.ts`) using esbuild and Vite\n- Frontend: Vite builds to `dist/public`\n- Backend: esbuild bundles server to single `dist/index.cjs` file\n- Selective dependency bundling (allowlist pattern) for optimized cold starts\n- Static file serving from built frontend assets\n\n**Configuration Files**:\n- `vite.config.ts`: Frontend build configuration with path aliases\n- `drizzle.config.ts`: Database migration configuration\n- `tsconfig.json`: Shared TypeScript config with path mappings\n- `tailwind.config.ts`: Custom design tokens and theme configuration\n\n### Data Flow Patterns\n\n1. **Query Pattern**: Client requests → TanStack Query → Fetch with credentials → Express route → Storage layer → Drizzle ORM → PostgreSQL\n2. **Mutation Pattern**: Form submission → React Hook Form validation → TanStack Query mutation → API request → Server validation (Zod) → Storage layer → Database → Invalidate cache\n3. **Authentication Flow**: Login redirect → Replit OIDC → Passport strategy → Session creation → User record upsert → Client receives user data\n4. **File Upload Flow**: Form with file input → Multer middleware → File saved to uploads/ → Document record created with path → Frontend receives document metadata\n\n### Error Handling\n\n- Client-side: Centralized error handling in query client with toast notifications\n- Server-side: Express error middleware with JSON error responses\n- Validation: Zod schemas shared between client and server for consistency\n- Unauthorized handling: 401 responses with configurable behavior in query client\n\n### Performance Optimizations\n\n- Query caching via TanStack Query with infinite stale time\n- Selective dependency bundling to reduce syscalls on cold start\n- Static asset caching via Express static middleware\n- Database connection pooling via pg Pool\n- Memoized OIDC configuration fetching\n\n## External Dependencies\n\n### Primary Services\n\n**Database**: PostgreSQL\n- Connection via `DATABASE_URL` environment variable\n- Managed via Drizzle ORM with push-based schema migrations (`db:push` script)\n- Session persistence using pg-specific session store\n\n**Authentication**: Replit Auth (OpenID Connect)\n- Discovery endpoint: `process.env.ISSUER_URL` (defaults to replit.com/oidc)\n- Client ID: `process.env.REPL_ID`\n- Session secret: `process.env.SESSION_SECRET`\n\n### Third-Party Libraries\n\n**UI Components**: Radix UI ecosystem\n- Comprehensive set of accessible, unstyled primitives\n- Used for: dialogs, dropdowns, selects, tooltips, accordions, etc.\n- Styled via Tailwind and shadcn/ui patterns\n\n**Frontend Utilities**:\n- `date-fns`: Date manipulation and formatting\n- `clsx` + `tailwind-merge`: Conditional className composition\n- `class-variance-authority`: Component variant management\n- `cmdk`: Command palette component\n\n**Backend Utilities**:\n- `multer`: File upload handling\n- `express-rate-limit`: API rate limiting (imported but configuration not shown)\n- `nanoid`: Unique ID generation\n- `memoizee`: Function result caching\n\n**Development Tools**:\n- `@replit/vite-plugin-*`: Replit-specific dev tooling (cartographer, dev banner, runtime error modal)\n- `tsx`: TypeScript execution for development server\n- `esbuild`: Production server bundling\n\n### Font Resources\n\n**Google Fonts CDN**:\n- IBM Plex Sans (weights: 400, 500, 600, 700)\n- IBM Plex Mono (weights: 400, 500, 600)\n- Loaded via preconnect + font link tags in `client/index.html`\n\n### API Integrations\n\nNo external third-party APIs are currently integrated beyond Replit Auth. The application is self-contained with all business logic handled server-side.","path":null,"size_bytes":7095,"size_tokens":null},"client/src/pages/lgpd-logs.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Clock, Download, Filter, Search, Shield, Eye } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { formatDateTime } from \"@/lib/authUtils\";\nimport type { User, LgpdLog } from \"@shared/schema\";\n\ntype LgpdLogWithUser = LgpdLog & { user?: User | null };\n\nconst accessTypeLabels: Record<string, string> = {\n  view: \"Visualização\",\n  export: \"Exportação\",\n  search: \"Busca\",\n};\n\nconst dataCategoryLabels: Record<string, string> = {\n  personal_data: \"Dados Pessoais\",\n  sensitive_data: \"Dados Sensíveis\",\n  financial_data: \"Dados Financeiros\",\n};\n\nconst entityTypeLabels: Record<string, string> = {\n  employee: \"Funcionário\",\n  employees_list: \"Lista de Funcionários\",\n  employees_search: \"Busca de Funcionários\",\n};\n\nfunction getAccessTypeBadgeVariant(accessType: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  if (accessType === \"view\") return \"default\";\n  if (accessType === \"export\") return \"destructive\";\n  if (accessType === \"search\") return \"secondary\";\n  return \"outline\";\n}\n\nfunction getDataCategoryBadgeVariant(category: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  if (category === \"personal_data\") return \"default\";\n  if (category === \"sensitive_data\") return \"destructive\";\n  if (category === \"financial_data\") return \"secondary\";\n  return \"outline\";\n}\n\nexport default function LgpdLogsPage() {\n  const { isAdmin } = useAuth();\n  \n  const [filters, setFilters] = useState({\n    userId: \"\",\n    accessType: \"\",\n    dataCategory: \"\",\n    entityType: \"\",\n    startDate: \"\",\n    endDate: \"\",\n  });\n  const [activeFilters, setActiveFilters] = useState(filters);\n  const [limit, setLimit] = useState(\"100\");\n\n  const queryParams = new URLSearchParams();\n  if (activeFilters.userId) queryParams.set(\"userId\", activeFilters.userId);\n  if (activeFilters.accessType) queryParams.set(\"accessType\", activeFilters.accessType);\n  if (activeFilters.dataCategory) queryParams.set(\"dataCategory\", activeFilters.dataCategory);\n  if (activeFilters.entityType) queryParams.set(\"entityType\", activeFilters.entityType);\n  if (activeFilters.startDate) queryParams.set(\"startDate\", activeFilters.startDate);\n  if (activeFilters.endDate) queryParams.set(\"endDate\", activeFilters.endDate);\n  if (limit) queryParams.set(\"limit\", limit);\n\n  const { data: logs, isLoading: logsLoading } = useQuery<LgpdLogWithUser[]>({\n    queryKey: [\"/api/admin/lgpd-logs\", queryParams.toString()],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/lgpd-logs?${queryParams.toString()}`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch LGPD logs\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const { data: users } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n    enabled: isAdmin,\n  });\n\n  const { data: accessTypes } = useQuery<string[]>({\n    queryKey: [\"/api/admin/lgpd-logs/access-types\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/lgpd-logs/access-types\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch access types\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const { data: dataCategories } = useQuery<string[]>({\n    queryKey: [\"/api/admin/lgpd-logs/data-categories\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/lgpd-logs/data-categories\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch data categories\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const { data: entityTypes } = useQuery<string[]>({\n    queryKey: [\"/api/admin/lgpd-logs/entity-types\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/lgpd-logs/entity-types\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch entity types\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const handleApplyFilters = () => {\n    setActiveFilters(filters);\n  };\n\n  const handleClearFilters = () => {\n    const cleared = { userId: \"\", accessType: \"\", dataCategory: \"\", entityType: \"\", startDate: \"\", endDate: \"\" };\n    setFilters(cleared);\n    setActiveFilters(cleared);\n  };\n\n  const handleExportCsv = () => {\n    const exportParams = new URLSearchParams();\n    if (activeFilters.userId) exportParams.set(\"userId\", activeFilters.userId);\n    if (activeFilters.accessType) exportParams.set(\"accessType\", activeFilters.accessType);\n    if (activeFilters.dataCategory) exportParams.set(\"dataCategory\", activeFilters.dataCategory);\n    if (activeFilters.entityType) exportParams.set(\"entityType\", activeFilters.entityType);\n    if (activeFilters.startDate) exportParams.set(\"startDate\", activeFilters.startDate);\n    if (activeFilters.endDate) exportParams.set(\"endDate\", activeFilters.endDate);\n    \n    window.open(`/api/admin/lgpd-logs/export?${exportParams.toString()}`, \"_blank\");\n  };\n\n  if (!isAdmin) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <PageHeader title=\"Logs LGPD\" />\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Shield className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h2 className=\"text-lg font-semibold\">Acesso Negado</h2>\n            <p className=\"text-muted-foreground text-center max-w-md\">\n              Você não tem permissão para acessar esta página.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <PageHeader\n        title=\"Logs LGPD\"\n        description=\"Registro de acessos a dados pessoais conforme Lei Geral de Proteção de Dados\"\n      />\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Filter className=\"h-5 w-5\" />\n            Filtros\n          </CardTitle>\n          <CardDescription>Refine a busca por registros de acesso a dados</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-user\">Usuário</Label>\n              <Select\n                value={filters.userId || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, userId: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-user\" data-testid=\"select-filter-user\">\n                  <SelectValue placeholder=\"Todos os usuários\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todos os usuários</SelectItem>\n                  {users?.map((user) => (\n                    <SelectItem key={user.id} value={user.id}>\n                      {`${user.firstName || \"\"} ${user.lastName || \"\"}`.trim() || user.email || user.id}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-access-type\">Tipo de Acesso</Label>\n              <Select\n                value={filters.accessType || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, accessType: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-access-type\" data-testid=\"select-filter-access-type\">\n                  <SelectValue placeholder=\"Todos os tipos\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todos os tipos</SelectItem>\n                  {accessTypes?.map((type) => (\n                    <SelectItem key={type} value={type}>\n                      {accessTypeLabels[type] || type}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-data-category\">Categoria de Dados</Label>\n              <Select\n                value={filters.dataCategory || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, dataCategory: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-data-category\" data-testid=\"select-filter-data-category\">\n                  <SelectValue placeholder=\"Todas as categorias\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todas as categorias</SelectItem>\n                  {dataCategories?.map((category) => (\n                    <SelectItem key={category} value={category}>\n                      {dataCategoryLabels[category] || category}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-entity\">Tipo de Entidade</Label>\n              <Select\n                value={filters.entityType || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, entityType: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-entity\" data-testid=\"select-filter-entity\">\n                  <SelectValue placeholder=\"Todas as entidades\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todas as entidades</SelectItem>\n                  {entityTypes?.map((type) => (\n                    <SelectItem key={type} value={type}>\n                      {entityTypeLabels[type] || type}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-start-date\">Data Inicial</Label>\n              <Input\n                id=\"filter-start-date\"\n                type=\"date\"\n                value={filters.startDate}\n                onChange={(e) => setFilters({ ...filters, startDate: e.target.value })}\n                data-testid=\"input-filter-start-date\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-end-date\">Data Final</Label>\n              <Input\n                id=\"filter-end-date\"\n                type=\"date\"\n                value={filters.endDate}\n                onChange={(e) => setFilters({ ...filters, endDate: e.target.value })}\n                data-testid=\"input-filter-end-date\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-3 mt-4\">\n            <Button onClick={handleApplyFilters} data-testid=\"button-apply-filters\">\n              <Search className=\"h-4 w-4 mr-2\" />\n              Aplicar Filtros\n            </Button>\n            <Button variant=\"outline\" onClick={handleClearFilters} data-testid=\"button-clear-filters\">\n              Limpar Filtros\n            </Button>\n            <div className=\"flex-1\" />\n            <div className=\"flex items-center gap-2\">\n              <Label htmlFor=\"limit\" className=\"text-sm text-muted-foreground\">Limite:</Label>\n              <Select value={limit} onValueChange={setLimit}>\n                <SelectTrigger id=\"limit\" className=\"w-24\" data-testid=\"select-limit\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"50\">50</SelectItem>\n                  <SelectItem value=\"100\">100</SelectItem>\n                  <SelectItem value=\"250\">250</SelectItem>\n                  <SelectItem value=\"500\">500</SelectItem>\n                  <SelectItem value=\"1000\">1000</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Button variant=\"outline\" onClick={handleExportCsv} data-testid=\"button-export-csv\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Exportar CSV\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Eye className=\"h-5 w-5\" />\n            Registros de Acesso LGPD\n          </CardTitle>\n          <CardDescription>\n            {logs?.length !== undefined ? `${logs.length} registros encontrados` : \"Carregando...\"}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {logsLoading ? (\n            <div className=\"space-y-2\">\n              {Array.from({ length: 10 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : logs?.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Clock className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">Nenhum registro de acesso LGPD encontrado</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Data/Hora</TableHead>\n                    <TableHead>Usuário</TableHead>\n                    <TableHead>Tipo de Acesso</TableHead>\n                    <TableHead>Categoria de Dados</TableHead>\n                    <TableHead>Entidade</TableHead>\n                    <TableHead>ID da Entidade</TableHead>\n                    <TableHead>Endereço IP</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {logs?.map((log) => {\n                    const userName = log.user \n                      ? `${log.user.firstName || \"\"} ${log.user.lastName || \"\"}`.trim() || log.user.email || \"Usuário\"\n                      : \"Sistema\";\n                    \n                    return (\n                      <TableRow key={log.id} data-testid={`row-lgpd-${log.id}`}>\n                        <TableCell className=\"text-sm\" data-testid={`text-timestamp-${log.id}`}>\n                          {log.timestamp ? formatDateTime(log.timestamp) : \"-\"}\n                        </TableCell>\n                        <TableCell className=\"text-sm\" data-testid={`text-user-${log.id}`}>\n                          {userName}\n                        </TableCell>\n                        <TableCell data-testid={`badge-access-type-${log.id}`}>\n                          <Badge variant={getAccessTypeBadgeVariant(log.accessType)}>\n                            {accessTypeLabels[log.accessType] || log.accessType}\n                          </Badge>\n                        </TableCell>\n                        <TableCell data-testid={`badge-data-category-${log.id}`}>\n                          <Badge variant={getDataCategoryBadgeVariant(log.dataCategory)}>\n                            {dataCategoryLabels[log.dataCategory] || log.dataCategory}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-sm\" data-testid={`text-entity-${log.id}`}>\n                          {entityTypeLabels[log.entityType] || log.entityType}\n                        </TableCell>\n                        <TableCell className=\"text-sm font-mono\" data-testid={`text-entityid-${log.id}`}>\n                          {log.entityId || \"-\"}\n                        </TableCell>\n                        <TableCell className=\"text-sm font-mono\" data-testid={`text-ip-${log.id}`}>\n                          {log.ipAddress || \"-\"}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":16593,"size_tokens":null},"scripts/seed-database.ts":{"content":"import { db } from \"../server/db\";\nimport {\n  employees,\n  servicePosts,\n  allocations,\n  occurrences,\n  documents,\n  alerts,\n} from \"../shared/schema\";\nimport { sql } from \"drizzle-orm\";\n\nfunction generateCPF(): string {\n  const random = (max: number) => Math.floor(Math.random() * max);\n  const n = Array(9).fill(0).map(() => random(9));\n  \n  let d1 = n.reduce((acc, val, i) => acc + val * (10 - i), 0) % 11;\n  d1 = d1 < 2 ? 0 : 11 - d1;\n  \n  let d2 = n.reduce((acc, val, i) => acc + val * (11 - i), 0) + d1 * 2;\n  d2 = d2 % 11;\n  d2 = d2 < 2 ? 0 : 11 - d2;\n  \n  return `${n.slice(0, 3).join('')}.${n.slice(3, 6).join('')}.${n.slice(6, 9).join('')}-${d1}${d2}`;\n}\n\nfunction randomDate(start: Date, end: Date): Date {\n  return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));\n}\n\nfunction formatDate(date: Date): string {\n  return date.toISOString().split('T')[0];\n}\n\nasync function seed() {\n  console.log(\"Starting database seed...\\n\");\n\n  // Clear existing data (in reverse order of dependencies)\n  console.log(\"Clearing existing data...\");\n  await db.delete(alerts);\n  await db.delete(documents);\n  await db.delete(occurrences);\n  await db.delete(allocations);\n  await db.delete(employees);\n  await db.delete(servicePosts);\n  console.log(\"Existing data cleared.\\n\");\n\n  // 1. Create Service Posts (8 posts)\n  console.log(\"Creating service posts...\");\n  const servicePostsData = [\n    {\n      postCode: \"SP001\",\n      postName: \"Recepção Principal\",\n      description: \"Posto de atendimento e controle de acesso na entrada principal do edifício\",\n      unit: \"Sede Administrativa\",\n      modality: \"onsite\" as const,\n      tipoPosto: \"Administrativo\",\n      horarioTrabalho: \"08:00 - 18:00\",\n      escalaRegime: \"5x2\",\n      quantidadePrevista: 4,\n    },\n    {\n      postCode: \"SP002\",\n      postName: \"Central de Monitoramento\",\n      description: \"Monitoramento 24h de câmeras e sistemas de segurança\",\n      unit: \"Centro de Operações\",\n      modality: \"onsite\" as const,\n      tipoPosto: \"Operacional\",\n      horarioTrabalho: \"24 horas\",\n      escalaRegime: \"12x36\",\n      quantidadePrevista: 6,\n    },\n    {\n      postCode: \"SP003\",\n      postName: \"Suporte Técnico TI\",\n      description: \"Atendimento e suporte técnico aos usuários internos\",\n      unit: \"Departamento de TI\",\n      modality: \"hybrid\" as const,\n      tipoPosto: \"Técnico\",\n      horarioTrabalho: \"08:00 - 17:00\",\n      escalaRegime: \"5x2\",\n      quantidadePrevista: 3,\n    },\n    {\n      postCode: \"SP004\",\n      postName: \"Manutenção Predial\",\n      description: \"Serviços de manutenção preventiva e corretiva das instalações\",\n      unit: \"Facilities\",\n      modality: \"onsite\" as const,\n      tipoPosto: \"Operacional\",\n      horarioTrabalho: \"07:00 - 16:00\",\n      escalaRegime: \"5x2\",\n      quantidadePrevista: 4,\n    },\n    {\n      postCode: \"SP005\",\n      postName: \"Apoio Administrativo\",\n      description: \"Suporte às atividades administrativas e documentação\",\n      unit: \"Sede Administrativa\",\n      modality: \"hybrid\" as const,\n      tipoPosto: \"Administrativo\",\n      horarioTrabalho: \"08:00 - 17:00\",\n      escalaRegime: \"5x2\",\n      quantidadePrevista: 3,\n    },\n    {\n      postCode: \"SP006\",\n      postName: \"Limpeza e Conservação\",\n      description: \"Serviços de limpeza e conservação das áreas comuns\",\n      unit: \"Facilities\",\n      modality: \"onsite\" as const,\n      tipoPosto: \"Operacional\",\n      horarioTrabalho: \"06:00 - 15:00\",\n      escalaRegime: \"5x2\",\n      quantidadePrevista: 5,\n    },\n    {\n      postCode: \"SP007\",\n      postName: \"Coordenação de Contratos\",\n      description: \"Gestão e acompanhamento de contratos de serviços\",\n      unit: \"Departamento Jurídico\",\n      modality: \"remote\" as const,\n      tipoPosto: \"Supervisão\",\n      horarioTrabalho: \"09:00 - 18:00\",\n      escalaRegime: \"5x2\",\n      quantidadePrevista: 2,\n    },\n    {\n      postCode: \"SP008\",\n      postName: \"Plantão Noturno\",\n      description: \"Cobertura de operações essenciais no período noturno\",\n      unit: \"Centro de Operações\",\n      modality: \"onsite\" as const,\n      tipoPosto: \"Operacional\",\n      horarioTrabalho: \"18:00 - 06:00\",\n      escalaRegime: \"12x36\",\n      quantidadePrevista: 4,\n    },\n  ];\n\n  const insertedPosts = await db.insert(servicePosts).values(servicePostsData).returning();\n  console.log(`Created ${insertedPosts.length} service posts.\\n`);\n\n  // 2. Create Employees (25 employees)\n  console.log(\"Creating employees...\");\n  const employeeNames = [\n    { name: \"Carlos Alberto Silva\", function: \"Supervisor de Segurança\", unit: \"Centro de Operações\" },\n    { name: \"Maria Fernanda Costa\", function: \"Recepcionista\", unit: \"Sede Administrativa\" },\n    { name: \"João Pedro Santos\", function: \"Técnico de TI\", unit: \"Departamento de TI\" },\n    { name: \"Ana Paula Oliveira\", function: \"Auxiliar Administrativo\", unit: \"Sede Administrativa\" },\n    { name: \"Roberto Carlos Lima\", function: \"Operador de Monitoramento\", unit: \"Centro de Operações\" },\n    { name: \"Fernanda Souza Martins\", function: \"Coordenadora de Contratos\", unit: \"Departamento Jurídico\" },\n    { name: \"Paulo Ricardo Ferreira\", function: \"Técnico de Manutenção\", unit: \"Facilities\" },\n    { name: \"Juliana Almeida Rocha\", function: \"Recepcionista\", unit: \"Sede Administrativa\" },\n    { name: \"Marcos Antônio Ribeiro\", function: \"Operador de Monitoramento\", unit: \"Centro de Operações\" },\n    { name: \"Patrícia Helena Dias\", function: \"Assistente Administrativa\", unit: \"Sede Administrativa\" },\n    { name: \"Fernando José Carvalho\", function: \"Técnico de TI\", unit: \"Departamento de TI\" },\n    { name: \"Luciana Maria Pereira\", function: \"Auxiliar de Limpeza\", unit: \"Facilities\" },\n    { name: \"Ricardo Augusto Mendes\", function: \"Plantonista\", unit: \"Centro de Operações\" },\n    { name: \"Camila Beatriz Torres\", function: \"Auxiliar Administrativo\", unit: \"Sede Administrativa\" },\n    { name: \"André Luis Campos\", function: \"Técnico de Manutenção\", unit: \"Facilities\" },\n    { name: \"Beatriz Helena Nunes\", function: \"Supervisora Administrativa\", unit: \"Sede Administrativa\" },\n    { name: \"Gustavo Henrique Araújo\", function: \"Operador de Monitoramento\", unit: \"Centro de Operações\" },\n    { name: \"Renata Cristina Barbosa\", function: \"Auxiliar de Limpeza\", unit: \"Facilities\" },\n    { name: \"Diego Fernando Moreira\", function: \"Plantonista\", unit: \"Centro de Operações\" },\n    { name: \"Amanda Caroline Pinto\", function: \"Recepcionista\", unit: \"Sede Administrativa\" },\n    { name: \"Thiago Rafael Correia\", function: \"Técnico de TI\", unit: \"Departamento de TI\" },\n    { name: \"Vanessa Cristina Gomes\", function: \"Auxiliar de Limpeza\", unit: \"Facilities\" },\n    { name: \"Eduardo Santos Vieira\", function: \"Técnico de Manutenção\", unit: \"Facilities\" },\n    { name: \"Isabela Maria Freitas\", function: \"Assistente de Contratos\", unit: \"Departamento Jurídico\" },\n    { name: \"Leonardo Costa Machado\", function: \"Plantonista\", unit: \"Centro de Operações\" },\n  ];\n\n  const employeesData = employeeNames.map((emp, index) => ({\n    name: emp.name,\n    cpf: generateCPF(),\n    functionPost: emp.function,\n    unit: emp.unit,\n    status: index < 23 ? \"active\" as const : \"inactive\" as const,\n  }));\n\n  const insertedEmployees = await db.insert(employees).values(employeesData).returning();\n  console.log(`Created ${insertedEmployees.length} employees.\\n`);\n\n  // Create employee-to-post assignments (for allocation generation)\n  const employeePostAssignments: { employeeId: number; postId: number }[] = [];\n  \n  // Assign employees to posts based on their functions\n  insertedEmployees.forEach((emp, idx) => {\n    const empData = employeeNames[idx];\n    let postId: number;\n    \n    if (empData.function.includes(\"Recepcionista\")) {\n      postId = insertedPosts[0].id; // SP001 - Recepção\n    } else if (empData.function.includes(\"Monitoramento\") || empData.function.includes(\"Supervisor de Segurança\")) {\n      postId = insertedPosts[1].id; // SP002 - Monitoramento\n    } else if (empData.function.includes(\"TI\")) {\n      postId = insertedPosts[2].id; // SP003 - Suporte TI\n    } else if (empData.function.includes(\"Manutenção\")) {\n      postId = insertedPosts[3].id; // SP004 - Manutenção\n    } else if (empData.function.includes(\"Administrativo\") || empData.function.includes(\"Assistente\")) {\n      postId = insertedPosts[4].id; // SP005 - Apoio Administrativo\n    } else if (empData.function.includes(\"Limpeza\")) {\n      postId = insertedPosts[5].id; // SP006 - Limpeza\n    } else if (empData.function.includes(\"Contrato\") || empData.function.includes(\"Coordenador\")) {\n      postId = insertedPosts[6].id; // SP007 - Coordenação\n    } else if (empData.function.includes(\"Plantonista\")) {\n      postId = insertedPosts[7].id; // SP008 - Plantão Noturno\n    } else {\n      postId = insertedPosts[4].id; // Default to Apoio Administrativo\n    }\n    \n    if (emp.status === \"active\") {\n      employeePostAssignments.push({ employeeId: emp.id, postId });\n    }\n  });\n\n  // 3. Create Daily Allocations (90 days)\n  console.log(\"Creating daily allocations (90 days)...\");\n  const today = new Date();\n  const allocationsData: {\n    employeeId: number;\n    postId: number;\n    date: string;\n    status: \"present\" | \"absent\" | \"justified\" | \"vacation\" | \"medical_leave\";\n    notes: string | null;\n  }[] = [];\n\n  // Status distribution: 85% Present, 8% Absent, 4% Justified, 2% Vacation, 1% Medical Leave\n  const statusWeights = [\n    { status: \"present\" as const, weight: 85 },\n    { status: \"absent\" as const, weight: 8 },\n    { status: \"justified\" as const, weight: 4 },\n    { status: \"vacation\" as const, weight: 2 },\n    { status: \"medical_leave\" as const, weight: 1 },\n  ];\n\n  function getRandomStatus(): \"present\" | \"absent\" | \"justified\" | \"vacation\" | \"medical_leave\" {\n    const rand = Math.random() * 100;\n    let cumulative = 0;\n    for (const sw of statusWeights) {\n      cumulative += sw.weight;\n      if (rand < cumulative) return sw.status;\n    }\n    return \"present\";\n  }\n\n  const statusNotes: Record<string, string[]> = {\n    present: [\"\", \"\", \"\", \"Chegou no horário\", \"\"],\n    absent: [\"Falta não justificada\", \"Não compareceu\", \"Ausência sem aviso\"],\n    justified: [\"Atestado médico apresentado\", \"Consulta médica agendada\", \"Compromisso pessoal autorizado\"],\n    vacation: [\"Período de férias regulares\", \"Férias programadas\"],\n    medical_leave: [\"Licença médica - CID informado\", \"Afastamento por recomendação médica\"],\n  };\n\n  for (let day = 0; day < 90; day++) {\n    const date = new Date(today);\n    date.setDate(date.getDate() - day);\n    const dateStr = formatDate(date);\n    \n    // Skip some days randomly to simulate missing allocations (about 5% of records)\n    for (const assignment of employeePostAssignments) {\n      if (Math.random() > 0.05) { // 95% chance of creating allocation\n        const status = getRandomStatus();\n        const notesArray = statusNotes[status];\n        const note = notesArray[Math.floor(Math.random() * notesArray.length)] || null;\n        \n        allocationsData.push({\n          employeeId: assignment.employeeId,\n          postId: assignment.postId,\n          date: dateStr,\n          status,\n          notes: note,\n        });\n      }\n    }\n  }\n\n  // Insert allocations in batches\n  const batchSize = 500;\n  let insertedAllocationsCount = 0;\n  for (let i = 0; i < allocationsData.length; i += batchSize) {\n    const batch = allocationsData.slice(i, i + batchSize);\n    await db.insert(allocations).values(batch);\n    insertedAllocationsCount += batch.length;\n  }\n  console.log(`Created ${insertedAllocationsCount} allocation records.\\n`);\n\n  // 4. Create Occurrences (40 occurrences)\n  console.log(\"Creating occurrences...\");\n  const occurrenceDescriptions = {\n    absence: [\n      \"Funcionário não compareceu ao posto sem aviso prévio\",\n      \"Falta não justificada registrada\",\n      \"Ausência durante o turno sem comunicação\",\n      \"Abandono de posto por período superior a 2 horas\",\n      \"Não comparecimento ao trabalho\",\n    ],\n    substitution: [\n      \"Substituição temporária realizada por outro colaborador\",\n      \"Remanejamento de funcionário para cobrir posto\",\n      \"Troca de turno autorizada entre funcionários\",\n      \"Cobertura emergencial de posto\",\n      \"Substituição durante período de férias\",\n    ],\n    issue: [\n      \"Problema técnico com equipamento de monitoramento\",\n      \"Falha no sistema de controle de acesso\",\n      \"Ocorrência de manutenção não programada\",\n      \"Incidente de segurança registrado\",\n      \"Problema com ar condicionado na área\",\n      \"Vazamento identificado no andar\",\n      \"Elevador apresentou defeito\",\n    ],\n    note: [\n      \"Visita de fiscalização realizada sem pendências\",\n      \"Treinamento de reciclagem agendado\",\n      \"Reunião de alinhamento com equipe\",\n      \"Atualização de procedimentos operacionais\",\n      \"Feedback positivo recebido do cliente\",\n      \"Observação sobre melhoria de processo\",\n    ],\n  };\n\n  const occurrencesData: {\n    date: string;\n    employeeId: number | null;\n    description: string;\n    category: \"absence\" | \"substitution\" | \"issue\" | \"note\";\n    treated: boolean;\n  }[] = [];\n\n  const categories: (\"absence\" | \"substitution\" | \"issue\" | \"note\")[] = [\"absence\", \"substitution\", \"issue\", \"note\"];\n  const categoryWeights = [35, 25, 25, 15]; // Distribution percentages\n\n  for (let i = 0; i < 40; i++) {\n    const rand = Math.random() * 100;\n    let cumulative = 0;\n    let category: \"absence\" | \"substitution\" | \"issue\" | \"note\" = \"note\";\n    for (let j = 0; j < categories.length; j++) {\n      cumulative += categoryWeights[j];\n      if (rand < cumulative) {\n        category = categories[j];\n        break;\n      }\n    }\n\n    const descriptions = occurrenceDescriptions[category];\n    const description = descriptions[Math.floor(Math.random() * descriptions.length)];\n    \n    const daysAgo = Math.floor(Math.random() * 60);\n    const occurrenceDate = new Date(today);\n    occurrenceDate.setDate(occurrenceDate.getDate() - daysAgo);\n\n    // Some occurrences linked to employees, some not\n    const linkToEmployee = Math.random() > 0.3;\n    const activeEmployees = insertedEmployees.filter(e => e.status === \"active\");\n    const employeeId = linkToEmployee \n      ? activeEmployees[Math.floor(Math.random() * activeEmployees.length)].id \n      : null;\n\n    // About 60% treated, 40% untreated\n    const treated = Math.random() > 0.4;\n\n    occurrencesData.push({\n      date: formatDate(occurrenceDate),\n      employeeId,\n      description,\n      category,\n      treated,\n    });\n  }\n\n  const insertedOccurrences = await db.insert(occurrences).values(occurrencesData).returning();\n  console.log(`Created ${insertedOccurrences.length} occurrences.\\n`);\n\n  // 5. Create Documents (50 documents)\n  console.log(\"Creating documents...\");\n  const documentCategories: (\"atestados\" | \"comprovantes\" | \"relatorios_mensais\" | \"evidencias_posto\" | \"treinamentos\" | \"certidoes\" | \"outros\")[] = [\n    \"atestados\", \"comprovantes\", \"relatorios_mensais\", \"evidencias_posto\", \"treinamentos\", \"certidoes\", \"outros\"\n  ];\n\n  const documentNames: Record<string, string[]> = {\n    atestados: [\n      \"Atestado Médico\", \"Atestado de Comparecimento\", \"Atestado Odontológico\",\n      \"Declaração Médica\", \"Laudo Médico\"\n    ],\n    comprovantes: [\n      \"Comprovante de Residência\", \"Comprovante de Escolaridade\", \"Comprovante Bancário\",\n      \"Comprovante de Curso\", \"Comprovante de Vacinação\"\n    ],\n    relatorios_mensais: [\n      \"Relatório Mensal de Operações\", \"Relatório de Frequência\", \"Relatório de Incidentes\",\n      \"Resumo Mensal de Atividades\", \"Relatório de Performance\"\n    ],\n    evidencias_posto: [\n      \"Foto do Posto\", \"Registro de Equipamentos\", \"Checklist de Verificação\",\n      \"Evidência de Limpeza\", \"Registro Fotográfico\"\n    ],\n    treinamentos: [\n      \"Certificado NR-35\", \"Certificado NR-10\", \"Treinamento de Segurança\",\n      \"Capacitação Brigada\", \"Certificado Primeiros Socorros\"\n    ],\n    certidoes: [\n      \"Certidão Negativa de Débitos\", \"Certidão de Regularidade FGTS\",\n      \"Certidão Trabalhista\", \"Certidão de Antecedentes\"\n    ],\n    outros: [\n      \"Documento Diverso\", \"Anexo Contratual\", \"Comunicado Interno\",\n      \"Termo de Responsabilidade\", \"Autorização\"\n    ],\n  };\n\n  const documentsData: {\n    filename: string;\n    originalName: string;\n    mimeType: string;\n    size: number;\n    path: string;\n    documentType: \"aso\" | \"certification\" | \"evidence\" | \"contract\" | \"other\";\n    category: \"atestados\" | \"comprovantes\" | \"relatorios_mensais\" | \"evidencias_posto\" | \"treinamentos\" | \"certidoes\" | \"outros\";\n    employeeId: number | null;\n    postId: number | null;\n    monthYear: string;\n    expirationDate: string | null;\n    observations: string | null;\n  }[] = [];\n\n  const docTypeMapping: Record<string, \"aso\" | \"certification\" | \"evidence\" | \"contract\" | \"other\"> = {\n    atestados: \"aso\",\n    comprovantes: \"other\",\n    relatorios_mensais: \"other\",\n    evidencias_posto: \"evidence\",\n    treinamentos: \"certification\",\n    certidoes: \"certification\",\n    outros: \"other\",\n  };\n\n  for (let i = 0; i < 50; i++) {\n    const category = documentCategories[Math.floor(Math.random() * documentCategories.length)];\n    const names = documentNames[category];\n    const docName = names[Math.floor(Math.random() * names.length)];\n    \n    const uploadDate = randomDate(new Date(today.getTime() - 180 * 24 * 60 * 60 * 1000), today);\n    const monthYear = `${uploadDate.getFullYear()}-${String(uploadDate.getMonth() + 1).padStart(2, '0')}`;\n    \n    // Generate expiration date - some expired, some expiring soon, some far future\n    let expirationDate: string | null = null;\n    if ([\"treinamentos\", \"certidoes\", \"atestados\"].includes(category)) {\n      const expirationRandom = Math.random();\n      const expDate = new Date(today);\n      if (expirationRandom < 0.15) {\n        // 15% expired\n        expDate.setDate(expDate.getDate() - Math.floor(Math.random() * 30 + 1));\n      } else if (expirationRandom < 0.35) {\n        // 20% expiring in 30 days\n        expDate.setDate(expDate.getDate() + Math.floor(Math.random() * 30 + 1));\n      } else {\n        // 65% valid for longer\n        expDate.setDate(expDate.getDate() + Math.floor(Math.random() * 365 + 31));\n      }\n      expirationDate = formatDate(expDate);\n    }\n\n    // Link to employee or post\n    const linkType = Math.random();\n    let employeeId: number | null = null;\n    let postId: number | null = null;\n    \n    if (linkType < 0.6) {\n      // 60% linked to employee\n      employeeId = insertedEmployees[Math.floor(Math.random() * insertedEmployees.length)].id;\n    } else if (linkType < 0.85) {\n      // 25% linked to post\n      postId = insertedPosts[Math.floor(Math.random() * insertedPosts.length)].id;\n    }\n    // 15% not linked to either\n\n    const uuid = crypto.randomUUID();\n    const extension = Math.random() > 0.3 ? \"pdf\" : \"jpg\";\n    \n    documentsData.push({\n      filename: `${uuid}.${extension}`,\n      originalName: `${docName.replace(/\\s+/g, '_')}_${i + 1}.${extension}`,\n      mimeType: extension === \"pdf\" ? \"application/pdf\" : \"image/jpeg\",\n      size: Math.floor(Math.random() * 5000000 + 100000), // 100KB to 5MB\n      path: `uploads/${uuid}.${extension}`,\n      documentType: docTypeMapping[category],\n      category,\n      employeeId,\n      postId,\n      monthYear,\n      expirationDate,\n      observations: Math.random() > 0.7 ? `Documento referente a ${docName.toLowerCase()}` : null,\n    });\n  }\n\n  const insertedDocuments = await db.insert(documents).values(documentsData).returning();\n  console.log(`Created ${insertedDocuments.length} documents.\\n`);\n\n  // 6. Create Alerts (auto-generated pending items)\n  console.log(\"Creating alerts...\");\n  const alertsData: {\n    type: \"unallocated_employee\" | \"expired_document\" | \"untreated_occurrence\";\n    status: \"pending\" | \"resolved\";\n    message: string;\n    entityType: string;\n    entityId: number;\n  }[] = [];\n\n  // Alerts for expired documents\n  const expiredDocs = insertedDocuments.filter(doc => {\n    if (!doc.expirationDate) return false;\n    return new Date(doc.expirationDate) < today;\n  });\n  \n  for (const doc of expiredDocs) {\n    alertsData.push({\n      type: \"expired_document\",\n      status: \"pending\",\n      message: `Documento \"${doc.originalName}\" expirou em ${doc.expirationDate}`,\n      entityType: \"document\",\n      entityId: doc.id,\n    });\n  }\n\n  // Alerts for documents expiring in 30 days\n  const expiringDocs = insertedDocuments.filter(doc => {\n    if (!doc.expirationDate) return false;\n    const expDate = new Date(doc.expirationDate);\n    const thirtyDaysFromNow = new Date(today);\n    thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\n    return expDate >= today && expDate <= thirtyDaysFromNow;\n  });\n\n  for (const doc of expiringDocs) {\n    alertsData.push({\n      type: \"expired_document\",\n      status: \"pending\",\n      message: `Documento \"${doc.originalName}\" expira em ${doc.expirationDate}`,\n      entityType: \"document\",\n      entityId: doc.id,\n    });\n  }\n\n  // Alerts for untreated occurrences\n  const untreatedOccurrences = insertedOccurrences.filter(occ => !occ.treated);\n  for (const occ of untreatedOccurrences) {\n    alertsData.push({\n      type: \"untreated_occurrence\",\n      status: \"pending\",\n      message: `Ocorrência não tratada: ${occ.description.substring(0, 50)}...`,\n      entityType: \"occurrence\",\n      entityId: occ.id,\n    });\n  }\n\n  // Find employees without recent allocations (unallocated)\n  const recentDate = new Date(today);\n  recentDate.setDate(recentDate.getDate() - 7);\n  const recentDateStr = formatDate(recentDate);\n  \n  const activeEmployeeIds = insertedEmployees\n    .filter(e => e.status === \"active\")\n    .map(e => e.id);\n  \n  const employeesWithRecentAllocations = new Set(\n    allocationsData\n      .filter(a => a.date >= recentDateStr)\n      .map(a => a.employeeId)\n  );\n\n  const unallocatedEmployees = activeEmployeeIds.filter(id => !employeesWithRecentAllocations.has(id));\n  \n  for (const empId of unallocatedEmployees.slice(0, 3)) { // Limit to 3 alerts\n    const emp = insertedEmployees.find(e => e.id === empId);\n    if (emp) {\n      alertsData.push({\n        type: \"unallocated_employee\",\n        status: \"pending\",\n        message: `Funcionário \"${emp.name}\" sem alocação nos últimos 7 dias`,\n        entityType: \"employee\",\n        entityId: emp.id,\n      });\n    }\n  }\n\n  let insertedAlertsCount = 0;\n  if (alertsData.length > 0) {\n    const insertedAlerts = await db.insert(alerts).values(alertsData).returning();\n    insertedAlertsCount = insertedAlerts.length;\n  }\n  console.log(`Created ${insertedAlertsCount} alerts.\\n`);\n\n  // Summary\n  console.log(\"=\" .repeat(50));\n  console.log(\"DATABASE SEED COMPLETED SUCCESSFULLY!\");\n  console.log(\"=\" .repeat(50));\n  console.log(\"\\nSummary of inserted records:\");\n  console.log(`  - Service Posts:  ${insertedPosts.length}`);\n  console.log(`  - Employees:      ${insertedEmployees.length}`);\n  console.log(`  - Allocations:    ${insertedAllocationsCount}`);\n  console.log(`  - Occurrences:    ${insertedOccurrences.length}`);\n  console.log(`  - Documents:      ${insertedDocuments.length}`);\n  console.log(`  - Alerts:         ${insertedAlertsCount}`);\n  console.log(\"\\nTo re-run this seed, execute: npx tsx scripts/seed-database.ts\");\n  console.log(\"\\nDashboards should now display populated data!\");\n}\n\nseed()\n  .then(() => process.exit(0))\n  .catch((err) => {\n    console.error(\"Seed failed:\", err);\n    process.exit(1);\n  });\n","path":null,"size_bytes":23664,"size_tokens":null},"client/src/pages/notifications/index.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Bell, Mail, Plus, Trash2, Send, CheckCircle, XCircle, AlertTriangle, Info } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport type { NotificationSettings } from \"@shared/schema\";\n\ninterface NotificationStatus {\n  emailServiceConfigured: boolean;\n  smtpConfigured: boolean;\n}\n\nexport default function NotificationsPage() {\n  const { isAdmin, isLoading: authLoading } = useAuth();\n  const { toast } = useToast();\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  const [newEmail, setNewEmail] = useState(\"\");\n  const [testEmail, setTestEmail] = useState(\"\");\n\n  const { data: settings, isLoading: settingsLoading } = useQuery<NotificationSettings[]>({\n    queryKey: [\"/api/notification-settings\"],\n    enabled: isAdmin === true,\n  });\n\n  const { data: status, isLoading: statusLoading } = useQuery<NotificationStatus>({\n    queryKey: [\"/api/notifications/status\"],\n    enabled: isAdmin === true,\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (email: string) => {\n      await apiRequest(\"POST\", \"/api/notification-settings\", { email });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notification-settings\"] });\n      toast({ title: translations.common.success, description: translations.notifications.recipientAdded });\n      setAddDialogOpen(false);\n      setNewEmail(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: translations.common.error,\n        description: error?.message || translations.notifications.addRecipientFailed,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, ...data }: { id: number } & Partial<NotificationSettings>) => {\n      await apiRequest(\"PATCH\", `/api/notification-settings/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notification-settings\"] });\n      toast({ title: translations.common.success, description: translations.notifications.settingsSaved });\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.saveError, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/notification-settings/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notification-settings\"] });\n      toast({ title: translations.common.success, description: translations.notifications.recipientRemoved });\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.errors.deleteError, variant: \"destructive\" });\n    },\n  });\n\n  const testEmailMutation = useMutation({\n    mutationFn: async (email: string) => {\n      await apiRequest(\"POST\", \"/api/notifications/test\", { email });\n    },\n    onSuccess: () => {\n      toast({ title: translations.common.success, description: translations.notifications.emailSent });\n      setTestEmail(\"\");\n    },\n    onError: (error: any) => {\n      toast({\n        title: translations.common.error,\n        description: error?.message || translations.notifications.testEmailFailed,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const sendDocExpirationMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/notifications/send-document-expiration\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: translations.common.success,\n        description: translations.notifications.documentExpirationSent.replace(\"{count}\", String(data.sentCount || 0)),\n      });\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.notifications.documentExpirationFailed, variant: \"destructive\" });\n    },\n  });\n\n  const sendDailySummaryMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", \"/api/notifications/send-daily-summary\");\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: translations.common.success,\n        description: translations.notifications.dailySummarySent.replace(\"{count}\", String(data.sentCount || 0)),\n      });\n    },\n    onError: () => {\n      toast({ title: translations.common.error, description: translations.notifications.dailySummaryFailed, variant: \"destructive\" });\n    },\n  });\n\n  if (authLoading) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <PageHeader title={translations.notifications.title} />\n        <Card>\n          <CardContent className=\"py-12\">\n            <Skeleton className=\"h-32 w-full\" />\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (!isAdmin) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <PageHeader title={translations.notifications.title} />\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Bell className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h2 className=\"text-lg font-semibold\">{translations.auth.accessDenied}</h2>\n            <p className=\"text-muted-foreground text-center max-w-md\">\n              {translations.auth.permissionRequired}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const emailServiceConfigured = status?.emailServiceConfigured === true;\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <PageHeader\n        title={translations.notifications.title}\n        description={translations.notifications.description}\n      >\n        {isAdmin && emailServiceConfigured && (\n          <Dialog open={addDialogOpen} onOpenChange={setAddDialogOpen}>\n            <DialogTrigger asChild>\n              <Button data-testid=\"button-add-recipient\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Adicionar Destinatário\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Adicionar Destinatário de Notificação</DialogTitle>\n                <DialogDescription>\n                  Adicione um endereço de email para receber notificações do sistema\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">{translations.notifications.emailAddress}</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"destinatario@exemplo.com\"\n                    value={newEmail}\n                    onChange={(e) => setNewEmail(e.target.value)}\n                    data-testid=\"input-new-email\"\n                  />\n                </div>\n              </div>\n              <DialogFooter>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setAddDialogOpen(false)}\n                  data-testid=\"button-cancel-add\"\n                >\n                  {translations.common.cancel}\n                </Button>\n                <Button\n                  onClick={() => createMutation.mutate(newEmail)}\n                  disabled={!newEmail || createMutation.isPending}\n                  data-testid=\"button-confirm-add\"\n                >\n                  Adicionar Destinatário\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        )}\n      </PageHeader>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Mail className=\"h-5 w-5\" />\n            Status do Serviço de Email\n          </CardTitle>\n          <CardDescription>Status da configuração do serviço de email</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {statusLoading ? (\n            <Skeleton className=\"h-16 w-full\" />\n          ) : (\n            <div className=\"flex items-center gap-4 p-4 rounded-md border\">\n              {emailServiceConfigured ? (\n                <>\n                  <CheckCircle className=\"h-6 w-6 text-green-600\" />\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium text-green-700 dark:text-green-400\">Serviço de Email Configurado</p>\n                    <p className=\"text-sm text-muted-foreground\">Conexão SMTP pronta para enviar emails</p>\n                  </div>\n                </>\n              ) : (\n                <>\n                  <XCircle className=\"h-6 w-6 text-amber-600\" />\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium text-amber-700 dark:text-amber-400\">Serviço de Email Não Configurado</p>\n                    <p className=\"text-sm text-muted-foreground\">Credenciais SMTP ausentes ou inválidas</p>\n                  </div>\n                </>\n              )}\n            </div>\n          )}\n\n          {!emailServiceConfigured && (\n            <div className=\"mt-4 p-4 rounded-md border border-amber-200 bg-amber-50 dark:bg-amber-950 dark:border-amber-800\">\n              <div className=\"flex gap-3\">\n                <AlertTriangle className=\"h-5 w-5 text-amber-600 shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"font-medium text-amber-800 dark:text-amber-200\">Configuração SMTP Necessária</p>\n                  <p className=\"text-sm text-amber-700 dark:text-amber-300 mt-1\">\n                    Para habilitar notificações por email, configure as seguintes variáveis de ambiente:\n                  </p>\n                  <ul className=\"mt-2 text-sm text-amber-700 dark:text-amber-300 list-disc list-inside space-y-1\">\n                    <li>SMTP_HOST - Hostname do servidor SMTP</li>\n                    <li>SMTP_PORT - Porta do servidor SMTP (geralmente 587 ou 465)</li>\n                    <li>SMTP_USER - Usuário de autenticação SMTP</li>\n                    <li>SMTP_PASS - Senha de autenticação SMTP</li>\n                    <li>SMTP_FROM (opcional) - Endereço de email do remetente</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {emailServiceConfigured && (\n        <>\n          <div className=\"grid gap-6 lg:grid-cols-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Send className=\"h-5 w-5\" />\n                  {translations.notifications.testEmail}\n                </CardTitle>\n                <CardDescription>Teste a configuração de email enviando um email de teste</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"test-email\">{translations.notifications.emailAddress}</Label>\n                    <Input\n                      id=\"test-email\"\n                      type=\"email\"\n                      placeholder=\"teste@exemplo.com\"\n                      value={testEmail}\n                      onChange={(e) => setTestEmail(e.target.value)}\n                      data-testid=\"input-test-email\"\n                    />\n                  </div>\n                  <Button\n                    onClick={() => testEmailMutation.mutate(testEmail)}\n                    disabled={!testEmail || testEmailMutation.isPending}\n                    data-testid=\"button-send-test\"\n                  >\n                    <Send className=\"h-4 w-4 mr-2\" />\n                    Enviar Email de Teste\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Bell className=\"h-5 w-5\" />\n                  Notificações Manuais\n                </CardTitle>\n                <CardDescription>Disparar emails de notificação manualmente</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start\"\n                    onClick={() => sendDocExpirationMutation.mutate()}\n                    disabled={sendDocExpirationMutation.isPending}\n                    data-testid=\"button-send-doc-expiration\"\n                  >\n                    <AlertTriangle className=\"h-4 w-4 mr-2\" />\n                    Enviar Alertas de Vencimento de Documentos\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start\"\n                    onClick={() => sendDailySummaryMutation.mutate()}\n                    disabled={sendDailySummaryMutation.isPending}\n                    data-testid=\"button-send-daily-summary\"\n                  >\n                    <Info className=\"h-4 w-4 mr-2\" />\n                    Enviar Resumo Diário\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Mail className=\"h-5 w-5\" />\n                Destinatários de Notificação\n              </CardTitle>\n              <CardDescription>Gerencie quem recebe notificações por email e quais tipos</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {settingsLoading ? (\n                <div className=\"space-y-2\">\n                  {Array.from({ length: 3 }).map((_, i) => (\n                    <Skeleton key={i} className=\"h-16 w-full\" />\n                  ))}\n                </div>\n              ) : settings?.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center py-12\">\n                  <Mail className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground\">{translations.notifications.noPendingNotifications}</p>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Clique em \"Adicionar Destinatário\" para adicionar um endereço de email\n                  </p>\n                </div>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Email</TableHead>\n                        <TableHead className=\"text-center\">{translations.notifications.isActive}</TableHead>\n                        <TableHead className=\"text-center\">{translations.notifications.notifyNewOccurrences}</TableHead>\n                        <TableHead className=\"text-center\">{translations.notifications.notifyMissingAllocations}</TableHead>\n                        <TableHead className=\"text-center\">{translations.notifications.notifyDocumentExpiration}</TableHead>\n                        <TableHead className=\"text-center\">{translations.notifications.notifyDailySummary}</TableHead>\n                        <TableHead className=\"w-[80px]\">{translations.common.actions}</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {settings?.map((setting) => (\n                        <TableRow key={setting.id} data-testid={`row-notification-${setting.id}`}>\n                          <TableCell className=\"font-medium\">{setting.email}</TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch\n                              checked={setting.isActive}\n                              onCheckedChange={(checked) =>\n                                updateMutation.mutate({ id: setting.id, isActive: checked })\n                              }\n                              disabled={updateMutation.isPending}\n                              data-testid={`switch-active-${setting.id}`}\n                            />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch\n                              checked={setting.notifyNewOccurrences}\n                              onCheckedChange={(checked) =>\n                                updateMutation.mutate({ id: setting.id, notifyNewOccurrences: checked })\n                              }\n                              disabled={updateMutation.isPending || !setting.isActive}\n                              data-testid={`switch-occurrences-${setting.id}`}\n                            />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch\n                              checked={setting.notifyMissingAllocations}\n                              onCheckedChange={(checked) =>\n                                updateMutation.mutate({ id: setting.id, notifyMissingAllocations: checked })\n                              }\n                              disabled={updateMutation.isPending || !setting.isActive}\n                              data-testid={`switch-allocations-${setting.id}`}\n                            />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch\n                              checked={setting.notifyDocumentExpiration}\n                              onCheckedChange={(checked) =>\n                                updateMutation.mutate({ id: setting.id, notifyDocumentExpiration: checked })\n                              }\n                              disabled={updateMutation.isPending || !setting.isActive}\n                              data-testid={`switch-doc-expiration-${setting.id}`}\n                            />\n                          </TableCell>\n                          <TableCell className=\"text-center\">\n                            <Switch\n                              checked={setting.notifyDailySummary}\n                              onCheckedChange={(checked) =>\n                                updateMutation.mutate({ id: setting.id, notifyDailySummary: checked })\n                              }\n                              disabled={updateMutation.isPending || !setting.isActive}\n                              data-testid={`switch-daily-summary-${setting.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <AlertDialog>\n                              <AlertDialogTrigger asChild>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  data-testid={`button-delete-${setting.id}`}\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              </AlertDialogTrigger>\n                              <AlertDialogContent>\n                                <AlertDialogHeader>\n                                  <AlertDialogTitle>Remover Destinatário</AlertDialogTitle>\n                                  <AlertDialogDescription>\n                                    Tem certeza que deseja remover {setting.email} da lista de notificações?\n                                  </AlertDialogDescription>\n                                </AlertDialogHeader>\n                                <AlertDialogFooter>\n                                  <AlertDialogCancel data-testid=\"button-cancel-delete\">{translations.common.cancel}</AlertDialogCancel>\n                                  <AlertDialogAction\n                                    onClick={() => deleteMutation.mutate(setting.id)}\n                                    data-testid=\"button-confirm-delete\"\n                                  >\n                                    Remover\n                                  </AlertDialogAction>\n                                </AlertDialogFooter>\n                              </AlertDialogContent>\n                            </AlertDialog>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":21779,"size_tokens":null},"client/src/pages/ferias-licencas/index.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { format, differenceInDays } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { Plus, Pencil, Trash2, CalendarCheck, Search, Filter } from \"lucide-react\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { translations } from \"@/lib/translations\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport type { Employee, FeriasLicencasWithRelations } from \"@shared/schema\";\n\nconst feriasLicencasFormSchema = z.object({\n  employeeId: z.string().min(1, translations.validation.required),\n  type: z.enum([\"ferias\", \"licenca_medica\", \"licenca_maternidade\", \"licenca_paternidade\", \"licenca_nojo\", \"licenca_casamento\", \"outros\"]),\n  startDate: z.string().min(1, translations.validation.required),\n  endDate: z.string().min(1, translations.validation.required),\n  status: z.enum([\"pendente\", \"aprovado\", \"rejeitado\", \"em_andamento\", \"concluido\"]),\n  observations: z.string().optional(),\n}).refine(\n  (data) => new Date(data.startDate) <= new Date(data.endDate),\n  {\n    message: translations.validation.endDateAfterStart,\n    path: [\"endDate\"],\n  }\n);\n\ntype FeriasLicencasFormData = z.infer<typeof feriasLicencasFormSchema>;\n\nconst typeLabels: Record<string, string> = {\n  ferias: translations.feriasLicencas.types.ferias,\n  licenca_medica: translations.feriasLicencas.types.licenca_medica,\n  licenca_maternidade: translations.feriasLicencas.types.licenca_maternidade,\n  licenca_paternidade: translations.feriasLicencas.types.licenca_paternidade,\n  licenca_nojo: translations.feriasLicencas.types.licenca_nojo,\n  licenca_casamento: translations.feriasLicencas.types.licenca_casamento,\n  outros: translations.feriasLicencas.types.outros,\n};\n\nconst statusLabels: Record<string, string> = {\n  pendente: translations.feriasLicencas.statuses.pendente,\n  aprovado: translations.feriasLicencas.statuses.aprovado,\n  rejeitado: translations.feriasLicencas.statuses.rejeitado,\n  em_andamento: translations.feriasLicencas.statuses.em_andamento,\n  concluido: translations.feriasLicencas.statuses.concluido,\n};\n\nfunction getStatusVariant(status: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  switch (status) {\n    case \"aprovado\":\n    case \"em_andamento\":\n      return \"default\";\n    case \"concluido\":\n      return \"secondary\";\n    case \"rejeitado\":\n      return \"destructive\";\n    default:\n      return \"outline\";\n  }\n}\n\nexport default function FeriasLicencasIndex() {\n  const { toast } = useToast();\n  const { isAdmin } = useAuth();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [typeFilter, setTypeFilter] = useState<string>(\"all\");\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [editingRecord, setEditingRecord] = useState<FeriasLicencasWithRelations | null>(null);\n  const [deleteRecord, setDeleteRecord] = useState<FeriasLicencasWithRelations | null>(null);\n\n  const { data: records, isLoading } = useQuery<FeriasLicencasWithRelations[]>({\n    queryKey: [\"/api/ferias-licencas\"],\n  });\n\n  const { data: employees } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const form = useForm<FeriasLicencasFormData>({\n    resolver: zodResolver(feriasLicencasFormSchema),\n    defaultValues: {\n      employeeId: \"\",\n      type: \"ferias\",\n      startDate: \"\",\n      endDate: \"\",\n      status: \"pendente\",\n      observations: \"\",\n    },\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: FeriasLicencasFormData) => {\n      return apiRequest(\"POST\", \"/api/ferias-licencas\", {\n        ...data,\n        employeeId: parseInt(data.employeeId),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ferias-licencas\"] });\n      toast({ title: translations.feriasLicencas.createSuccess });\n      handleCloseForm();\n    },\n    onError: () => {\n      toast({ title: translations.errors.saveError, variant: \"destructive\" });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: FeriasLicencasFormData }) => {\n      return apiRequest(\"PATCH\", `/api/ferias-licencas/${id}`, {\n        ...data,\n        employeeId: parseInt(data.employeeId),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ferias-licencas\"] });\n      toast({ title: translations.feriasLicencas.updateSuccess });\n      handleCloseForm();\n    },\n    onError: () => {\n      toast({ title: translations.errors.saveError, variant: \"destructive\" });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      return apiRequest(\"DELETE\", `/api/ferias-licencas/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ferias-licencas\"] });\n      toast({ title: translations.feriasLicencas.deleteSuccess });\n      setDeleteRecord(null);\n    },\n    onError: () => {\n      toast({ title: translations.errors.deleteError, variant: \"destructive\" });\n    },\n  });\n\n  const handleOpenCreate = () => {\n    form.reset({\n      employeeId: \"\",\n      type: \"ferias\",\n      startDate: \"\",\n      endDate: \"\",\n      status: \"pendente\",\n      observations: \"\",\n    });\n    setEditingRecord(null);\n    setIsFormOpen(true);\n  };\n\n  const handleOpenEdit = (record: FeriasLicencasWithRelations) => {\n    form.reset({\n      employeeId: String(record.employeeId),\n      type: record.type as any,\n      startDate: record.startDate,\n      endDate: record.endDate,\n      status: record.status as any,\n      observations: record.observations || \"\",\n    });\n    setEditingRecord(record);\n    setIsFormOpen(true);\n  };\n\n  const handleCloseForm = () => {\n    setIsFormOpen(false);\n    setEditingRecord(null);\n    form.reset();\n  };\n\n  const onSubmit = (data: FeriasLicencasFormData) => {\n    if (editingRecord) {\n      updateMutation.mutate({ id: editingRecord.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const filteredRecords = records?.filter((record) => {\n    const matchesSearch =\n      searchTerm === \"\" ||\n      record.employee?.name.toLowerCase().includes(searchTerm.toLowerCase());\n    const matchesType = typeFilter === \"all\" || record.type === typeFilter;\n    const matchesStatus = statusFilter === \"all\" || record.status === statusFilter;\n    return matchesSearch && matchesType && matchesStatus;\n  });\n\n  const activeRecords = records?.filter((r) => {\n    const today = new Date();\n    const start = new Date(r.startDate);\n    const end = new Date(r.endDate);\n    return (r.status === \"aprovado\" || r.status === \"em_andamento\") && start <= today && end >= today;\n  });\n\n  return (\n    <div className=\"space-y-8\">\n      <PageHeader\n        title={translations.feriasLicencas.title}\n        description={translations.feriasLicencas.description}\n      />\n\n      <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {translations.dashboard.vacationsLeaves}\n            </CardTitle>\n            <CalendarCheck className=\"h-5 w-5 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-3xl font-semibold\" data-testid=\"stat-active-leaves\">\n              {activeRecords?.length || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {translations.dashboard.employeesOnLeave}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n            <CardTitle>{translations.feriasLicencas.title}</CardTitle>\n            {isAdmin && (\n              <Button onClick={handleOpenCreate} data-testid=\"button-add-ferias-licenca\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                {translations.feriasLicencas.addNew}\n              </Button>\n            )}\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-col gap-4 mb-6 sm:flex-row sm:items-center\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                placeholder={translations.feriasLicencas.searchPlaceholder}\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-ferias-licenca\"\n              />\n            </div>\n            <div className=\"flex flex-wrap gap-2\">\n              <Select value={typeFilter} onValueChange={setTypeFilter}>\n                <SelectTrigger className=\"w-[180px]\" data-testid=\"select-filter-type\">\n                  <Filter className=\"h-4 w-4 mr-2\" />\n                  <SelectValue placeholder={translations.feriasLicencas.filterByType} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{translations.feriasLicencas.allTypes}</SelectItem>\n                  <SelectItem value=\"ferias\">{translations.feriasLicencas.types.ferias}</SelectItem>\n                  <SelectItem value=\"licenca_medica\">{translations.feriasLicencas.types.licenca_medica}</SelectItem>\n                  <SelectItem value=\"licenca_maternidade\">{translations.feriasLicencas.types.licenca_maternidade}</SelectItem>\n                  <SelectItem value=\"licenca_paternidade\">{translations.feriasLicencas.types.licenca_paternidade}</SelectItem>\n                  <SelectItem value=\"licenca_nojo\">{translations.feriasLicencas.types.licenca_nojo}</SelectItem>\n                  <SelectItem value=\"licenca_casamento\">{translations.feriasLicencas.types.licenca_casamento}</SelectItem>\n                  <SelectItem value=\"outros\">{translations.feriasLicencas.types.outros}</SelectItem>\n                </SelectContent>\n              </Select>\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\n                <SelectTrigger className=\"w-[180px]\" data-testid=\"select-filter-status\">\n                  <SelectValue placeholder={translations.feriasLicencas.filterByStatus} />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">{translations.feriasLicencas.allStatuses}</SelectItem>\n                  <SelectItem value=\"pendente\">{translations.feriasLicencas.statuses.pendente}</SelectItem>\n                  <SelectItem value=\"aprovado\">{translations.feriasLicencas.statuses.aprovado}</SelectItem>\n                  <SelectItem value=\"rejeitado\">{translations.feriasLicencas.statuses.rejeitado}</SelectItem>\n                  <SelectItem value=\"em_andamento\">{translations.feriasLicencas.statuses.em_andamento}</SelectItem>\n                  <SelectItem value=\"concluido\">{translations.feriasLicencas.statuses.concluido}</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(5)].map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : filteredRecords?.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <CalendarCheck className=\"h-12 w-12 text-muted-foreground mb-4\" />\n              <p className=\"text-muted-foreground\">{translations.feriasLicencas.noRecords}</p>\n            </div>\n          ) : (\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>{translations.feriasLicencas.employee}</TableHead>\n                    <TableHead>{translations.feriasLicencas.type}</TableHead>\n                    <TableHead>{translations.feriasLicencas.startDate}</TableHead>\n                    <TableHead>{translations.feriasLicencas.endDate}</TableHead>\n                    <TableHead>{translations.feriasLicencas.daysTotal}</TableHead>\n                    <TableHead>{translations.feriasLicencas.status}</TableHead>\n                    <TableHead className=\"text-right\">{translations.common.actions}</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredRecords?.map((record) => {\n                    const days = differenceInDays(new Date(record.endDate), new Date(record.startDate)) + 1;\n                    return (\n                      <TableRow key={record.id} data-testid={`row-ferias-licenca-${record.id}`}>\n                        <TableCell className=\"font-medium\">\n                          {record.employee?.name || \"-\"}\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant=\"outline\">{typeLabels[record.type] || record.type}</Badge>\n                        </TableCell>\n                        <TableCell>\n                          {format(new Date(record.startDate), \"dd/MM/yyyy\", { locale: ptBR })}\n                        </TableCell>\n                        <TableCell>\n                          {format(new Date(record.endDate), \"dd/MM/yyyy\", { locale: ptBR })}\n                        </TableCell>\n                        <TableCell>{days}</TableCell>\n                        <TableCell>\n                          <Badge variant={getStatusVariant(record.status)}>\n                            {statusLabels[record.status] || record.status}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          {isAdmin && (\n                            <div className=\"flex justify-end gap-2\">\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => handleOpenEdit(record)}\n                                data-testid={`button-edit-ferias-licenca-${record.id}`}\n                              >\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                onClick={() => setDeleteRecord(record)}\n                                data-testid={`button-delete-ferias-licenca-${record.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          )}\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingRecord ? translations.feriasLicencas.editTitle : translations.feriasLicencas.addNew}\n            </DialogTitle>\n            <DialogDescription>\n              {translations.feriasLicencas.description}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"employeeId\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{translations.feriasLicencas.employee}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-employee\">\n                          <SelectValue placeholder={translations.common.selectOption} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {employees?.map((employee) => (\n                          <SelectItem key={employee.id} value={String(employee.id)}>\n                            {employee.name}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"type\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{translations.feriasLicencas.type}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-type\">\n                          <SelectValue placeholder={translations.common.selectOption} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"ferias\">{translations.feriasLicencas.types.ferias}</SelectItem>\n                        <SelectItem value=\"licenca_medica\">{translations.feriasLicencas.types.licenca_medica}</SelectItem>\n                        <SelectItem value=\"licenca_maternidade\">{translations.feriasLicencas.types.licenca_maternidade}</SelectItem>\n                        <SelectItem value=\"licenca_paternidade\">{translations.feriasLicencas.types.licenca_paternidade}</SelectItem>\n                        <SelectItem value=\"licenca_nojo\">{translations.feriasLicencas.types.licenca_nojo}</SelectItem>\n                        <SelectItem value=\"licenca_casamento\">{translations.feriasLicencas.types.licenca_casamento}</SelectItem>\n                        <SelectItem value=\"outros\">{translations.feriasLicencas.types.outros}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <div className=\"grid grid-cols-2 gap-4\">\n                <FormField\n                  control={form.control}\n                  name=\"startDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.feriasLicencas.startDate}</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-start-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"endDate\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>{translations.feriasLicencas.endDate}</FormLabel>\n                      <FormControl>\n                        <Input type=\"date\" {...field} data-testid=\"input-end-date\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"status\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{translations.feriasLicencas.status}</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-status\">\n                          <SelectValue placeholder={translations.common.selectOption} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"pendente\">{translations.feriasLicencas.statuses.pendente}</SelectItem>\n                        <SelectItem value=\"aprovado\">{translations.feriasLicencas.statuses.aprovado}</SelectItem>\n                        <SelectItem value=\"rejeitado\">{translations.feriasLicencas.statuses.rejeitado}</SelectItem>\n                        <SelectItem value=\"em_andamento\">{translations.feriasLicencas.statuses.em_andamento}</SelectItem>\n                        <SelectItem value=\"concluido\">{translations.feriasLicencas.statuses.concluido}</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"observations\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{translations.feriasLicencas.observations}</FormLabel>\n                    <FormControl>\n                      <Textarea {...field} data-testid=\"textarea-observations\" />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={handleCloseForm}>\n                  {translations.common.cancel}\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-submit-ferias-licenca\"\n                >\n                  {createMutation.isPending || updateMutation.isPending\n                    ? translations.common.loading\n                    : translations.common.save}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n\n      <AlertDialog open={!!deleteRecord} onOpenChange={() => setDeleteRecord(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>{translations.confirmDialog.areYouSure}</AlertDialogTitle>\n            <AlertDialogDescription>\n              {translations.feriasLicencas.confirmDelete}\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>{translations.common.cancel}</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deleteRecord && deleteMutation.mutate(deleteRecord.id)}\n              data-testid=\"button-confirm-delete\"\n            >\n              {translations.common.delete}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":24268,"size_tokens":null},"client/src/components/dica-logo.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ninterface DicaLogoProps {\n  className?: string;\n}\n\nexport function DicaLogo({ className }: DicaLogoProps) {\n  return (\n    <div\n      className={cn(\n        \"flex items-center justify-center rounded-md bg-primary text-primary-foreground font-bold\",\n        className\n      )}\n    >\n      <svg\n        viewBox=\"0 0 40 40\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        className=\"h-6 w-6\"\n      >\n        <rect width=\"40\" height=\"40\" rx=\"8\" fill=\"currentColor\" fillOpacity=\"0\" />\n        <path\n          d=\"M8 12h6c4 0 7 3 7 8s-3 8-7 8H8V12zm6 12c2 0 3-1.5 3-4s-1-4-3-4h-2v8h2z\"\n          fill=\"currentColor\"\n        />\n        <circle cx=\"28\" cy=\"20\" r=\"6\" stroke=\"currentColor\" strokeWidth=\"2.5\" fill=\"none\" />\n        <path\n          d=\"M28 15v10M23 20h10\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n      </svg>\n    </div>\n  );\n}\n","path":null,"size_bytes":950,"size_tokens":null},"server/emailService.ts":{"content":"import nodemailer from \"nodemailer\";\n\ninterface EmailConfig {\n  host: string;\n  port: number;\n  secure: boolean;\n  auth: {\n    user: string;\n    pass: string;\n  };\n  from: string;\n}\n\ninterface NotificationEmail {\n  to: string;\n  subject: string;\n  html: string;\n  text?: string;\n}\n\nclass EmailService {\n  private transporter: nodemailer.Transporter | null = null;\n  private fromAddress: string = \"\";\n  private isConfigured: boolean = false;\n\n  constructor() {\n    this.initialize();\n  }\n\n  private initialize() {\n    const host = process.env.SMTP_HOST;\n    const port = process.env.SMTP_PORT;\n    const user = process.env.SMTP_USER;\n    const pass = process.env.SMTP_PASS;\n    const from = process.env.SMTP_FROM || process.env.SMTP_USER;\n\n    if (host && port && user && pass) {\n      try {\n        this.transporter = nodemailer.createTransport({\n          host,\n          port: parseInt(port, 10),\n          secure: parseInt(port, 10) === 465,\n          auth: { user, pass },\n        });\n        this.fromAddress = from || user;\n        this.isConfigured = true;\n        console.log(\"Email service configured successfully\");\n      } catch (error) {\n        console.error(\"Failed to configure email service:\", error);\n        this.isConfigured = false;\n      }\n    } else {\n      console.log(\"Email service not configured - missing SMTP credentials\");\n      this.isConfigured = false;\n    }\n  }\n\n  public isReady(): boolean {\n    return this.isConfigured && this.transporter !== null;\n  }\n\n  public async sendEmail(email: NotificationEmail): Promise<boolean> {\n    if (!this.isReady()) {\n      console.log(\"Email service not configured, skipping email send\");\n      return false;\n    }\n\n    try {\n      await this.transporter!.sendMail({\n        from: this.fromAddress,\n        to: email.to,\n        subject: email.subject,\n        html: email.html,\n        text: email.text,\n      });\n      console.log(`Email sent successfully to ${email.to}`);\n      return true;\n    } catch (error) {\n      console.error(\"Failed to send email:\", error);\n      return false;\n    }\n  }\n\n  public async sendNewOccurrenceNotification(\n    recipientEmail: string,\n    occurrence: {\n      date: string;\n      category: string;\n      description: string;\n      employeeName?: string;\n    }\n  ): Promise<boolean> {\n    const subject = `New Occurrence Registered - ${occurrence.category}`;\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #1a365d;\">New Occurrence Notification</h2>\n        <div style=\"background-color: #f7fafc; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n          <p><strong>Date:</strong> ${occurrence.date}</p>\n          <p><strong>Category:</strong> ${occurrence.category}</p>\n          ${occurrence.employeeName ? `<p><strong>Employee:</strong> ${occurrence.employeeName}</p>` : \"\"}\n          <p><strong>Description:</strong> ${occurrence.description}</p>\n        </div>\n        <p style=\"color: #718096; font-size: 14px;\">\n          This is an automated notification from the Contract Management System.\n        </p>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: recipientEmail,\n      subject,\n      html,\n      text: `New Occurrence: ${occurrence.category} on ${occurrence.date}. ${occurrence.description}`,\n    });\n  }\n\n  public async sendMissingAllocationNotification(\n    recipientEmail: string,\n    data: {\n      date: string;\n      postName: string;\n      postCode: string;\n    }\n  ): Promise<boolean> {\n    const subject = `Missing Allocation Alert - ${data.postCode}`;\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #c53030;\">Missing Allocation Alert</h2>\n        <div style=\"background-color: #fff5f5; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #c53030;\">\n          <p><strong>Date:</strong> ${data.date}</p>\n          <p><strong>Service Post:</strong> ${data.postName} (${data.postCode})</p>\n          <p>No employees have been allocated to this service post for the specified date.</p>\n        </div>\n        <p style=\"color: #718096; font-size: 14px;\">\n          Please review and update the allocations as needed.\n        </p>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: recipientEmail,\n      subject,\n      html,\n      text: `Missing Allocation Alert: No allocation for ${data.postName} (${data.postCode}) on ${data.date}`,\n    });\n  }\n\n  public async sendDocumentExpirationNotification(\n    recipientEmail: string,\n    documents: Array<{\n      documentType: string;\n      originalName: string;\n      expirationDate: string;\n      employeeName?: string;\n      postName?: string;\n      daysUntilExpiration: number;\n    }>\n  ): Promise<boolean> {\n    const expiredDocs = documents.filter((d) => d.daysUntilExpiration <= 0);\n    const expiringDocs = documents.filter((d) => d.daysUntilExpiration > 0);\n\n    const subject = expiredDocs.length > 0\n      ? `Document Expiration Alert - ${expiredDocs.length} Expired, ${expiringDocs.length} Expiring Soon`\n      : `Document Expiration Alert - ${expiringDocs.length} Documents Expiring Soon`;\n\n    const formatDocList = (docs: typeof documents, isExpired: boolean) => {\n      if (docs.length === 0) return \"\";\n      \n      const title = isExpired ? \"Expired Documents\" : \"Documents Expiring Soon\";\n      const bgColor = isExpired ? \"#fff5f5\" : \"#fffaf0\";\n      const borderColor = isExpired ? \"#c53030\" : \"#dd6b20\";\n      \n      return `\n        <div style=\"background-color: ${bgColor}; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid ${borderColor};\">\n          <h3 style=\"color: ${borderColor}; margin-top: 0;\">${title}</h3>\n          <table style=\"width: 100%; border-collapse: collapse;\">\n            <thead>\n              <tr style=\"border-bottom: 1px solid #e2e8f0;\">\n                <th style=\"text-align: left; padding: 8px;\">Document</th>\n                <th style=\"text-align: left; padding: 8px;\">Type</th>\n                <th style=\"text-align: left; padding: 8px;\">Expiration</th>\n                <th style=\"text-align: left; padding: 8px;\">Related To</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${docs.map((doc) => `\n                <tr style=\"border-bottom: 1px solid #e2e8f0;\">\n                  <td style=\"padding: 8px;\">${doc.originalName}</td>\n                  <td style=\"padding: 8px;\">${doc.documentType}</td>\n                  <td style=\"padding: 8px;\">${doc.expirationDate}</td>\n                  <td style=\"padding: 8px;\">${doc.employeeName || doc.postName || \"-\"}</td>\n                </tr>\n              `).join(\"\")}\n            </tbody>\n          </table>\n        </div>\n      `;\n    };\n\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #1a365d;\">Document Expiration Notification</h2>\n        ${formatDocList(expiredDocs, true)}\n        ${formatDocList(expiringDocs, false)}\n        <p style=\"color: #718096; font-size: 14px;\">\n          Please review these documents and upload updated versions as needed.\n        </p>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: recipientEmail,\n      subject,\n      html,\n      text: `Document Expiration Alert: ${expiredDocs.length} expired, ${expiringDocs.length} expiring soon.`,\n    });\n  }\n\n  public async sendDailySummaryNotification(\n    recipientEmail: string,\n    summary: {\n      date: string;\n      newOccurrences: number;\n      missingAllocations: number;\n      expiredDocuments: number;\n      expiringDocuments: number;\n    }\n  ): Promise<boolean> {\n    const hasIssues =\n      summary.newOccurrences > 0 ||\n      summary.missingAllocations > 0 ||\n      summary.expiredDocuments > 0 ||\n      summary.expiringDocuments > 0;\n\n    if (!hasIssues) {\n      return true;\n    }\n\n    const subject = `Daily Summary - ${summary.date}`;\n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #1a365d;\">Daily Summary - ${summary.date}</h2>\n        <div style=\"background-color: #f7fafc; padding: 20px; border-radius: 8px; margin: 20px 0;\">\n          <table style=\"width: 100%;\">\n            <tr>\n              <td style=\"padding: 10px; border-bottom: 1px solid #e2e8f0;\">\n                <strong>New Occurrences:</strong>\n              </td>\n              <td style=\"padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: right;\">\n                ${summary.newOccurrences}\n              </td>\n            </tr>\n            <tr>\n              <td style=\"padding: 10px; border-bottom: 1px solid #e2e8f0;\">\n                <strong>Missing Allocations:</strong>\n              </td>\n              <td style=\"padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: right; ${summary.missingAllocations > 0 ? 'color: #c53030;' : ''}\">\n                ${summary.missingAllocations}\n              </td>\n            </tr>\n            <tr>\n              <td style=\"padding: 10px; border-bottom: 1px solid #e2e8f0;\">\n                <strong>Expired Documents:</strong>\n              </td>\n              <td style=\"padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: right; ${summary.expiredDocuments > 0 ? 'color: #c53030;' : ''}\">\n                ${summary.expiredDocuments}\n              </td>\n            </tr>\n            <tr>\n              <td style=\"padding: 10px;\">\n                <strong>Documents Expiring (30 days):</strong>\n              </td>\n              <td style=\"padding: 10px; text-align: right; ${summary.expiringDocuments > 0 ? 'color: #dd6b20;' : ''}\">\n                ${summary.expiringDocuments}\n              </td>\n            </tr>\n          </table>\n        </div>\n        <p style=\"color: #718096; font-size: 14px;\">\n          Log in to the Contract Management System to review these items.\n        </p>\n      </div>\n    `;\n\n    return this.sendEmail({\n      to: recipientEmail,\n      subject,\n      html,\n      text: `Daily Summary for ${summary.date}: ${summary.newOccurrences} new occurrences, ${summary.missingAllocations} missing allocations, ${summary.expiredDocuments} expired documents, ${summary.expiringDocuments} expiring soon.`,\n    });\n  }\n}\n\nexport const emailService = new EmailService();\n","path":null,"size_bytes":10332,"size_tokens":null},"client/src/pages/alerts/index.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { AlertTriangle, FileWarning, UserX, AlertCircle, CheckCircle } from \"lucide-react\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { translations } from \"@/lib/translations\";\nimport type { Employee, Document, Occurrence } from \"@shared/schema\";\n\nexport default function AlertsIndex() {\n  const { data: employees, isLoading: employeesLoading } = useQuery<Employee[]>({\n    queryKey: [\"/api/employees\"],\n  });\n\n  const { data: documents, isLoading: documentsLoading } = useQuery<Document[]>({\n    queryKey: [\"/api/documents\"],\n  });\n\n  const { data: occurrences, isLoading: occurrencesLoading } = useQuery<Occurrence[]>({\n    queryKey: [\"/api/occurrences\"],\n  });\n\n  const isLoading = employeesLoading || documentsLoading || occurrencesLoading;\n\n  const today = new Date();\n  const thirtyDaysFromNow = new Date(today);\n  thirtyDaysFromNow.setDate(thirtyDaysFromNow.getDate() + 30);\n\n  const expiredDocuments = documents?.filter((doc) => {\n    if (!doc.expirationDate) return false;\n    return new Date(doc.expirationDate) < today;\n  }) || [];\n\n  const expiringDocuments = documents?.filter((doc) => {\n    if (!doc.expirationDate) return false;\n    const expDate = new Date(doc.expirationDate);\n    return expDate >= today && expDate <= thirtyDaysFromNow;\n  }) || [];\n\n  const untreatedOccurrences = occurrences?.filter((occ) => !occ.treated) || [];\n\n  const inactiveEmployees = employees?.filter((emp) => emp.status === \"inactive\") || [];\n\n  const totalAlerts = expiredDocuments.length + expiringDocuments.length + untreatedOccurrences.length;\n\n  return (\n    <div className=\"space-y-8\">\n      <PageHeader\n        title={translations.alerts.title}\n        description={translations.alerts.description}\n      />\n\n      <div className=\"grid gap-6 sm:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {translations.alerts.criticalAlerts}\n            </CardTitle>\n            <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <>\n                <div className=\"text-3xl font-semibold\" data-testid=\"stat-critical-alerts\">\n                  {expiredDocuments.length}\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {translations.documents.expiredDocuments}\n                </p>\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {translations.alerts.warningAlerts}\n            </CardTitle>\n            <FileWarning className=\"h-5 w-5 text-yellow-500\" />\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <>\n                <div className=\"text-3xl font-semibold\" data-testid=\"stat-warning-alerts\">\n                  {expiringDocuments.length}\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {translations.documents.expiringDocuments}\n                </p>\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {translations.alerts.untreatedOccurrence}\n            </CardTitle>\n            <AlertCircle className=\"h-5 w-5 text-orange-500\" />\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <>\n                <div className=\"text-3xl font-semibold\" data-testid=\"stat-untreated-occurrences\">\n                  {untreatedOccurrences.length}\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {translations.occurrences.untreated}\n                </p>\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n              {translations.employees.inactive}\n            </CardTitle>\n            <UserX className=\"h-5 w-5 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <Skeleton className=\"h-8 w-16\" />\n            ) : (\n              <>\n                <div className=\"text-3xl font-semibold\" data-testid=\"stat-inactive-employees\">\n                  {inactiveEmployees.length}\n                </div>\n                <p className=\"text-xs text-muted-foreground mt-1\">\n                  {translations.employees.status}\n                </p>\n              </>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <AlertTriangle className=\"h-5 w-5 text-destructive\" />\n              {translations.documents.expiredDocuments}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-12 w-full\" />\n                ))}\n              </div>\n            ) : expiredDocuments.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n                <CheckCircle className=\"h-8 w-8 text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">{translations.alerts.noAlerts}</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {expiredDocuments.slice(0, 5).map((doc) => (\n                  <div\n                    key={doc.id}\n                    className=\"flex items-center justify-between gap-3 rounded-md border p-3\"\n                    data-testid={`alert-expired-doc-${doc.id}`}\n                  >\n                    <div className=\"flex-1 overflow-hidden\">\n                      <p className=\"text-sm font-medium truncate\">{doc.originalName}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {doc.expirationDate && new Date(doc.expirationDate).toLocaleDateString(\"pt-BR\")}\n                      </p>\n                    </div>\n                    <Badge variant=\"destructive\">{translations.documents.expired}</Badge>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileWarning className=\"h-5 w-5 text-yellow-500\" />\n              {translations.documents.expiringDocuments}\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"space-y-3\">\n                {[...Array(3)].map((_, i) => (\n                  <Skeleton key={i} className=\"h-12 w-full\" />\n                ))}\n              </div>\n            ) : expiringDocuments.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n                <CheckCircle className=\"h-8 w-8 text-muted-foreground mb-2\" />\n                <p className=\"text-sm text-muted-foreground\">{translations.alerts.noAlerts}</p>\n              </div>\n            ) : (\n              <div className=\"space-y-3\">\n                {expiringDocuments.slice(0, 5).map((doc) => (\n                  <div\n                    key={doc.id}\n                    className=\"flex items-center justify-between gap-3 rounded-md border p-3\"\n                    data-testid={`alert-expiring-doc-${doc.id}`}\n                  >\n                    <div className=\"flex-1 overflow-hidden\">\n                      <p className=\"text-sm font-medium truncate\">{doc.originalName}</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {doc.expirationDate && new Date(doc.expirationDate).toLocaleDateString(\"pt-BR\")}\n                      </p>\n                    </div>\n                    <Badge variant=\"secondary\">{translations.documents.expiring}</Badge>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <AlertCircle className=\"h-5 w-5 text-orange-500\" />\n            {translations.occurrences.title} - {translations.occurrences.untreated}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <div className=\"space-y-3\">\n              {[...Array(3)].map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : untreatedOccurrences.length === 0 ? (\n            <div className=\"flex flex-col items-center justify-center py-8 text-center\">\n              <CheckCircle className=\"h-8 w-8 text-muted-foreground mb-2\" />\n              <p className=\"text-sm text-muted-foreground\">{translations.alerts.noAlerts}</p>\n            </div>\n          ) : (\n            <div className=\"grid gap-3 sm:grid-cols-2 lg:grid-cols-3\">\n              {untreatedOccurrences.slice(0, 6).map((occ) => (\n                <div\n                  key={occ.id}\n                  className=\"rounded-md border p-3\"\n                  data-testid={`alert-untreated-occ-${occ.id}`}\n                >\n                  <div className=\"flex items-start justify-between gap-2 mb-2\">\n                    <p className=\"text-sm font-medium\">{occ.category}</p>\n                    <Badge variant=\"outline\">{translations.occurrences.untreated}</Badge>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground truncate\">{occ.description}</p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {new Date(occ.date).toLocaleDateString(\"pt-BR\")}\n                  </p>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10987,"size_tokens":null},"client/src/lib/translations.ts":{"content":"export const translations = {\n  common: {\n    save: \"Salvar\",\n    cancel: \"Cancelar\",\n    delete: \"Excluir\",\n    edit: \"Editar\",\n    add: \"Adicionar\",\n    create: \"Criar\",\n    update: \"Atualizar\",\n    search: \"Buscar\",\n    filter: \"Filtrar\",\n    export: \"Exportar\",\n    import: \"Importar\",\n    loading: \"Carregando...\",\n    noData: \"Nenhum dado encontrado\",\n    confirm: \"Confirmar\",\n    back: \"Voltar\",\n    next: \"Próximo\",\n    previous: \"Anterior\",\n    close: \"Fechar\",\n    view: \"Visualizar\",\n    actions: \"Ações\",\n    status: \"Status\",\n    date: \"Data\",\n    name: \"Nome\",\n    description: \"Descrição\",\n    type: \"Tipo\",\n    unit: \"Unidade\",\n    all: \"Todos\",\n    yes: \"Sim\",\n    no: \"Não\",\n    required: \"Obrigatório\",\n    optional: \"Opcional\",\n    success: \"Sucesso\",\n    error: \"Erro\",\n    warning: \"Aviso\",\n    info: \"Informação\",\n    selectOption: \"Selecione uma opção\",\n    noResults: \"Nenhum resultado encontrado\",\n    clearFilters: \"Limpar filtros\",\n    downloadCsv: \"Baixar CSV\",\n    downloadPdf: \"Baixar PDF\",\n    copyMonth: \"Copiar mês\",\n    uploadFile: \"Enviar arquivo\",\n    selectFile: \"Selecionar arquivo\",\n    dragDrop: \"Arraste e solte ou clique para selecionar\",\n    maxFileSize: \"Tamanho máximo do arquivo\",\n    today: \"Hoje\",\n    thisMonth: \"Este mês\",\n    thisYear: \"Este ano\",\n    last30Days: \"Últimos 30 dias\",\n    last90Days: \"Últimos 90 dias\",\n    sending: \"Enviando...\",\n    learnMore: \"Saiba Mais\",\n  },\n\n  auth: {\n    login: \"Entrar\",\n    logout: \"Sair\",\n    loginWithReplit: \"Entrar com Replit\",\n    welcome: \"Bem-vindo\",\n    accessDenied: \"Acesso Negado\",\n    permissionRequired: \"Você não tem permissão para acessar esta página.\",\n    sessionExpired: \"Sua sessão expirou. Por favor, faça login novamente.\",\n  },\n\n  nav: {\n    dashboard: \"Painel\",\n    employees: \"Funcionários\",\n    servicePosts: \"Postos de Serviço\",\n    allocation: \"Alocação\",\n    feriasLicencas: \"Férias e Licenças\",\n    occurrences: \"Ocorrências\",\n    documents: \"Documentos\",\n    reports: \"Relatórios\",\n    notifications: \"Notificações\",\n    adminSettings: \"Configurações\",\n    alerts: \"Alertas\",\n    mainMenu: \"Menu Principal\",\n    administration: \"Administração\",\n  },\n\n  branding: {\n    appName: \"Sistema de Gestão Contratual\",\n    companyName: \"Dica Serviços\",\n    fullTitle: \"Sistema de Gestão Contratual – Dica Serviços\",\n  },\n\n  roles: {\n    admin: \"Administrador\",\n    adminDica: \"Admin Dica\",\n    operatorDica: \"Operador Dica\",\n    fiscalPetrobras: \"Fiscal Petrobras\",\n    viewer: \"Visualizador\",\n  },\n\n  feriasLicencas: {\n    title: \"Férias e Licenças\",\n    description: \"Gerenciamento de férias e licenças dos funcionários\",\n    addNew: \"Nova Férias/Licença\",\n    editTitle: \"Editar Férias/Licença\",\n    employee: \"Funcionário\",\n    type: \"Tipo\",\n    startDate: \"Data Início\",\n    endDate: \"Data Fim\",\n    status: \"Status\",\n    observations: \"Observações\",\n    types: {\n      ferias: \"Férias\",\n      licenca_medica: \"Licença Médica\",\n      licenca_maternidade: \"Licença Maternidade\",\n      licenca_paternidade: \"Licença Paternidade\",\n      licenca_nojo: \"Licença Nojo\",\n      licenca_casamento: \"Licença Casamento\",\n      outros: \"Outros\",\n    },\n    statuses: {\n      pendente: \"Pendente\",\n      aprovado: \"Aprovado\",\n      rejeitado: \"Rejeitado\",\n      em_andamento: \"Em Andamento\",\n      concluido: \"Concluído\",\n    },\n    confirmDelete: \"Tem certeza que deseja excluir esta férias/licença?\",\n    createSuccess: \"Férias/Licença criada com sucesso\",\n    updateSuccess: \"Férias/Licença atualizada com sucesso\",\n    deleteSuccess: \"Férias/Licença excluída com sucesso\",\n    noRecords: \"Nenhum registro de férias/licença encontrado\",\n    filterByType: \"Filtrar por tipo\",\n    filterByStatus: \"Filtrar por status\",\n    allTypes: \"Todos os tipos\",\n    allStatuses: \"Todos os status\",\n    searchPlaceholder: \"Buscar por funcionário...\",\n    daysTotal: \"dias\",\n    active: \"Ativo\",\n    upcoming: \"Próximo\",\n    completed: \"Concluído\",\n  },\n\n  dashboard: {\n    title: \"Painel\",\n    description: \"Visão geral do sistema de gestão contratual\",\n    totalEmployees: \"Total de Funcionários\",\n    activeEmployees: \"Funcionários Ativos\",\n    servicePosts: \"Postos de Serviço\",\n    registeredPosts: \"Postos cadastrados\",\n    contractualPosts: \"Postos Contratuais\",\n    todayAllocations: \"Alocações de Hoje\",\n    presentToday: \"presentes\",\n    monthlyOccurrences: \"Ocorrências do Mês\",\n    thisMonth: \"Este mês\",\n    allocationPercentage: \"Percentual de Alocação do Mês\",\n    allocationTrends: \"Tendência de Alocações\",\n    last30Days: \"Últimos 30 dias\",\n    last90Days: \"Últimos 90 dias\",\n    occurrencesByCategory: \"Ocorrências por Categoria\",\n    complianceMetrics: \"Métricas de Conformidade\",\n    attendanceRate: \"Taxa de Presença\",\n    documentationRate: \"Taxa de Documentação\",\n    activeEmployeeRate: \"Taxa de Funcionários Ativos\",\n    occurrencesPerEmployee: \"Ocorrências por Funcionário\",\n    average30Days: \"Média dos últimos 30 dias\",\n    quickStats: \"Estatísticas Rápidas\",\n    documents: \"Documentos\",\n    totalUploaded: \"Total enviados\",\n    activeRate: \"Taxa de Ativos\",\n    employeeStatus: \"Status dos funcionários\",\n    attendance: \"Presença\",\n    todayRate: \"Taxa de hoje\",\n    recentOccurrences: \"Ocorrências Recentes\",\n    noRecentOccurrences: \"Nenhuma ocorrência recente\",\n    noAllocationData: \"Nenhum dado de alocação disponível\",\n    noOccurrenceData: \"Nenhum dado de ocorrência disponível\",\n    expiringDocuments: \"Documentos Vencendo\",\n    next30Days: \"Próximos 30 dias\",\n    criticalAbsences: \"Ausências Críticas\",\n    contractPending: \"Pendências do Contrato\",\n    noPendingAlerts: \"Nenhuma pendência encontrada\",\n    vacationsLeaves: \"Férias e Licenças Ativas\",\n    employeesOnLeave: \"funcionários em férias/licença\",\n  },\n\n  employees: {\n    title: \"Funcionários\",\n    description: \"Gerenciar funcionários do contrato\",\n    addEmployee: \"Adicionar Funcionário\",\n    editEmployee: \"Editar Funcionário\",\n    viewEmployee: \"Visualizar Funcionário\",\n    deleteEmployee: \"Excluir Funcionário\",\n    deleteConfirm: \"Tem certeza que deseja excluir este funcionário?\",\n    deleteWarning: \"Esta ação não pode ser desfeita. Todos os dados relacionados serão removidos.\",\n    name: \"Nome\",\n    cpf: \"CPF\",\n    cpfFormat: \"Formato: XXX.XXX.XXX-XX\",\n    functionPost: \"Função/Cargo\",\n    unit: \"Unidade\",\n    status: \"Status\",\n    active: \"Ativo\",\n    inactive: \"Inativo\",\n    createdAt: \"Criado em\",\n    noEmployees: \"Nenhum funcionário cadastrado\",\n    searchPlaceholder: \"Buscar por nome ou CPF...\",\n    filterByStatus: \"Filtrar por status\",\n    filterByUnit: \"Filtrar por unidade\",\n    allStatuses: \"Todos os status\",\n    allUnits: \"Todas as unidades\",\n    employeeCreated: \"Funcionário criado com sucesso\",\n    employeeUpdated: \"Funcionário atualizado com sucesso\",\n    employeeDeleted: \"Funcionário excluído com sucesso\",\n    cpfExists: \"CPF já cadastrado\",\n  },\n\n  servicePosts: {\n    title: \"Postos de Serviço\",\n    pageDescription: \"Gerenciar postos de serviço do contrato\",\n    addPost: \"Adicionar Posto\",\n    editPost: \"Editar Posto\",\n    viewPost: \"Visualizar Posto\",\n    deletePost: \"Excluir Posto\",\n    deleteConfirm: \"Tem certeza que deseja excluir este posto?\",\n    deleteWarning: \"Esta ação não pode ser desfeita. Todos os dados relacionados serão removidos.\",\n    postCode: \"Código do Posto\",\n    postName: \"Nome do Posto\",\n    description: \"Descrição\",\n    unit: \"Unidade\",\n    modality: \"Modalidade\",\n    onsite: \"Presencial\",\n    hybrid: \"Híbrido\",\n    remote: \"Remoto\",\n    createdAt: \"Criado em\",\n    noPosts: \"Nenhum posto cadastrado\",\n    searchPlaceholder: \"Buscar por código ou nome...\",\n    filterByModality: \"Filtrar por modalidade\",\n    filterByUnit: \"Filtrar por unidade\",\n    allModalities: \"Todas as modalidades\",\n    allUnits: \"Todas as unidades\",\n    postCreated: \"Posto criado com sucesso\",\n    postUpdated: \"Posto atualizado com sucesso\",\n    postDeleted: \"Posto excluído com sucesso\",\n    postCodeExists: \"Código do posto já existe\",\n    tipoPosto: \"Tipo de Posto\",\n    horarioTrabalho: \"Horário de Trabalho\",\n    escalaRegime: \"Escala / Regime\",\n    quantidadePrevista: \"Quantidade Prevista no Contrato\",\n  },\n\n  allocation: {\n    title: \"Alocação Diária\",\n    description: \"Gerenciar alocação de funcionários nos postos\",\n    selectPost: \"Selecionar Posto\",\n    selectMonth: \"Selecionar Mês\",\n    selectEmployee: \"Selecionar Funcionário\",\n    addAllocation: \"Adicionar Alocação\",\n    editAllocation: \"Editar Alocação\",\n    deleteAllocation: \"Excluir Alocação\",\n    present: \"Presente\",\n    absent: \"Ausente\",\n    justified: \"Justificado\",\n    vacation: \"Férias\",\n    medicalLeave: \"Licença Médica\",\n    notes: \"Observações\",\n    noAllocations: \"Nenhuma alocação registrada\",\n    allocationCreated: \"Alocação criada com sucesso\",\n    allocationUpdated: \"Alocação atualizada com sucesso\",\n    allocationDeleted: \"Alocação excluída com sucesso\",\n    copyFromMonth: \"Copiar do mês anterior\",\n    copyToMonth: \"Copiar para o mês\",\n    sourceMonth: \"Mês de origem\",\n    targetMonth: \"Mês de destino\",\n    copySuccess: \"Alocações copiadas com sucesso\",\n    importCsv: \"Importar CSV\",\n    importSuccess: \"CSV importado com sucesso\",\n    exportCsv: \"Exportar CSV\",\n    bulkOperations: \"Operações em Lote\",\n    selectPostFirst: \"Selecione um posto primeiro\",\n    noAllocationsInMonth: \"Nenhuma alocação no mês de origem\",\n    loadError: \"Falha ao carregar alocações\",\n    allocationsCopied: \"{count} alocações copiadas do mês anterior\",\n    allocationsImported: \"{count} alocações importadas\",\n    linesWithErrors: \"{count} linhas com erros\",\n    importCsvFailed: \"Falha ao importar CSV\",\n  },\n\n  occurrences: {\n    title: \"Ocorrências\",\n    pageDescription: \"Registrar e gerenciar ocorrências do contrato\",\n    addOccurrence: \"Adicionar Ocorrência\",\n    editOccurrence: \"Editar Ocorrência\",\n    deleteOccurrence: \"Excluir Ocorrência\",\n    deleteConfirm: \"Tem certeza que deseja excluir esta ocorrência?\",\n    date: \"Data\",\n    employee: \"Funcionário\",\n    description: \"Descrição\",\n    category: \"Categoria\",\n    absence: \"Falta\",\n    substitution: \"Substituição\",\n    issue: \"Problema\",\n    note: \"Anotação\",\n    noOccurrences: \"Nenhuma ocorrência registrada\",\n    searchPlaceholder: \"Buscar por descrição...\",\n    filterByCategory: \"Filtrar por categoria\",\n    filterByEmployee: \"Filtrar por funcionário\",\n    allCategories: \"Todas as categorias\",\n    allEmployees: \"Todos os funcionários\",\n    occurrenceCreated: \"Ocorrência criada com sucesso\",\n    occurrenceUpdated: \"Ocorrência atualizada com sucesso\",\n    occurrenceDeleted: \"Ocorrência excluída com sucesso\",\n    treated: \"Tratada\",\n    untreated: \"Não Tratada\",\n    markAsTreated: \"Marcar como Tratada\",\n  },\n\n  documents: {\n    title: \"Documentos\",\n    description: \"Gerenciar documentos do contrato\",\n    uploadDocument: \"Enviar Documento\",\n    editDocument: \"Editar Documento\",\n    deleteDocument: \"Excluir Documento\",\n    deleteConfirm: \"Tem certeza que deseja excluir este documento?\",\n    filename: \"Nome do Arquivo\",\n    originalName: \"Nome Original\",\n    type: \"Tipo\",\n    category: \"Categoria\",\n    employee: \"Funcionário\",\n    post: \"Posto\",\n    monthYear: \"Mês/Ano de Referência\",\n    expirationDate: \"Data de Validade\",\n    uploadedBy: \"Enviado por\",\n    uploadedAt: \"Data de Envio\",\n    observations: \"Observações\",\n    noDocuments: \"Nenhum documento cadastrado\",\n    searchPlaceholder: \"Buscar por nome do arquivo...\",\n    filterByType: \"Filtrar por tipo\",\n    filterByEmployee: \"Filtrar por funcionário\",\n    filterByPost: \"Filtrar por posto\",\n    allTypes: \"Todos os tipos\",\n    allEmployees: \"Todos os funcionários\",\n    allPosts: \"Todos os postos\",\n    documentUploaded: \"Documento enviado com sucesso\",\n    documentUpdated: \"Documento atualizado com sucesso\",\n    documentDeleted: \"Documento excluído com sucesso\",\n    download: \"Baixar\",\n    preview: \"Visualizar\",\n    expired: \"Vencido\",\n    expiring: \"Vencendo\",\n    valid: \"Válido\",\n    aso: \"ASO\",\n    certification: \"Certificação\",\n    evidence: \"Evidência\",\n    contract: \"Contrato\",\n    other: \"Outro\",\n    atestados: \"Atestados\",\n    comprovantes: \"Comprovantes\",\n    relatoriosMensais: \"Relatórios Mensais\",\n    evidenciasPosto: \"Evidências de Posto\",\n    treinamentos: \"Treinamentos\",\n    certidoes: \"Certidões\",\n    outros: \"Outros\",\n    selectCategory: \"Selecione a categoria\",\n    selectReferenceMonth: \"Selecione o mês de referência\",\n    expiringDocuments: \"Documentos Vencendo\",\n    expiredDocuments: \"Documentos Vencidos\",\n    renewalAlert: \"Alerta de Renovação\",\n    linkedTo: \"Vinculado a\",\n    uploadFailed: \"Falha ao enviar arquivo\",\n    size: \"Tamanho\",\n    none: \"Nenhum\",\n    linkTo: \"Vincular a\",\n    monthlyEvidence: \"Evidência Mensal\",\n    selectEmployee: \"Selecionar Funcionário\",\n    selectServicePost: \"Selecionar Posto de Serviço\",\n    selectMonthYear: \"Selecionar Mês\",\n    setExpirationHint: \"Defina uma data de validade para acompanhar renovações\",\n    acceptedFormats: \"PDF, imagens até 10MB\",\n  },\n\n  reports: {\n    title: \"Relatórios\",\n    description: \"Gerar e exportar relatórios do contrato\",\n    monthlyReport: \"Relatório Mensal\",\n    generateReport: \"Gerar Relatório\",\n    selectMonth: \"Selecionar Mês\",\n    exportPdf: \"Exportar PDF\",\n    exportCsv: \"Exportar CSV\",\n    reportGenerated: \"Relatório gerado com sucesso\",\n    employeeList: \"Lista de Funcionários\",\n    postList: \"Lista de Postos\",\n    dailyAllocation: \"Alocação Diária Consolidada\",\n    occurrencesList: \"Lista de Ocorrências\",\n    documentsSent: \"Documentos Enviados\",\n    missingDocuments: \"Documentos Faltantes\",\n    criticalPending: \"Pendências Críticas\",\n    auditLog: \"Log de Auditoria\",\n  },\n\n  notifications: {\n    title: \"Notificações\",\n    description: \"Configurar e gerenciar notificações\",\n    emailSettings: \"Configurações de Email\",\n    emailAddress: \"Endereço de Email\",\n    notifyNewOccurrences: \"Notificar novas ocorrências\",\n    notifyMissingAllocations: \"Notificar alocações faltantes\",\n    notifyDocumentExpiration: \"Notificar vencimento de documentos\",\n    notifyDailySummary: \"Receber resumo diário\",\n    isActive: \"Notificações ativas\",\n    saveSettings: \"Salvar Configurações\",\n    settingsSaved: \"Configurações salvas com sucesso\",\n    testEmail: \"Enviar Email de Teste\",\n    emailSent: \"Email de teste enviado\",\n    pendingNotifications: \"Notificações Pendentes\",\n    noPendingNotifications: \"Nenhuma notificação pendente\",\n    recipientAdded: \"Destinatário de notificação adicionado\",\n    recipientRemoved: \"Destinatário removido\",\n    addRecipientFailed: \"Falha ao adicionar destinatário\",\n    testEmailFailed: \"Falha ao enviar email de teste\",\n    documentExpirationSent: \"Notificações de vencimento de documentos enviadas para {count} destinatários\",\n    documentExpirationFailed: \"Falha ao enviar notificações de documentos\",\n    dailySummarySent: \"Resumo diário enviado para {count} destinatários\",\n    dailySummaryFailed: \"Falha ao enviar resumo diário\",\n  },\n\n  admin: {\n    title: \"Configurações de Administração\",\n    description: \"Gerenciar usuários e configurações do sistema\",\n    userManagement: \"Gerenciamento de Usuários\",\n    userManagementDescription: \"Gerencie funções e permissões de usuários\",\n    users: \"Usuários\",\n    addUser: \"Adicionar Usuário\",\n    editUser: \"Editar Usuário\",\n    deleteUser: \"Excluir Usuário\",\n    role: \"Função\",\n    email: \"Email\",\n    firstName: \"Nome\",\n    lastName: \"Sobrenome\",\n    changeRole: \"Alterar Função\",\n    auditLog: \"Log de Auditoria\",\n    systemSettings: \"Configurações do Sistema\",\n    noUsers: \"Nenhum usuário cadastrado\",\n    userUpdated: \"Usuário atualizado com sucesso\",\n    unknownUser: \"Usuário Desconhecido\",\n    systemStats: \"Estatísticas do Sistema\",\n    systemStatsDescription: \"Visão geral da atividade do sistema\",\n    totalUsers: \"Total de Usuários\",\n    administrators: \"Administradores\",\n    auditRecords: \"Registros de Auditoria\",\n    recentActivity: \"Atividade recente do sistema\",\n  },\n\n  alerts: {\n    title: \"Alertas do Sistema\",\n    description: \"Gerenciar alertas e pendências do contrato\",\n    unallocatedEmployee: \"Funcionário sem alocação\",\n    expiredDocument: \"Documento vencido\",\n    untreatedOccurrence: \"Ocorrência não tratada\",\n    criticalAlerts: \"Alertas Críticos\",\n    warningAlerts: \"Alertas de Aviso\",\n    resolved: \"Resolvido\",\n    pending: \"Pendente\",\n    markAsResolved: \"Marcar como Resolvido\",\n    resolvedBy: \"Resolvido por\",\n    resolvedAt: \"Resolvido em\",\n    noAlerts: \"Nenhum alerta pendente\",\n    alertResolved: \"Alerta marcado como resolvido\",\n  },\n\n  validation: {\n    required: \"Este campo é obrigatório\",\n    invalidEmail: \"Email inválido\",\n    invalidCpf: \"CPF inválido. Use o formato XXX.XXX.XXX-XX\",\n    invalidDate: \"Data inválida\",\n    minLength: \"Mínimo de {min} caracteres\",\n    maxLength: \"Máximo de {max} caracteres\",\n    minValue: \"Valor mínimo: {min}\",\n    maxValue: \"Valor máximo: {max}\",\n    invalidFormat: \"Formato inválido\",\n    selectRequired: \"Selecione uma opção\",\n    fileRequired: \"Selecione um arquivo\",\n    fileTooLarge: \"Tamanho do arquivo deve ser menor que {max}MB\",\n    invalidFileType: \"Tipo de arquivo não permitido\",\n    descriptionMinLength: \"A descrição deve ter pelo menos {min} caracteres\",\n    endDateAfterStart: \"Data de término deve ser igual ou posterior à data de início\",\n  },\n\n  errors: {\n    generic: \"Ocorreu um erro. Tente novamente.\",\n    notFound: \"Não encontrado\",\n    unauthorized: \"Não autorizado\",\n    forbidden: \"Acesso negado\",\n    serverError: \"Erro no servidor\",\n    networkError: \"Erro de conexão\",\n    loadError: \"Erro ao carregar dados\",\n    saveError: \"Erro ao salvar dados\",\n    deleteError: \"Erro ao excluir dados\",\n  },\n\n  landing: {\n    title: \"Sistema de Gestão Contratual\",\n    subtitle: \"Dica Serviços\",\n    description: \"Gerencie contratos, funcionários, alocações e documentos de forma eficiente e organizada.\",\n    loginButton: \"Entrar no Sistema\",\n    features: {\n      employees: \"Gestão de Funcionários\",\n      employeesDesc: \"Cadastro completo com CPF, função e status\",\n      posts: \"Postos de Serviço\",\n      postsDesc: \"Controle de postos contratuais e modalidades\",\n      allocation: \"Alocação Diária\",\n      allocationDesc: \"Acompanhamento de presença e ausências\",\n      documents: \"Documentos\",\n      documentsDesc: \"Controle de documentos e vencimentos\",\n      occurrences: \"Ocorrências\",\n      occurrencesDesc: \"Registro de faltas, substituições e problemas\",\n      reports: \"Relatórios\",\n      reportsDesc: \"Exportação de dados em PDF e CSV\",\n      audit: \"Trilha de Auditoria\",\n      auditDesc: \"Log completo de auditoria para todas as operações e alterações no sistema.\",\n    },\n    everythingYouNeed: \"Tudo o Que Você Precisa\",\n    completeTools: \"Ferramentas completas para fiscalização de contratos e gestão de conformidade.\",\n    roleBasedAccess: \"Controle de Acesso por Perfil\",\n    accessLevelsDesigned: \"Níveis de acesso projetados para seu fluxo de trabalho\",\n    fullAccessModules: \"Acesso completo a todos os módulos\",\n    userManagementSettings: \"Gerenciamento de usuários e configurações\",\n    uploadDocManagement: \"Upload e gerenciamento de documentos\",\n    reportGeneration: \"Geração e exportação de relatórios\",\n    viewAllRecords: \"Visualizar todos os registros e dados\",\n    accessDashboard: \"Acessar painel e estatísticas\",\n    viewAllocations: \"Ver alocações e ocorrências\",\n    readOnlyMode: \"Modo somente leitura\",\n    footer: \"Desenvolvido para fiscalização eficiente de contratos.\",\n    copyright: \"Todos os direitos reservados.\",\n    accessReportsAnalytics: \"Acessar relatórios e análises\",\n    exportDataCsv: \"Exportar dados para CSV\",\n    downloadDocuments: \"Baixar documentos\",\n    solutionForContracts: \"Solução para Fiscalização de Contratos\",\n  },\n\n  notFound: {\n    title: \"Página Não Encontrada\",\n    description: \"A página que você está procurando não existe ou foi movida.\",\n    backHome: \"Voltar ao Início\",\n  },\n\n  table: {\n    noResults: \"Nenhum resultado encontrado.\",\n    rowsPerPage: \"Linhas por página\",\n    page: \"Página\",\n    of: \"de\",\n    selected: \"selecionado(s)\",\n    columns: \"Colunas\",\n    showColumns: \"Mostrar colunas\",\n    hideColumns: \"Ocultar colunas\",\n  },\n\n  confirmDialog: {\n    areYouSure: \"Tem certeza?\",\n    cannotUndo: \"Esta ação não pode ser desfeita.\",\n    confirm: \"Confirmar\",\n    cancel: \"Cancelar\",\n  },\n} as const;\n\nexport type TranslationKeys = typeof translations;\n\nexport function t(path: string): string {\n  const keys = path.split(\".\");\n  let value: any = translations;\n  \n  for (const key of keys) {\n    if (value && typeof value === \"object\" && key in value) {\n      value = value[key];\n    } else {\n      console.warn(`Translation not found: ${path}`);\n      return path;\n    }\n  }\n  \n  return typeof value === \"string\" ? value : path;\n}\n\nexport function formatTranslation(path: string, params: Record<string, string | number>): string {\n  let text = t(path);\n  for (const [key, val] of Object.entries(params)) {\n    text = text.replace(new RegExp(`\\\\{${key}\\\\}`, \"g\"), String(val));\n  }\n  return text;\n}\n","path":null,"size_bytes":21507,"size_tokens":null},"client/src/pages/auditoria.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Clock, Download, ChevronDown, ChevronRight, Filter, Search } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { PageHeader } from \"@/components/page-header\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Shield } from \"lucide-react\";\nimport { formatDateTime } from \"@/lib/authUtils\";\nimport type { User, AuditLog } from \"@shared/schema\";\n\ntype AuditLogWithUser = AuditLog & { user?: User | null };\n\nconst entityTypeLabels: Record<string, string> = {\n  employee: \"Funcionário\",\n  service_post: \"Posto de Serviço\",\n  allocation: \"Alocação\",\n  occurrence: \"Ocorrência\",\n  document: \"Documento\",\n  user: \"Usuário\",\n  notification_settings: \"Configurações de Notificação\",\n  alert: \"Alerta\",\n};\n\nconst actionLabels: Record<string, string> = {\n  create: \"Criar\",\n  update: \"Atualizar\",\n  delete: \"Excluir\",\n  bulk_copy: \"Copiar em Lote\",\n  bulk_import: \"Importar em Lote\",\n  send_notification: \"Enviar Notificação\",\n  mark_treated: \"Marcar Tratada\",\n  resolve: \"Resolver\",\n  CREATE: \"Criar\",\n  UPDATE: \"Atualizar\",\n  DELETE: \"Excluir\",\n};\n\nfunction getActionBadgeVariant(action: string): \"default\" | \"secondary\" | \"destructive\" | \"outline\" {\n  const upperAction = action.toUpperCase();\n  if (upperAction === \"CREATE\") return \"default\";\n  if (upperAction === \"UPDATE\") return \"secondary\";\n  if (upperAction === \"DELETE\") return \"destructive\";\n  return \"outline\";\n}\n\nfunction DiffViewer({ title, data }: { title: string; data: Record<string, unknown> | null | undefined }) {\n  if (!data || (typeof data === \"object\" && Object.keys(data).length === 0)) {\n    return (\n      <div className=\"text-sm text-muted-foreground italic\">\n        Sem dados\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-2\">\n      <h4 className=\"text-sm font-medium\">{title}</h4>\n      <pre className=\"text-xs bg-muted p-3 rounded-md overflow-x-auto max-h-64 overflow-y-auto\">\n        {JSON.stringify(data, null, 2)}\n      </pre>\n    </div>\n  );\n}\n\nfunction AuditLogRow({ log }: { log: AuditLogWithUser }) {\n  const [isOpen, setIsOpen] = useState(false);\n  const hasDiff = log.diffBefore || log.diffAfter;\n  \n  const userName = log.user \n    ? `${log.user.firstName || \"\"} ${log.user.lastName || \"\"}`.trim() || log.user.email || \"Usuário\"\n    : \"Sistema\";\n\n  return (\n    <>\n      <TableRow className=\"cursor-pointer\" data-testid={`row-audit-${log.id}`}>\n        <TableCell>\n          {hasDiff ? (\n            <Button \n              variant=\"ghost\" \n              size=\"icon\" \n              className=\"h-6 w-6\" \n              data-testid={`button-expand-${log.id}`}\n              onClick={() => setIsOpen(!isOpen)}\n            >\n              {isOpen ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n            </Button>\n          ) : (\n            <div className=\"w-6\" />\n          )}\n        </TableCell>\n        <TableCell className=\"text-sm\" data-testid={`text-timestamp-${log.id}`}>\n          {log.timestamp ? formatDateTime(log.timestamp) : \"-\"}\n        </TableCell>\n        <TableCell className=\"text-sm\" data-testid={`text-user-${log.id}`}>\n          {userName}\n        </TableCell>\n        <TableCell data-testid={`badge-action-${log.id}`}>\n          <Badge variant={getActionBadgeVariant(log.action)}>\n            {actionLabels[log.action] || actionLabels[log.action.toUpperCase()] || log.action}\n          </Badge>\n        </TableCell>\n        <TableCell className=\"text-sm\" data-testid={`text-entity-${log.id}`}>\n          {entityTypeLabels[log.entityType] || log.entityType}\n        </TableCell>\n        <TableCell className=\"text-sm font-mono\" data-testid={`text-entityid-${log.id}`}>\n          {log.entityId || \"-\"}\n        </TableCell>\n      </TableRow>\n      {hasDiff && isOpen && (\n        <TableRow className=\"bg-muted/30\">\n          <TableCell colSpan={6} className=\"py-4\">\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <DiffViewer title=\"Antes da alteração\" data={log.diffBefore as Record<string, unknown> | null} />\n              <DiffViewer title=\"Depois da alteração\" data={log.diffAfter as Record<string, unknown> | null} />\n            </div>\n          </TableCell>\n        </TableRow>\n      )}\n    </>\n  );\n}\n\nexport default function AuditoriaPage() {\n  const { isAdmin } = useAuth();\n  \n  const [filters, setFilters] = useState({\n    userId: \"\",\n    entityType: \"\",\n    action: \"\",\n    startDate: \"\",\n    endDate: \"\",\n  });\n  const [activeFilters, setActiveFilters] = useState(filters);\n  const [limit, setLimit] = useState(\"100\");\n\n  const queryParams = new URLSearchParams();\n  if (activeFilters.userId) queryParams.set(\"userId\", activeFilters.userId);\n  if (activeFilters.entityType) queryParams.set(\"entityType\", activeFilters.entityType);\n  if (activeFilters.action) queryParams.set(\"action\", activeFilters.action);\n  if (activeFilters.startDate) queryParams.set(\"startDate\", activeFilters.startDate);\n  if (activeFilters.endDate) queryParams.set(\"endDate\", activeFilters.endDate);\n  if (limit) queryParams.set(\"limit\", limit);\n\n  const { data: logs, isLoading: logsLoading } = useQuery<AuditLogWithUser[]>({\n    queryKey: [\"/api/admin/audit-logs\", queryParams.toString()],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/audit-logs?${queryParams.toString()}`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch audit logs\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const { data: users } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n    enabled: isAdmin,\n  });\n\n  const { data: entityTypes } = useQuery<string[]>({\n    queryKey: [\"/api/admin/audit-logs/entity-types\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/audit-logs/entity-types\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch entity types\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const { data: actions } = useQuery<string[]>({\n    queryKey: [\"/api/admin/audit-logs/actions\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/admin/audit-logs/actions\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) throw new Error(\"Failed to fetch actions\");\n      return response.json();\n    },\n    enabled: isAdmin,\n  });\n\n  const handleApplyFilters = () => {\n    setActiveFilters(filters);\n  };\n\n  const handleClearFilters = () => {\n    const cleared = { userId: \"\", entityType: \"\", action: \"\", startDate: \"\", endDate: \"\" };\n    setFilters(cleared);\n    setActiveFilters(cleared);\n  };\n\n  const handleExportCsv = () => {\n    const exportParams = new URLSearchParams();\n    if (activeFilters.userId) exportParams.set(\"userId\", activeFilters.userId);\n    if (activeFilters.entityType) exportParams.set(\"entityType\", activeFilters.entityType);\n    if (activeFilters.action) exportParams.set(\"action\", activeFilters.action);\n    if (activeFilters.startDate) exportParams.set(\"startDate\", activeFilters.startDate);\n    if (activeFilters.endDate) exportParams.set(\"endDate\", activeFilters.endDate);\n    \n    window.open(`/api/admin/audit-logs/export?${exportParams.toString()}`, \"_blank\");\n  };\n\n  if (!isAdmin) {\n    return (\n      <div className=\"p-6 space-y-6\">\n        <PageHeader title=\"Auditoria\" />\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Shield className=\"h-12 w-12 text-muted-foreground mb-4\" />\n            <h2 className=\"text-lg font-semibold\">Acesso Negado</h2>\n            <p className=\"text-muted-foreground text-center max-w-md\">\n              Você não tem permissão para acessar esta página.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <PageHeader\n        title=\"Auditoria\"\n        description=\"Histórico completo de alterações no sistema\"\n      />\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Filter className=\"h-5 w-5\" />\n            Filtros\n          </CardTitle>\n          <CardDescription>Refine a busca por logs de auditoria</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-user\">Usuário</Label>\n              <Select\n                value={filters.userId || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, userId: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-user\" data-testid=\"select-filter-user\">\n                  <SelectValue placeholder=\"Todos os usuários\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todos os usuários</SelectItem>\n                  {users?.map((user) => (\n                    <SelectItem key={user.id} value={user.id}>\n                      {`${user.firstName || \"\"} ${user.lastName || \"\"}`.trim() || user.email || user.id}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-entity\">Tipo de Entidade</Label>\n              <Select\n                value={filters.entityType || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, entityType: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-entity\" data-testid=\"select-filter-entity\">\n                  <SelectValue placeholder=\"Todas as entidades\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todas as entidades</SelectItem>\n                  {entityTypes?.map((type) => (\n                    <SelectItem key={type} value={type}>\n                      {entityTypeLabels[type] || type}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-action\">Ação</Label>\n              <Select\n                value={filters.action || \"_all\"}\n                onValueChange={(value) => setFilters({ ...filters, action: value === \"_all\" ? \"\" : value })}\n              >\n                <SelectTrigger id=\"filter-action\" data-testid=\"select-filter-action\">\n                  <SelectValue placeholder=\"Todas as ações\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"_all\">Todas as ações</SelectItem>\n                  {actions?.map((action) => (\n                    <SelectItem key={action} value={action}>\n                      {actionLabels[action] || actionLabels[action.toUpperCase()] || action}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-start-date\">Data Inicial</Label>\n              <Input\n                id=\"filter-start-date\"\n                type=\"date\"\n                value={filters.startDate}\n                onChange={(e) => setFilters({ ...filters, startDate: e.target.value })}\n                data-testid=\"input-filter-start-date\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"filter-end-date\">Data Final</Label>\n              <Input\n                id=\"filter-end-date\"\n                type=\"date\"\n                value={filters.endDate}\n                onChange={(e) => setFilters({ ...filters, endDate: e.target.value })}\n                data-testid=\"input-filter-end-date\"\n              />\n            </div>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-3 mt-4\">\n            <Button onClick={handleApplyFilters} data-testid=\"button-apply-filters\">\n              <Search className=\"h-4 w-4 mr-2\" />\n              Aplicar Filtros\n            </Button>\n            <Button variant=\"outline\" onClick={handleClearFilters} data-testid=\"button-clear-filters\">\n              Limpar Filtros\n            </Button>\n            <div className=\"flex-1\" />\n            <div className=\"flex items-center gap-2\">\n              <Label htmlFor=\"limit\" className=\"text-sm text-muted-foreground\">Limite:</Label>\n              <Select value={limit} onValueChange={setLimit}>\n                <SelectTrigger id=\"limit\" className=\"w-24\" data-testid=\"select-limit\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"50\">50</SelectItem>\n                  <SelectItem value=\"100\">100</SelectItem>\n                  <SelectItem value=\"250\">250</SelectItem>\n                  <SelectItem value=\"500\">500</SelectItem>\n                  <SelectItem value=\"1000\">1000</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            <Button variant=\"outline\" onClick={handleExportCsv} data-testid=\"button-export-csv\">\n              <Download className=\"h-4 w-4 mr-2\" />\n              Exportar CSV\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Clock className=\"h-5 w-5\" />\n            Registros de Auditoria\n          </CardTitle>\n          <CardDescription>\n            {logs?.length !== undefined ? `${logs.length} registros encontrados` : \"Carregando...\"}\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {logsLoading ? (\n            <div className=\"space-y-2\">\n              {Array.from({ length: 10 }).map((_, i) => (\n                <Skeleton key={i} className=\"h-12 w-full\" />\n              ))}\n            </div>\n          ) : logs?.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <Clock className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n              <p className=\"text-muted-foreground\">Nenhum registro de auditoria encontrado</p>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-10\"></TableHead>\n                    <TableHead>Data/Hora</TableHead>\n                    <TableHead>Usuário</TableHead>\n                    <TableHead>Ação</TableHead>\n                    <TableHead>Entidade</TableHead>\n                    <TableHead>ID da Entidade</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {logs?.map((log) => (\n                    <AuditLogRow key={log.id} log={log} />\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":15712,"size_tokens":null},"client/src/components/dev-role-switcher.tsx":{"content":"import { useDevRole, type DevRole } from \"@/contexts/DevRoleContext\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Bug, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\n/**\n * Development Role Switcher Component\n * \n * A floating UI panel that appears in the bottom-right corner of the screen\n * ONLY in development mode. It allows developers to quickly switch between\n * different user roles to test role-based access control without logging\n * out or modifying the database.\n * \n * IMPORTANT: This component only renders when import.meta.env.DEV is true\n * (i.e., NODE_ENV !== \"production\"). In production builds, this component\n * returns null and has zero impact on the application.\n * \n * ROLES:\n * - admin: Full administrative access (maps to \"admin\" role)\n * - fiscal: Fiscal Petrobras role with export permissions (maps to \"fiscal_petrobras\")\n * - operador: Operator role with edit permissions (maps to \"operator_dica\")\n * - visualizador: Read-only viewer role (maps to \"viewer\")\n * \n * TO DISABLE THIS FEATURE:\n * 1. Remove this component from App.tsx, or\n * 2. Simply deploy to production - it won't appear\n */\n\nconst ROLE_OPTIONS: { value: DevRole; label: string; description: string }[] = [\n  { value: \"admin\", label: \"Admin\", description: \"Acesso total\" },\n  { value: \"fiscal\", label: \"Fiscal\", description: \"Visualizar + Exportar\" },\n  { value: \"operador\", label: \"Operador\", description: \"Visualizar + Editar\" },\n  { value: \"visualizador\", label: \"Visualizador\", description: \"Apenas visualizar\" },\n];\n\nexport function DevRoleSwitcher() {\n  const { devRole, setDevRole, isDevMode, clearDevRole } = useDevRole();\n\n  // Only render in development mode\n  if (!isDevMode) {\n    return null;\n  }\n\n  return (\n    <div \n      className=\"fixed bottom-4 right-4 z-50 bg-background/80 backdrop-blur-sm border rounded-md p-3 shadow-lg max-w-[220px]\"\n      data-testid=\"dev-role-switcher\"\n    >\n      <div className=\"flex items-center justify-between gap-2 mb-2\">\n        <div className=\"flex items-center gap-1.5\">\n          <Bug className=\"h-4 w-4 text-orange-500\" />\n          <span className=\"text-xs font-medium text-muted-foreground\">Dev Mode</span>\n        </div>\n        {devRole && (\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-5 w-5\"\n            onClick={clearDevRole}\n            title=\"Clear role override\"\n            data-testid=\"button-clear-dev-role\"\n          >\n            <X className=\"h-3 w-3\" />\n          </Button>\n        )}\n      </div>\n      \n      <Select\n        value={devRole || \"\"}\n        onValueChange={(value) => setDevRole(value as DevRole)}\n      >\n        <SelectTrigger \n          className=\"h-8 text-xs\"\n          data-testid=\"select-dev-role\"\n        >\n          <SelectValue placeholder=\"Usar role real\" />\n        </SelectTrigger>\n        <SelectContent>\n          {ROLE_OPTIONS.map((option) => (\n            <SelectItem \n              key={option.value!} \n              value={option.value!}\n              data-testid={`option-role-${option.value}`}\n            >\n              <div className=\"flex items-center gap-2\">\n                <span className=\"font-medium\">{option.label}</span>\n                <span className=\"text-muted-foreground text-xs\">({option.description})</span>\n              </div>\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </Select>\n\n      {devRole && (\n        <div className=\"mt-2 flex items-center gap-1\">\n          <Badge variant=\"outline\" className=\"text-xs bg-orange-500/10 text-orange-600 border-orange-500/30\">\n            Override: {devRole}\n          </Badge>\n        </div>\n      )}\n      \n      <p className=\"text-[10px] text-muted-foreground mt-2\">\n        Role override ativo apenas em dev\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":3921,"size_tokens":null},"client/src/contexts/DevRoleContext.tsx":{"content":"import { createContext, useContext, useState, useCallback, type ReactNode } from \"react\";\n\n/**\n * Development Role Context\n * \n * This context provides a way to override the user's role during development\n * for testing purposes. The role switcher only appears and functions when\n * NODE_ENV === \"development\" (checked via import.meta.env.DEV in Vite).\n * \n * HOW IT WORKS:\n * 1. The DevRoleProvider wraps the app and provides the dev role state\n * 2. The useDevRole hook gives access to the current dev role and setter\n * 3. The useAuth hook checks for a dev role override before using the real role\n * 4. API requests include a X-Dev-Role header when a dev role is active\n * 5. Backend middleware checks for this header in development mode only\n * \n * TO DISABLE:\n * - Set devRole to null in the context\n * - Or simply deploy to production (the switcher won't appear)\n */\n\nexport type DevRole = \"admin\" | \"fiscal\" | \"operador\" | \"visualizador\" | null;\n\ninterface DevRoleContextType {\n  devRole: DevRole;\n  setDevRole: (role: DevRole) => void;\n  isDevMode: boolean;\n  clearDevRole: () => void;\n}\n\nconst DevRoleContext = createContext<DevRoleContextType | undefined>(undefined);\n\ninterface DevRoleProviderProps {\n  children: ReactNode;\n}\n\nexport function DevRoleProvider({ children }: DevRoleProviderProps) {\n  // Check if we're in development mode using Vite's env variable\n  const isDevMode = import.meta.env.DEV;\n  \n  // Initialize from localStorage to persist across page refreshes (dev only)\n  const [devRole, setDevRoleState] = useState<DevRole>(() => {\n    if (!isDevMode) return null;\n    const stored = localStorage.getItem(\"dev-role-override\");\n    if (stored && [\"admin\", \"fiscal\", \"operador\", \"visualizador\"].includes(stored)) {\n      return stored as DevRole;\n    }\n    return null;\n  });\n\n  const setDevRole = useCallback((role: DevRole) => {\n    if (!isDevMode) return;\n    setDevRoleState(role);\n    if (role) {\n      localStorage.setItem(\"dev-role-override\", role);\n    } else {\n      localStorage.removeItem(\"dev-role-override\");\n    }\n  }, [isDevMode]);\n\n  const clearDevRole = useCallback(() => {\n    setDevRole(null);\n  }, [setDevRole]);\n\n  return (\n    <DevRoleContext.Provider value={{ devRole, setDevRole, isDevMode, clearDevRole }}>\n      {children}\n    </DevRoleContext.Provider>\n  );\n}\n\nexport function useDevRole() {\n  const context = useContext(DevRoleContext);\n  if (context === undefined) {\n    throw new Error(\"useDevRole must be used within a DevRoleProvider\");\n  }\n  return context;\n}\n\n/**\n * Maps development role names to the actual database role values.\n * This allows using simplified role names in the switcher UI.\n */\nexport function mapDevRoleToUserRole(devRole: DevRole): string | null {\n  if (!devRole) return null;\n  \n  const roleMap: Record<string, string> = {\n    \"admin\": \"admin\",\n    \"fiscal\": \"fiscal_petrobras\",\n    \"operador\": \"operator_dica\",\n    \"visualizador\": \"viewer\",\n  };\n  \n  return roleMap[devRole] || null;\n}\n","path":null,"size_bytes":2970,"size_tokens":null}},"version":2}